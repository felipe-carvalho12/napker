{"ast":null,"code":"import _classCallCheck from\"C:\\\\Users\\\\felip\\\\CodeProjects\\\\Web\\\\Napker\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\felip\\\\CodeProjects\\\\Web\\\\Napker\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\felip\\\\CodeProjects\\\\Web\\\\Napker\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\felip\\\\CodeProjects\\\\Web\\\\Napker\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React from'react';import Picker from'emoji-picker-react';import{Link}from'react-router-dom';import LikesModal from'../../components/likesmodal';import{SERVER_URL}from'../../settings';import{csrftoken,openCloseEmojiList}from'../../utils';var Posts=/*#__PURE__*/function(_React$Component){_inherits(Posts,_React$Component);var _super=_createSuper(Posts);function Posts(props){var _this;_classCallCheck(this,Posts);_this=_super.call(this,props);_this.fetchPosts=function(){fetch(\"\".concat(SERVER_URL,\"/post-api/post-list\")).then(function(response){return response.json();}).then(function(data){return _this.setState({posts:data});});};_this.likeUnlikePost=function(e){e.stopPropagation();var likeBtn=e.target;if(likeBtn.classList.contains('fas')){likeBtn.classList.remove('fas');//border heart\nlikeBtn.classList.add('far');//filled heart\nfetch(\"\".concat(SERVER_URL,\"/post-api/unlike-post/\").concat(likeBtn.dataset.postid)).then(function(response){return response.json();}).then(function(data){console.log(data);_this.fetchPosts();});}else{likeBtn.classList.remove('far');//border heart\nlikeBtn.classList.add('fas');//filled heart\nfetch(\"\".concat(SERVER_URL,\"/post-api/like-post/\").concat(likeBtn.dataset.postid)).then(function(response){return response.json();}).then(function(data){console.log(data);_this.fetchPosts();});}};_this.hideLikesModal=function(){_this.setState({likesModal:{isOpen:false,likes:null}});};_this.deletePost=function(e,postId){e.stopPropagation();var el=document.querySelector(\"#profile-post-\".concat(postId));if(window.confirm('Tem certeza que deseja apagar o post?\\nEssa ação é irreversível.')){el.style.animationPlayState='running';el.addEventListener('animationend',function(){_this.fetchPosts();});fetch(\"\".concat(SERVER_URL,\"/post-api/delete-post/\").concat(postId),{method:'POST',headers:{'Content-type':'application/json','X-CSRFToken':csrftoken}}).then(function(response){return response.json();}).then(function(data){console.log(data);});}};_this.handlePostContentChange=function(e){_this.setState({postContent:e.target.value});var el=document.querySelector('#post-form-submit-btn');el.disabled=e.target.value.trim()===''&&!_this.state.postFormImagePreview;};_this.handlePostImageChange=function(e){var reader=new FileReader();reader.onload=function(){if(reader.readyState===2){_this.setState({postFormImagePreview:reader.result});document.querySelector('#post-img-container').style.display='initial';document.querySelector('#post-form-submit-btn').disabled=false;}};try{reader.readAsDataURL(e.target.files[0]);}catch(_unused){}};_this.handleCloseImage=function(){document.querySelector('#post-img-container').style.display='none';document.querySelector('#post-image').value='';if(_this.state.postContent.trim()==='')document.querySelector('#post-form-submit-btn').disabled=true;_this.setState({postFormImagePreview:null});};_this.onEmojiSelect=function(event,emojiObject){_this.setState({postContent:_this.state.postContent+emojiObject.emoji});document.querySelector('#post-form-submit-btn').disabled=false;};_this.state={profile:null,posts:null,likesModal:{isOpen:false,likes:null},postContent:'',postFormImagePreview:null};return _this;}_createClass(Posts,[{key:\"componentWillMount\",value:function componentWillMount(){var _this2=this;fetch(\"\".concat(SERVER_URL,\"/profile-api/myprofile\")).then(function(response){return response.json();}).then(function(data){return _this2.setState({profile:data});});this.fetchPosts();}},{key:\"render\",value:function render(){var _this3=this;return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(LikesModal,{isOpen:this.state.likesModal.isOpen,likes:this.state.likesModal.likes,hideModal:this.hideLikesModal}),this.state.profile&&/*#__PURE__*/React.createElement(\"form\",{action:\"\".concat(SERVER_URL,\"/post-api/create-post\"),method:\"POST\",className:\"create-post-form\",encType:\"multipart/form-data\"},/*#__PURE__*/React.createElement(\"input\",{type:\"hidden\",name:\"csrfmiddlewaretoken\",value:csrftoken}),/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex\"},/*#__PURE__*/React.createElement(Link,{to:\"/perfil\"},/*#__PURE__*/React.createElement(\"img\",{src:\"\".concat(SERVER_URL).concat(this.state.profile.photo),className:\"profile-img-med\"})),/*#__PURE__*/React.createElement(\"textarea\",{className:\"post-content-textarea\",name:\"post-content\",value:this.state.postContent,placeholder:\"No que voc\\xEA est\\xE1 pensando?\",maxLength:300,autoFocus:true,onChange:this.handlePostContentChange})),/*#__PURE__*/React.createElement(\"div\",{className:\"w-100 d-flex justify-content-center\"},/*#__PURE__*/React.createElement(\"div\",{className:\"post-img-container\",id:\"post-img-container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"post-img-options\"},/*#__PURE__*/React.createElement(\"i\",{className:\"far fa-times-circle\",onClick:this.handleCloseImage})),/*#__PURE__*/React.createElement(\"img\",{src:this.state.postFormImagePreview,className:\"post-img post-form-img-preview\",id:\"post-form-img-preview\"}))),/*#__PURE__*/React.createElement(\"hr\",null),/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex justify-content-between\",style:{margin:'0px 70px 0 70px'}},/*#__PURE__*/React.createElement(\"div\",{className:\"post-extra-options\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"post-image\",class:\"far fa-image\"}),/*#__PURE__*/React.createElement(\"input\",{type:\"file\",accept:\"image/png, image/jpg, image/jpeg\",name:\"post-image\",id:\"post-image\",style:{display:'none'},onChange:this.handlePostImageChange}),/*#__PURE__*/React.createElement(\"label\",{className:\"far fa-smile\",id:\"emoji-button\",onClick:function onClick(){return openCloseEmojiList(false);}}),/*#__PURE__*/React.createElement(\"div\",{className:\"emoji-list-container\",id:\"emoji-list-container\"},/*#__PURE__*/React.createElement(Picker,{onEmojiClick:this.onEmojiSelect}))),/*#__PURE__*/React.createElement(\"button\",{type:\"submit\",className:\"btn btn-primary\",id:\"post-form-submit-btn\",style:{height:'40px'},disabled:true},\"Postar\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"post-list\"},this.state.posts&&this.state.profile?this.state.posts.map(function(post){return/*#__PURE__*/React.createElement(\"li\",{className:\"post-container post-list-item\",id:\"profile-post-\".concat(post.id),key:post.id,onClick:function onClick(){return window.location.href=\"/post/\".concat(post.id);}},/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex justify-content-between\"},/*#__PURE__*/React.createElement(\"div\",{className:\"post-row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"post-col\"},/*#__PURE__*/React.createElement(Link,{to:post.author.id===_this3.state.profile.id?'/perfil':\"/user/\".concat(post.author.slug),onClick:function onClick(e){return e.stopPropagation();}},/*#__PURE__*/React.createElement(\"img\",{src:\"\".concat(SERVER_URL).concat(post.author.photo),className:\"profile-img-med\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"post-col\"},/*#__PURE__*/React.createElement(Link,{to:post.author.id===_this3.state.profile.id?'/perfil':\"/user/\".concat(post.author.slug),style:{color:'#000'},onClick:function onClick(e){return e.stopPropagation();}},/*#__PURE__*/React.createElement(\"div\",{className:\"post-author-data-wrapper\"},/*#__PURE__*/React.createElement(\"strong\",null,post.author.first_name,\" \",post.author.last_name,\" \"),/*#__PURE__*/React.createElement(\"p\",{className:\"text-secondary d-inline-block\"},\"@\",post.author.user.username,\" \\u2022 \",post.created.split('-').reverse().join('/')))),/*#__PURE__*/React.createElement(\"div\",{style:{textAlign:'start'}},post.content),post.image&&/*#__PURE__*/React.createElement(\"img\",{src:\"\".concat(SERVER_URL).concat(post.image),className:\"post-img\"}))),post.author.id===_this3.state.profile.id&&/*#__PURE__*/React.createElement(\"i\",{className:\"far fa-trash-alt trash-icon text-secondary\",style:{margin:'20px 20px 0 0'},onClick:function onClick(e){return _this3.deletePost(e,post.id);}})),/*#__PURE__*/React.createElement(\"div\",{className:\"post-actions\"},/*#__PURE__*/React.createElement(\"p\",{className:\"text-secondary\"},/*#__PURE__*/React.createElement(Link,{to:\"/post/\".concat(post.id,\"/comentar\"),className:\"text-secondary\",onClick:function onClick(e){return e.stopPropagation();}},/*#__PURE__*/React.createElement(\"i\",{class:\"far fa-comment\"}),post.comments.length),post.likes.map(function(like){return like.profile.id;}).includes(_this3.state.profile.id)?/*#__PURE__*/React.createElement(\"i\",{class:\"fas fa-heart\",\"data-postid\":post.id,onClick:_this3.likeUnlikePost}):/*#__PURE__*/React.createElement(\"i\",{class:\"far fa-heart\",\"data-postid\":post.id,onClick:_this3.likeUnlikePost}),/*#__PURE__*/React.createElement(\"p\",{className:\"post-likes-number\",onClick:function onClick(e){e.stopPropagation();_this3.setState({likesModal:{isOpen:true,likes:post.likes}});}},post.likes.length))));}):/*#__PURE__*/React.createElement(\"div\",{className:\"posts-loader-container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"loader\"}))));}}]);return Posts;}(React.Component);export{Posts as default};","map":{"version":3,"sources":["C:/Users/felip/CodeProjects/Web/Napker/frontend/src/pages/home-components/Posts.js"],"names":["React","Picker","Link","LikesModal","SERVER_URL","csrftoken","openCloseEmojiList","Posts","props","fetchPosts","fetch","then","response","json","data","setState","posts","likeUnlikePost","e","stopPropagation","likeBtn","target","classList","contains","remove","add","dataset","postid","console","log","hideLikesModal","likesModal","isOpen","likes","deletePost","postId","el","document","querySelector","window","confirm","style","animationPlayState","addEventListener","method","headers","handlePostContentChange","postContent","value","disabled","trim","state","postFormImagePreview","handlePostImageChange","reader","FileReader","onload","readyState","result","display","readAsDataURL","files","handleCloseImage","onEmojiSelect","event","emojiObject","emoji","profile","photo","margin","height","map","post","id","location","href","author","slug","color","first_name","last_name","user","username","created","split","reverse","join","textAlign","content","image","comments","length","like","includes","Component"],"mappings":"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","sourcesContent":["import React from 'react'\r\nimport Picker from 'emoji-picker-react'\r\nimport { Link } from 'react-router-dom'\r\n\r\nimport LikesModal from '../../components/likesmodal'\r\nimport { SERVER_URL } from '../../settings'\r\nimport { csrftoken, openCloseEmojiList } from '../../utils'\r\n\r\nexport default class Posts extends React.Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            profile: null,\r\n            posts: null,\r\n            likesModal: {\r\n                isOpen: false,\r\n                likes: null\r\n            },\r\n            postContent: '',\r\n            postFormImagePreview: null\r\n        }\r\n    }\r\n\r\n    componentWillMount() {\r\n        fetch(`${SERVER_URL}/profile-api/myprofile`)\r\n            .then(response => response.json())\r\n            .then(data => this.setState({ profile: data }))\r\n        this.fetchPosts()\r\n    }\r\n\r\n    fetchPosts = () => {\r\n        fetch(`${SERVER_URL}/post-api/post-list`)\r\n            .then(response => response.json())\r\n            .then(data => this.setState({ posts: data }))\r\n    }\r\n\r\n    likeUnlikePost = e => {\r\n        e.stopPropagation()\r\n        const likeBtn = e.target\r\n        if (likeBtn.classList.contains('fas')) {\r\n            likeBtn.classList.remove('fas') //border heart\r\n            likeBtn.classList.add('far')  //filled heart\r\n            fetch(`${SERVER_URL}/post-api/unlike-post/${likeBtn.dataset.postid}`)\r\n                .then(response => response.json())\r\n                .then(data => {\r\n                    console.log(data)\r\n                    this.fetchPosts()\r\n                })\r\n        } else {\r\n            likeBtn.classList.remove('far') //border heart\r\n            likeBtn.classList.add('fas')  //filled heart\r\n            fetch(`${SERVER_URL}/post-api/like-post/${likeBtn.dataset.postid}`)\r\n                .then(response => response.json())\r\n                .then(data => {\r\n                    console.log(data)\r\n                    this.fetchPosts()\r\n                })\r\n        }\r\n    }\r\n\r\n    hideLikesModal = () => {\r\n        this.setState({\r\n            likesModal: {\r\n                isOpen: false,\r\n                likes: null\r\n            }\r\n        })\r\n    }\r\n\r\n    deletePost = (e, postId) => {\r\n        e.stopPropagation()\r\n        const el = document.querySelector(`#profile-post-${postId}`)\r\n        if (window.confirm('Tem certeza que deseja apagar o post?\\nEssa ação é irreversível.')) {\r\n            el.style.animationPlayState = 'running'\r\n            el.addEventListener('animationend', () => {\r\n                this.fetchPosts()\r\n            })\r\n            fetch(`${SERVER_URL}/post-api/delete-post/${postId}`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-type': 'application/json',\r\n                    'X-CSRFToken': csrftoken,\r\n                }\r\n            })\r\n                .then(response => response.json())\r\n                .then(data => {\r\n                    console.log(data)\r\n                })\r\n        }\r\n    }\r\n\r\n    handlePostContentChange = e => {\r\n        this.setState({ postContent: e.target.value })\r\n        const el = document.querySelector('#post-form-submit-btn')\r\n        el.disabled = e.target.value.trim() === '' && !this.state.postFormImagePreview\r\n    }\r\n\r\n    handlePostImageChange = e => {\r\n        const reader = new FileReader()\r\n        reader.onload = () => {\r\n            if (reader.readyState === 2) {\r\n                this.setState({ postFormImagePreview: reader.result })\r\n                document.querySelector('#post-img-container').style.display = 'initial'\r\n                document.querySelector('#post-form-submit-btn').disabled = false\r\n            }\r\n        }\r\n        try {\r\n            reader.readAsDataURL(e.target.files[0])\r\n        } catch {\r\n\r\n        }\r\n    }\r\n\r\n    handleCloseImage = () => {\r\n        document.querySelector('#post-img-container').style.display = 'none'\r\n        document.querySelector('#post-image').value = ''\r\n        if (this.state.postContent.trim() === '') document.querySelector('#post-form-submit-btn').disabled = true\r\n        this.setState({ postFormImagePreview: null })\r\n    }\r\n\r\n    onEmojiSelect = (event, emojiObject) => {\r\n        this.setState({ postContent: this.state.postContent + emojiObject.emoji })\r\n        document.querySelector('#post-form-submit-btn').disabled = false\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <>\r\n                <LikesModal\r\n                    isOpen={this.state.likesModal.isOpen}\r\n                    likes={this.state.likesModal.likes}\r\n                    hideModal={this.hideLikesModal}\r\n                />\r\n                {this.state.profile &&\r\n                    <form\r\n                        action={`${SERVER_URL}/post-api/create-post`}\r\n                        method=\"POST\"\r\n                        className=\"create-post-form\"\r\n                        encType=\"multipart/form-data\"\r\n                    >\r\n                        <input type=\"hidden\" name=\"csrfmiddlewaretoken\" value={csrftoken} />\r\n                        <div className=\"d-flex\">\r\n                            <Link to=\"/perfil\">\r\n                                <img\r\n                                    src={`${SERVER_URL}${this.state.profile.photo}`}\r\n                                    className=\"profile-img-med\"\r\n                                />\r\n                            </Link>\r\n                            <textarea\r\n                                className=\"post-content-textarea\"\r\n                                name=\"post-content\"\r\n                                value={this.state.postContent}\r\n                                placeholder=\"No que você está pensando?\"\r\n                                maxLength={300}\r\n                                autoFocus\r\n                                onChange={this.handlePostContentChange}\r\n                            />\r\n                        </div>\r\n                        <div className=\"w-100 d-flex justify-content-center\">\r\n                            <div\r\n                                className=\"post-img-container\"\r\n                                id=\"post-img-container\">\r\n                                <div\r\n                                    className=\"post-img-options\"\r\n                                >\r\n                                    <i\r\n                                        className=\"far fa-times-circle\"\r\n                                        onClick={this.handleCloseImage}\r\n                                    />\r\n                                </div>\r\n                                <img\r\n                                    src={this.state.postFormImagePreview}\r\n                                    className=\"post-img post-form-img-preview\"\r\n                                    id=\"post-form-img-preview\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                        <hr />\r\n                        <div className=\"d-flex justify-content-between\" style={{ margin: '0px 70px 0 70px' }}>\r\n                            <div className=\"post-extra-options\">\r\n                                <label htmlFor=\"post-image\" class=\"far fa-image\" />\r\n                                <input\r\n                                    type=\"file\"\r\n                                    accept=\"image/png, image/jpg, image/jpeg\"\r\n                                    name=\"post-image\"\r\n                                    id=\"post-image\"\r\n                                    style={{ display: 'none' }}\r\n                                    onChange={this.handlePostImageChange}\r\n                                />\r\n                                <label\r\n                                    className=\"far fa-smile\"\r\n                                    id=\"emoji-button\"\r\n                                    onClick={() => openCloseEmojiList(false)}\r\n                                />\r\n                                <div className=\"emoji-list-container\" id=\"emoji-list-container\">\r\n                                    <Picker onEmojiClick={this.onEmojiSelect} />\r\n                                </div>\r\n                            </div>\r\n                            <button\r\n                                type=\"submit\"\r\n                                className=\"btn btn-primary\"\r\n                                id=\"post-form-submit-btn\"\r\n                                style={{ height: '40px' }}\r\n                                disabled\r\n                            >\r\n                                Postar\r\n                            </button>\r\n                        </div>\r\n                    </form>\r\n                }\r\n                <div className=\"post-list\">\r\n                    {this.state.posts && this.state.profile ?\r\n                        this.state.posts.map(post => {\r\n                            return (\r\n                                <li\r\n                                    className=\"post-container post-list-item\"\r\n                                    id={`profile-post-${post.id}`}\r\n                                    key={post.id}\r\n                                    onClick={() => window.location.href = `/post/${post.id}`}\r\n                                >\r\n                                    <div className=\"d-flex justify-content-between\">\r\n                                        <div className=\"post-row\">\r\n                                            <div className=\"post-col\">\r\n                                                <Link\r\n                                                    to={post.author.id === this.state.profile.id ?\r\n                                                        '/perfil' : `/user/${post.author.slug}`}\r\n                                                    onClick={e => e.stopPropagation()}\r\n                                                >\r\n                                                    <img src={`${SERVER_URL}${post.author.photo}`}\r\n                                                        className=\"profile-img-med\"\r\n                                                    />\r\n                                                </Link>\r\n                                            </div>\r\n                                            <div className=\"post-col\">\r\n                                                <Link\r\n                                                    to={post.author.id === this.state.profile.id ?\r\n                                                        '/perfil' : `/user/${post.author.slug}`}\r\n                                                    style={{ color: '#000' }}\r\n                                                    onClick={e => e.stopPropagation()}\r\n                                                >\r\n                                                    <div className=\"post-author-data-wrapper\">\r\n                                                        <strong>{post.author.first_name} {post.author.last_name} </strong>\r\n                                                        <p className=\"text-secondary d-inline-block\">\r\n                                                            @{post.author.user.username} • {post.created.split('-').reverse().join('/')}\r\n                                                        </p>\r\n                                                    </div>\r\n                                                </Link>\r\n                                                <div style={{ textAlign: 'start' }}>\r\n                                                    {post.content}\r\n                                                </div>\r\n                                                {post.image &&\r\n                                                    <img src={`${SERVER_URL}${post.image}`} className=\"post-img\" />\r\n                                                }\r\n                                            </div>\r\n                                        </div>\r\n                                        {post.author.id === this.state.profile.id &&\r\n                                            <i\r\n                                                className=\"far fa-trash-alt trash-icon text-secondary\"\r\n                                                style={{ margin: '20px 20px 0 0' }}\r\n                                                onClick={e => this.deletePost(e, post.id)}\r\n                                            />}\r\n                                    </div>\r\n                                    <div className=\"post-actions\">\r\n                                        <p className=\"text-secondary\">\r\n                                            <Link\r\n                                                to={`/post/${post.id}/comentar`}\r\n                                                className=\"text-secondary\"\r\n                                                onClick={e => e.stopPropagation()}\r\n                                            >\r\n                                                <i\r\n                                                    class=\"far fa-comment\"\r\n                                                />{post.comments.length}\r\n                                            </Link>\r\n                                            {post.likes.map(like => like.profile.id).includes(this.state.profile.id) ?\r\n                                                <i class=\"fas fa-heart\"\r\n                                                    data-postid={post.id}\r\n                                                    onClick={this.likeUnlikePost}\r\n                                                />\r\n                                                :\r\n                                                <i class=\"far fa-heart\"\r\n                                                    data-postid={post.id}\r\n                                                    onClick={this.likeUnlikePost}\r\n                                                />}\r\n                                            <p className=\"post-likes-number\"\r\n                                                onClick={e => {\r\n                                                    e.stopPropagation()\r\n                                                    this.setState({ likesModal: { isOpen: true, likes: post.likes } })\r\n                                                }}\r\n                                            >\r\n                                                {post.likes.length}\r\n                                            </p>\r\n                                        </p>\r\n                                    </div>\r\n                                </li>\r\n                            )\r\n                        }) :\r\n                        <div className=\"posts-loader-container\" >\r\n                            <div className=\"loader\" />\r\n                        </div>}\r\n                </div>\r\n            </>\r\n        )\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}