{"ast":null,"code":"import _slicedToArray from\"C:\\\\Users\\\\felip\\\\CodeProjects\\\\Web\\\\Napker\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{Link,useHistory,useParams}from'react-router-dom';import{SERVER_URL}from'../../../../../../config/settings';import{csrftoken}from'../../../../../../config/utils';import CommentModal from'../../../../../../components/CommentModal';import LikesModal from'../../../../../../components/LikesModal';import Header from'../../../../../../components/fixed/Header';import CommentListItem from'./components/CommentListItem';import BottomMenu from'../../../../../../components/fixed/bottom-menu/BottomMenu';import CommentIcon from'../../../../../../components/fixed/bottom-menu/components/CommentIcon';export default function Post(props){var history=useHistory();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),post=_useState2[0],setPost=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),myProfile=_useState4[0],setMyProfile=_useState4[1];var _useState5=useState(props.commentModalIsOpen),_useState6=_slicedToArray(_useState5,2),commentModalIsOpen=_useState6[0],setCommentModalIsOpen=_useState6[1];var _useState7=useState({isOpen:false,likes:null}),_useState8=_slicedToArray(_useState7,2),postLikesModal=_useState8[0],setPostLikesModal=_useState8[1];var _useState9=useState({isOpen:false,likes:null}),_useState10=_slicedToArray(_useState9,2),commentLikesModal=_useState10[0],setCommentLikesModal=_useState10[1];var _useParams=useParams(),id=_useParams.id;useEffect(function(){fetchPost();fetch(\"\".concat(SERVER_URL,\"/profile-api/myprofile\")).then(function(response){return response.json();}).then(function(data){return setMyProfile(data);});},[]);useEffect(function(){console.log(commentModalIsOpen,props.commentModalIsOpen);if(commentModalIsOpen&&!props.commentModalIsOpen){console.log('got here');history.push(\"/post/\".concat(id));}setCommentModalIsOpen(props.commentModalIsOpen);},[props.commentModalIsOpen]);var fetchPost=function fetchPost(){fetch(\"\".concat(SERVER_URL,\"/post-api/post/\").concat(id)).then(function(response){return response.json();}).then(function(data){return setPost(data);});};var likeUnlikePost=function likeUnlikePost(e){var likeBtn=e.target;if(likeBtn.classList.contains('fas')){likeBtn.classList.remove('fas');//border heart\nlikeBtn.classList.add('far');//filled heart\nfetch(\"\".concat(SERVER_URL,\"/post-api/unlike-post/\").concat(likeBtn.dataset.postid)).then(function(response){return response.json();}).then(function(data){console.log(data);fetchPost();});}else{likeBtn.classList.remove('far');//border heart\nlikeBtn.classList.add('fas');//filled heart\nfetch(\"\".concat(SERVER_URL,\"/post-api/like-post/\").concat(likeBtn.dataset.postid)).then(function(response){return response.json();}).then(function(data){console.log(data);fetchPost();});}};var deletePost=function deletePost(e,postId){e.stopPropagation();var el=document.querySelector(\"#profile-post-\".concat(postId));if(window.confirm('Tem certeza que deseja apagar o post?\\nEssa ação é irreversível.')){fetch(\"\".concat(SERVER_URL,\"/post-api/delete-post/\").concat(postId),{method:'POST',headers:{'Content-type':'application/json','X-CSRFToken':csrftoken}}).then(function(response){return response.json();}).then(function(data){console.log(data);window.location.href='/';});}};var hideCommentModal=function hideCommentModal(){setCommentModalIsOpen(false);};var hidePostLikesModal=function hidePostLikesModal(){setPostLikesModal({isOpen:false,likes:null});};var hideCommentLikesModal=function hideCommentLikesModal(){setCommentLikesModal({isOpen:false,likes:null});};return/*#__PURE__*/React.createElement(\"div\",{className:\"post-page-container\"},post&&/*#__PURE__*/React.createElement(CommentModal,{isOpen:commentModalIsOpen,hideModal:hideCommentModal,post:post}),/*#__PURE__*/React.createElement(LikesModal,{isOpen:postLikesModal.isOpen,likes:postLikesModal.likes,hideModal:hidePostLikesModal}),/*#__PURE__*/React.createElement(LikesModal,{isOpen:commentLikesModal.isOpen,likes:commentLikesModal.likes,hideModal:hideCommentLikesModal}),/*#__PURE__*/React.createElement(Header,{page:\"Post\",backArrow:true}),/*#__PURE__*/React.createElement(\"div\",{className:\"content\"},post&&myProfile?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"post-container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex justify-content-between\"},/*#__PURE__*/React.createElement(\"div\",{className:\"post-row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"post-col\"},/*#__PURE__*/React.createElement(Link,{to:post.author.id===myProfile.id?'/perfil':\"/user/\".concat(post.author.slug)},/*#__PURE__*/React.createElement(\"img\",{src:\"\".concat(SERVER_URL).concat(post.author.photo),className:\"profile-img-med\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"post-col\"},/*#__PURE__*/React.createElement(Link,{to:post.author.id===myProfile.id?'/perfil':\"/user/\".concat(post.author.slug),style:{color:'#000'}},/*#__PURE__*/React.createElement(\"div\",{style:{textAlign:'start'}},/*#__PURE__*/React.createElement(\"strong\",null,post.author.first_name,\" \",post.author.last_name,\" \"),/*#__PURE__*/React.createElement(\"p\",{className:\"text-secondary d-inline-block\"},\"@\",post.author.user.username,\" \\u2022 \",post.created.split('-').reverse().join('/')))),/*#__PURE__*/React.createElement(\"div\",{style:{textAlign:'start',fontSize:'larger'}},post.content),post.image&&/*#__PURE__*/React.createElement(\"img\",{src:\"\".concat(SERVER_URL).concat(post.image),className:\"post-img\"}))),myProfile.id==post.author.id&&/*#__PURE__*/React.createElement(\"i\",{className:\"far fa-trash-alt trash-icon text-secondary\",style:{margin:'20px 20px 0 0'},onClick:function onClick(e){return deletePost(e,post.id);}})),/*#__PURE__*/React.createElement(\"div\",{className:\"post-actions\"},/*#__PURE__*/React.createElement(\"p\",{className:\"text-secondary\",style:{fontSize:'large'}},/*#__PURE__*/React.createElement(Link,{to:\"/post/\".concat(id,\"/comentar\"),className:\"text-secondary\"},/*#__PURE__*/React.createElement(\"i\",{class:\"far fa-comment\"})),post.comments.length,post.likes.map(function(like){return like.profile.id;}).includes(myProfile.id)?/*#__PURE__*/React.createElement(\"i\",{class:\"fas fa-heart\",\"data-postid\":post.id,onClick:likeUnlikePost}):/*#__PURE__*/React.createElement(\"i\",{class:\"far fa-heart\",\"data-postid\":post.id,onClick:likeUnlikePost}),/*#__PURE__*/React.createElement(\"p\",{className:\"post-likes-number\",onClick:function onClick(){return setPostLikesModal({isOpen:true,likes:post.likes});}},post.likes.length)))),/*#__PURE__*/React.createElement(\"div\",{className:\"comment-list\"},post.comments.map(function(comment){return/*#__PURE__*/React.createElement(CommentListItem,{comment:comment,myProfile:myProfile,fetchPost:fetchPost,setPostLikesModal:setPostLikesModal});}))):/*#__PURE__*/React.createElement(\"div\",{className:\"posts-loader-container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"loader\"}))),/*#__PURE__*/React.createElement(BottomMenu,null,/*#__PURE__*/React.createElement(CommentIcon,{postId:id})));}","map":{"version":3,"sources":["C:/Users/felip/CodeProjects/Web/Napker/frontend/src/pages/home/components/posts_/pages/post_/Post.js"],"names":["React","useEffect","useState","Link","useHistory","useParams","SERVER_URL","csrftoken","CommentModal","LikesModal","Header","CommentListItem","BottomMenu","CommentIcon","Post","props","history","post","setPost","myProfile","setMyProfile","commentModalIsOpen","setCommentModalIsOpen","isOpen","likes","postLikesModal","setPostLikesModal","commentLikesModal","setCommentLikesModal","id","fetchPost","fetch","then","response","json","data","console","log","push","likeUnlikePost","e","likeBtn","target","classList","contains","remove","add","dataset","postid","deletePost","postId","stopPropagation","el","document","querySelector","window","confirm","method","headers","location","href","hideCommentModal","hidePostLikesModal","hideCommentLikesModal","author","slug","photo","color","textAlign","first_name","last_name","user","username","created","split","reverse","join","fontSize","content","image","margin","comments","length","map","like","profile","includes","comment"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react'\r\nimport { Link, useHistory, useParams } from 'react-router-dom'\r\n\r\nimport { SERVER_URL } from '../../../../../../config/settings'\r\nimport { csrftoken } from '../../../../../../config/utils'\r\nimport CommentModal from '../../../../../../components/CommentModal'\r\nimport LikesModal from '../../../../../../components/LikesModal'\r\nimport Header from '../../../../../../components/fixed/Header'\r\nimport CommentListItem from './components/CommentListItem'\r\nimport BottomMenu from '../../../../../../components/fixed/bottom-menu/BottomMenu'\r\nimport CommentIcon from '../../../../../../components/fixed/bottom-menu/components/CommentIcon'\r\n\r\nexport default function Post(props) {\r\n    const history = useHistory()\r\n    const [post, setPost] = useState(null)\r\n    const [myProfile, setMyProfile] = useState(null)\r\n    const [commentModalIsOpen, setCommentModalIsOpen] = useState(props.commentModalIsOpen)\r\n    const [postLikesModal, setPostLikesModal] = useState({ isOpen: false, likes: null })\r\n    const [commentLikesModal, setCommentLikesModal] = useState({ isOpen: false, likes: null })\r\n\r\n    const { id } = useParams()\r\n\r\n    useEffect(() => {\r\n        fetchPost()\r\n        fetch(`${SERVER_URL}/profile-api/myprofile`)\r\n            .then(response => response.json())\r\n            .then(data => setMyProfile(data))\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        console.log(commentModalIsOpen, props.commentModalIsOpen)\r\n        if (commentModalIsOpen && !props.commentModalIsOpen) {\r\n            console.log('got here')\r\n            history.push(`/post/${id}`)\r\n        }\r\n        setCommentModalIsOpen(props.commentModalIsOpen)\r\n    }, [props.commentModalIsOpen])\r\n\r\n    const fetchPost = () => {\r\n        fetch(`${SERVER_URL}/post-api/post/${id}`)\r\n            .then(response => response.json())\r\n            .then(data => setPost(data))\r\n    }\r\n\r\n    const likeUnlikePost = e => {\r\n        const likeBtn = e.target\r\n        if (likeBtn.classList.contains('fas')) {\r\n            likeBtn.classList.remove('fas') //border heart\r\n            likeBtn.classList.add('far')  //filled heart\r\n            fetch(`${SERVER_URL}/post-api/unlike-post/${likeBtn.dataset.postid}`)\r\n                .then(response => response.json())\r\n                .then(data => {\r\n                    console.log(data)\r\n                    fetchPost()\r\n                })\r\n        } else {\r\n            likeBtn.classList.remove('far') //border heart\r\n            likeBtn.classList.add('fas')  //filled heart\r\n            fetch(`${SERVER_URL}/post-api/like-post/${likeBtn.dataset.postid}`)\r\n                .then(response => response.json())\r\n                .then(data => {\r\n                    console.log(data)\r\n                    fetchPost()\r\n                })\r\n        }\r\n    }\r\n\r\n    const deletePost = (e, postId) => {\r\n        e.stopPropagation()\r\n        const el = document.querySelector(`#profile-post-${postId}`)\r\n        if (window.confirm('Tem certeza que deseja apagar o post?\\nEssa ação é irreversível.')) {\r\n            fetch(`${SERVER_URL}/post-api/delete-post/${postId}`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-type': 'application/json',\r\n                    'X-CSRFToken': csrftoken,\r\n                }\r\n            })\r\n                .then(response => response.json())\r\n                .then(data => {\r\n                    console.log(data)\r\n                    window.location.href = '/'\r\n                })\r\n        }\r\n    }\r\n\r\n    const hideCommentModal = () => {\r\n        setCommentModalIsOpen(false)\r\n    }\r\n\r\n    const hidePostLikesModal = () => {\r\n        setPostLikesModal({\r\n            isOpen: false,\r\n            likes: null\r\n        })\r\n    }\r\n\r\n    const hideCommentLikesModal = () => {\r\n        setCommentLikesModal({\r\n            isOpen: false,\r\n            likes: null\r\n        })\r\n    }\r\n\r\n    return (\r\n        <div className=\"post-page-container\">\r\n            {post &&\r\n                <CommentModal\r\n                    isOpen={commentModalIsOpen}\r\n                    hideModal={hideCommentModal}\r\n                    post={post}\r\n                />\r\n            }\r\n            <LikesModal\r\n                isOpen={postLikesModal.isOpen}\r\n                likes={postLikesModal.likes}\r\n                hideModal={hidePostLikesModal}\r\n            />\r\n            <LikesModal\r\n                isOpen={commentLikesModal.isOpen}\r\n                likes={commentLikesModal.likes}\r\n                hideModal={hideCommentLikesModal}\r\n            />\r\n            <Header page=\"Post\" backArrow={true} />\r\n            <div className=\"content\">\r\n                {post && myProfile ?\r\n                    <>\r\n                        <div className=\"post-container\">\r\n                            <div className=\"d-flex justify-content-between\">\r\n                                <div className=\"post-row\">\r\n                                    <div className=\"post-col\">\r\n                                        <Link to={post.author.id === myProfile.id ?\r\n                                            '/perfil' : `/user/${post.author.slug}`}\r\n                                        >\r\n                                            <img src={`${SERVER_URL}${post.author.photo}`}\r\n                                                className=\"profile-img-med\"\r\n                                            />\r\n                                        </Link>\r\n                                    </div>\r\n                                    <div className=\"post-col\">\r\n                                        <Link to={post.author.id === myProfile.id ?\r\n                                            '/perfil' : `/user/${post.author.slug}`}\r\n                                            style={{ color: '#000' }}\r\n                                        >\r\n                                            <div style={{ textAlign: 'start' }}>\r\n                                                <strong>{post.author.first_name} {post.author.last_name} </strong>\r\n                                                <p className=\"text-secondary d-inline-block\">\r\n                                                    @{post.author.user.username} • {post.created.split('-').reverse().join('/')}\r\n                                                </p>\r\n                                            </div>\r\n                                        </Link>\r\n                                        <div style={{ textAlign: 'start', fontSize: 'larger' }}>\r\n                                            {post.content}\r\n                                        </div>\r\n                                        {post.image &&\r\n                                            <img src={`${SERVER_URL}${post.image}`} className=\"post-img\" />\r\n                                        }\r\n                                    </div>\r\n                                </div>\r\n                                {myProfile.id == post.author.id &&\r\n                                    <i\r\n                                        className=\"far fa-trash-alt trash-icon text-secondary\"\r\n                                        style={{ margin: '20px 20px 0 0' }}\r\n                                        onClick={e => deletePost(e, post.id)}\r\n                                    />\r\n                                }\r\n                            </div>\r\n                            <div className=\"post-actions\">\r\n                                <p className=\"text-secondary\" style={{ fontSize: 'large' }}>\r\n                                    <Link to={`/post/${id}/comentar`} className=\"text-secondary\">\r\n                                        <i\r\n                                            class=\"far fa-comment\"\r\n                                        />\r\n                                    </Link>{post.comments.length}\r\n                                    {post.likes.map(like => like.profile.id).includes(myProfile.id) ?\r\n                                        <i class=\"fas fa-heart\"\r\n                                            data-postid={post.id}\r\n                                            onClick={likeUnlikePost}\r\n                                        />\r\n                                        :\r\n                                        <i class=\"far fa-heart\"\r\n                                            data-postid={post.id}\r\n                                            onClick={likeUnlikePost}\r\n                                        />\r\n                                    }\r\n                                    <p className=\"post-likes-number\"\r\n                                        onClick={() => setPostLikesModal({ isOpen: true, likes: post.likes })}\r\n                                    >\r\n                                        {post.likes.length}\r\n                                    </p>\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"comment-list\">\r\n                            {post.comments.map(comment => {\r\n                                return (\r\n                                    <CommentListItem\r\n                                        comment={comment}\r\n                                        myProfile={myProfile}\r\n                                        fetchPost={fetchPost}\r\n                                        setPostLikesModal={setPostLikesModal}\r\n                                    />\r\n                                )\r\n                            })\r\n                            }\r\n                        </div>\r\n                    </> :\r\n                    <div className=\"posts-loader-container\" >\r\n                        <div className=\"loader\" />\r\n                    </div>\r\n                }\r\n            </div>\r\n            <BottomMenu>\r\n                <CommentIcon postId={id} />\r\n            </BottomMenu>\r\n        </div>\r\n    )\r\n}"]},"metadata":{},"sourceType":"module"}