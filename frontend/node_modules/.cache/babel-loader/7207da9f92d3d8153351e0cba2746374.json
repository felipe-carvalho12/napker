{"ast":null,"code":"/*************************\r\n * Croppie\r\n * Copyright 2019\r\n * Foliotek\r\n * Version: 2.6.5\r\n *************************/\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define(factory);\n  } else if (typeof exports === 'object' && typeof exports.nodeName !== 'string') {\n    // CommonJS\n    module.exports = factory();\n  } else {\n    // Browser globals\n    root.Croppie = factory();\n  }\n})(typeof self !== 'undefined' ? self : this, function () {\n  /* Polyfills */\n  if (typeof Promise !== 'function') {\n    /*! promise-polyfill 3.1.0 */\n    !function (a) {\n      function b(a, b) {\n        return function () {\n          a.apply(b, arguments);\n        };\n      }\n\n      function c(a) {\n        if (\"object\" !== typeof this) throw new TypeError(\"Promises must be constructed via new\");\n        if (\"function\" !== typeof a) throw new TypeError(\"not a function\");\n        this._state = null, this._value = null, this._deferreds = [], i(a, b(e, this), b(f, this));\n      }\n\n      function d(a) {\n        var b = this;\n        return null === this._state ? void this._deferreds.push(a) : void k(function () {\n          var c = b._state ? a.onFulfilled : a.onRejected;\n          if (null === c) return void (b._state ? a.resolve : a.reject)(b._value);\n          var d;\n\n          try {\n            d = c(b._value);\n          } catch (e) {\n            return void a.reject(e);\n          }\n\n          a.resolve(d);\n        });\n      }\n\n      function e(a) {\n        try {\n          if (a === this) throw new TypeError(\"A promise cannot be resolved with itself.\");\n\n          if (a && (\"object\" === typeof a || \"function\" === typeof a)) {\n            var c = a.then;\n            if (\"function\" === typeof c) return void i(b(c, a), b(e, this), b(f, this));\n          }\n\n          this._state = !0, this._value = a, g.call(this);\n        } catch (d) {\n          f.call(this, d);\n        }\n      }\n\n      function f(a) {\n        this._state = !1, this._value = a, g.call(this);\n      }\n\n      function g() {\n        for (var a = 0, b = this._deferreds.length; b > a; a++) {\n          d.call(this, this._deferreds[a]);\n        }\n\n        this._deferreds = null;\n      }\n\n      function h(a, b, c, d) {\n        this.onFulfilled = \"function\" === typeof a ? a : null, this.onRejected = \"function\" === typeof b ? b : null, this.resolve = c, this.reject = d;\n      }\n\n      function i(a, b, c) {\n        var d = !1;\n\n        try {\n          a(function (a) {\n            d || (d = !0, b(a));\n          }, function (a) {\n            d || (d = !0, c(a));\n          });\n        } catch (e) {\n          if (d) return;\n          d = !0, c(e);\n        }\n      }\n\n      var j = setTimeout,\n          k = \"function\" === typeof setImmediate && setImmediate || function (a) {\n        j(a, 1);\n      },\n          l = Array.isArray || function (a) {\n        return \"[object Array]\" === Object.prototype.toString.call(a);\n      };\n\n      c.prototype[\"catch\"] = function (a) {\n        return this.then(null, a);\n      }, c.prototype.then = function (a, b) {\n        var e = this;\n        return new c(function (c, f) {\n          d.call(e, new h(a, b, c, f));\n        });\n      }, c.all = function () {\n        var a = Array.prototype.slice.call(1 === arguments.length && l(arguments[0]) ? arguments[0] : arguments);\n        return new c(function (b, c) {\n          function d(f, g) {\n            try {\n              if (g && (\"object\" === typeof g || \"function\" === typeof g)) {\n                var h = g.then;\n                if (\"function\" === typeof h) return void h.call(g, function (a) {\n                  d(f, a);\n                }, c);\n              }\n\n              a[f] = g, 0 === --e && b(a);\n            } catch (i) {\n              c(i);\n            }\n          }\n\n          if (0 === a.length) return b([]);\n\n          for (var e = a.length, f = 0; f < a.length; f++) {\n            d(f, a[f]);\n          }\n        });\n      }, c.resolve = function (a) {\n        return a && \"object\" === typeof a && a.constructor === c ? a : new c(function (b) {\n          b(a);\n        });\n      }, c.reject = function (a) {\n        return new c(function (b, c) {\n          c(a);\n        });\n      }, c.race = function (a) {\n        return new c(function (b, c) {\n          for (var d = 0, e = a.length; e > d; d++) {\n            a[d].then(b, c);\n          }\n        });\n      }, c._setImmediateFn = function (a) {\n        k = a;\n      }, \"undefined\" !== typeof module && module.exports ? module.exports = c : a.Promise || (a.Promise = c);\n    }(this);\n  }\n\n  if (typeof window !== 'undefined' && typeof window.CustomEvent !== \"function\") {\n    (function () {\n      function CustomEvent(event, params) {\n        params = params || {\n          bubbles: false,\n          cancelable: false,\n          detail: undefined\n        };\n        var evt = document.createEvent('CustomEvent');\n        evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n        return evt;\n      }\n\n      CustomEvent.prototype = window.Event.prototype;\n      window.CustomEvent = CustomEvent;\n    })();\n  }\n\n  if (typeof HTMLCanvasElement !== 'undefined' && !HTMLCanvasElement.prototype.toBlob) {\n    Object.defineProperty(HTMLCanvasElement.prototype, 'toBlob', {\n      value: function value(callback, type, quality) {\n        var binStr = atob(this.toDataURL(type, quality).split(',')[1]),\n            len = binStr.length,\n            arr = new Uint8Array(len);\n\n        for (var i = 0; i < len; i++) {\n          arr[i] = binStr.charCodeAt(i);\n        }\n\n        callback(new Blob([arr], {\n          type: type || 'image/png'\n        }));\n      }\n    });\n  }\n  /* End Polyfills */\n\n\n  var cssPrefixes = ['Webkit', 'Moz', 'ms'],\n      emptyStyles = typeof document !== 'undefined' ? document.createElement('div').style : {},\n      EXIF_NORM = [1, 8, 3, 6],\n      EXIF_FLIP = [2, 7, 4, 5],\n      CSS_TRANS_ORG,\n      CSS_TRANSFORM,\n      CSS_USERSELECT;\n\n  function vendorPrefix(prop) {\n    if (prop in emptyStyles) {\n      return prop;\n    }\n\n    var capProp = prop[0].toUpperCase() + prop.slice(1),\n        i = cssPrefixes.length;\n\n    while (i--) {\n      prop = cssPrefixes[i] + capProp;\n\n      if (prop in emptyStyles) {\n        return prop;\n      }\n    }\n  }\n\n  CSS_TRANSFORM = vendorPrefix('transform');\n  CSS_TRANS_ORG = vendorPrefix('transformOrigin');\n  CSS_USERSELECT = vendorPrefix('userSelect');\n\n  function getExifOffset(ornt, rotate) {\n    var arr = EXIF_NORM.indexOf(ornt) > -1 ? EXIF_NORM : EXIF_FLIP,\n        index = arr.indexOf(ornt),\n        offset = rotate / 90 % arr.length; // 180 = 2%4 = 2 shift exif by 2 indexes\n\n    return arr[(arr.length + index + offset % arr.length) % arr.length];\n  } // Credits to : Andrew Dupont - http://andrewdupont.net/2009/08/28/deep-extending-objects-in-javascript/\n\n\n  function deepExtend(destination, source) {\n    destination = destination || {};\n\n    for (var property in source) {\n      if (source[property] && source[property].constructor && source[property].constructor === Object) {\n        destination[property] = destination[property] || {};\n        deepExtend(destination[property], source[property]);\n      } else {\n        destination[property] = source[property];\n      }\n    }\n\n    return destination;\n  }\n\n  function clone(object) {\n    return deepExtend({}, object);\n  }\n\n  function debounce(func, wait, immediate) {\n    var timeout;\n    return function () {\n      var context = this,\n          args = arguments;\n\n      var later = function later() {\n        timeout = null;\n        if (!immediate) func.apply(context, args);\n      };\n\n      var callNow = immediate && !timeout;\n      clearTimeout(timeout);\n      timeout = setTimeout(later, wait);\n      if (callNow) func.apply(context, args);\n    };\n  }\n\n  function dispatchChange(element) {\n    if (\"createEvent\" in document) {\n      var evt = document.createEvent(\"HTMLEvents\");\n      evt.initEvent(\"change\", false, true);\n      element.dispatchEvent(evt);\n    } else {\n      element.fireEvent(\"onchange\");\n    }\n  } //http://jsperf.com/vanilla-css\n\n\n  function css(el, styles, val) {\n    if (typeof styles === 'string') {\n      var tmp = styles;\n      styles = {};\n      styles[tmp] = val;\n    }\n\n    for (var prop in styles) {\n      el.style[prop] = styles[prop];\n    }\n  }\n\n  function addClass(el, c) {\n    if (el.classList) {\n      el.classList.add(c);\n    } else {\n      el.className += ' ' + c;\n    }\n  }\n\n  function removeClass(el, c) {\n    if (el.classList) {\n      el.classList.remove(c);\n    } else {\n      el.className = el.className.replace(c, '');\n    }\n  }\n\n  function setAttributes(el, attrs) {\n    for (var key in attrs) {\n      el.setAttribute(key, attrs[key]);\n    }\n  }\n\n  function num(v) {\n    return parseInt(v, 10);\n  }\n  /* Utilities */\n\n\n  function loadImage(src, doExif) {\n    if (!src) {\n      throw 'Source image missing';\n    }\n\n    var img = new Image();\n    img.style.opacity = '0';\n    return new Promise(function (resolve, reject) {\n      function _resolve() {\n        img.style.opacity = '1';\n        setTimeout(function () {\n          resolve(img);\n        }, 1);\n      }\n\n      img.removeAttribute('crossOrigin');\n\n      if (src.match(/^https?:\\/\\/|^\\/\\//)) {\n        img.setAttribute('crossOrigin', 'anonymous');\n      }\n\n      img.onload = function () {\n        if (doExif) {\n          EXIF.getData(img, function () {\n            _resolve();\n          });\n        } else {\n          _resolve();\n        }\n      };\n\n      img.onerror = function (ev) {\n        img.style.opacity = 1;\n        setTimeout(function () {\n          reject(ev);\n        }, 1);\n      };\n\n      img.src = src;\n    });\n  }\n\n  function naturalImageDimensions(img, ornt) {\n    var w = img.naturalWidth;\n    var h = img.naturalHeight;\n    var orient = ornt || getExifOrientation(img);\n\n    if (orient && orient >= 5) {\n      var x = w;\n      w = h;\n      h = x;\n    }\n\n    return {\n      width: w,\n      height: h\n    };\n  }\n  /* CSS Transform Prototype */\n\n\n  var TRANSLATE_OPTS = {\n    'translate3d': {\n      suffix: ', 0px'\n    },\n    'translate': {\n      suffix: ''\n    }\n  };\n\n  var Transform = function Transform(x, y, scale) {\n    this.x = parseFloat(x);\n    this.y = parseFloat(y);\n    this.scale = parseFloat(scale);\n  };\n\n  Transform.parse = function (v) {\n    if (v.style) {\n      return Transform.parse(v.style[CSS_TRANSFORM]);\n    } else if (v.indexOf('matrix') > -1 || v.indexOf('none') > -1) {\n      return Transform.fromMatrix(v);\n    } else {\n      return Transform.fromString(v);\n    }\n  };\n\n  Transform.fromMatrix = function (v) {\n    var vals = v.substring(7).split(',');\n\n    if (!vals.length || v === 'none') {\n      vals = [1, 0, 0, 1, 0, 0];\n    }\n\n    return new Transform(num(vals[4]), num(vals[5]), parseFloat(vals[0]));\n  };\n\n  Transform.fromString = function (v) {\n    var values = v.split(') '),\n        translate = values[0].substring(Croppie.globals.translate.length + 1).split(','),\n        scale = values.length > 1 ? values[1].substring(6) : 1,\n        x = translate.length > 1 ? translate[0] : 0,\n        y = translate.length > 1 ? translate[1] : 0;\n    return new Transform(x, y, scale);\n  };\n\n  Transform.prototype.toString = function () {\n    var suffix = TRANSLATE_OPTS[Croppie.globals.translate].suffix || '';\n    return Croppie.globals.translate + '(' + this.x + 'px, ' + this.y + 'px' + suffix + ') scale(' + this.scale + ')';\n  };\n\n  var TransformOrigin = function TransformOrigin(el) {\n    if (!el || !el.style[CSS_TRANS_ORG]) {\n      this.x = 0;\n      this.y = 0;\n      return;\n    }\n\n    var css = el.style[CSS_TRANS_ORG].split(' ');\n    this.x = parseFloat(css[0]);\n    this.y = parseFloat(css[1]);\n  };\n\n  TransformOrigin.prototype.toString = function () {\n    return this.x + 'px ' + this.y + 'px';\n  };\n\n  function getExifOrientation(img) {\n    return img.exifdata && img.exifdata.Orientation ? num(img.exifdata.Orientation) : 1;\n  }\n\n  function drawCanvas(canvas, img, orientation) {\n    var width = img.width,\n        height = img.height,\n        ctx = canvas.getContext('2d');\n    canvas.width = img.width;\n    canvas.height = img.height;\n    ctx.save();\n\n    switch (orientation) {\n      case 2:\n        ctx.translate(width, 0);\n        ctx.scale(-1, 1);\n        break;\n\n      case 3:\n        ctx.translate(width, height);\n        ctx.rotate(180 * Math.PI / 180);\n        break;\n\n      case 4:\n        ctx.translate(0, height);\n        ctx.scale(1, -1);\n        break;\n\n      case 5:\n        canvas.width = height;\n        canvas.height = width;\n        ctx.rotate(90 * Math.PI / 180);\n        ctx.scale(1, -1);\n        break;\n\n      case 6:\n        canvas.width = height;\n        canvas.height = width;\n        ctx.rotate(90 * Math.PI / 180);\n        ctx.translate(0, -height);\n        break;\n\n      case 7:\n        canvas.width = height;\n        canvas.height = width;\n        ctx.rotate(-90 * Math.PI / 180);\n        ctx.translate(-width, height);\n        ctx.scale(1, -1);\n        break;\n\n      case 8:\n        canvas.width = height;\n        canvas.height = width;\n        ctx.translate(0, width);\n        ctx.rotate(-90 * Math.PI / 180);\n        break;\n    }\n\n    ctx.drawImage(img, 0, 0, width, height);\n    ctx.restore();\n  }\n  /* Private Methods */\n\n\n  function _create() {\n    var self = this,\n        contClass = 'croppie-container',\n        customViewportClass = self.options.viewport.type ? 'cr-vp-' + self.options.viewport.type : null,\n        boundary,\n        img,\n        viewport,\n        overlay,\n        bw,\n        bh;\n    self.options.useCanvas = self.options.enableOrientation || _hasExif.call(self); // Properties on class\n\n    self.data = {};\n    self.elements = {};\n    boundary = self.elements.boundary = document.createElement('div');\n    viewport = self.elements.viewport = document.createElement('div');\n    img = self.elements.img = document.createElement('img');\n    overlay = self.elements.overlay = document.createElement('div');\n\n    if (self.options.useCanvas) {\n      self.elements.canvas = document.createElement('canvas');\n      self.elements.preview = self.elements.canvas;\n    } else {\n      self.elements.preview = img;\n    }\n\n    addClass(boundary, 'cr-boundary');\n    boundary.setAttribute('aria-dropeffect', 'none');\n    bw = self.options.boundary.width;\n    bh = self.options.boundary.height;\n    css(boundary, {\n      width: bw + (isNaN(bw) ? '' : 'px'),\n      height: bh + (isNaN(bh) ? '' : 'px')\n    });\n    addClass(viewport, 'cr-viewport');\n\n    if (customViewportClass) {\n      addClass(viewport, customViewportClass);\n    }\n\n    css(viewport, {\n      width: self.options.viewport.width + 'px',\n      height: self.options.viewport.height + 'px'\n    });\n    viewport.setAttribute('tabindex', 0);\n    addClass(self.elements.preview, 'cr-image');\n    setAttributes(self.elements.preview, {\n      'alt': 'preview',\n      'aria-grabbed': 'false'\n    });\n    addClass(overlay, 'cr-overlay');\n    self.element.appendChild(boundary);\n    boundary.appendChild(self.elements.preview);\n    boundary.appendChild(viewport);\n    boundary.appendChild(overlay);\n    addClass(self.element, contClass);\n\n    if (self.options.customClass) {\n      addClass(self.element, self.options.customClass);\n    }\n\n    _initDraggable.call(this);\n\n    if (self.options.enableZoom) {\n      _initializeZoom.call(self);\n    } // if (self.options.enableOrientation) {\n    //     _initRotationControls.call(self);\n    // }\n\n\n    if (self.options.enableResize) {\n      _initializeResize.call(self);\n    }\n  } // function _initRotationControls () {\n  //     var self = this,\n  //         wrap, btnLeft, btnRight, iLeft, iRight;\n  //     wrap = document.createElement('div');\n  //     self.elements.orientationBtnLeft = btnLeft = document.createElement('button');\n  //     self.elements.orientationBtnRight = btnRight = document.createElement('button');\n  //     wrap.appendChild(btnLeft);\n  //     wrap.appendChild(btnRight);\n  //     iLeft = document.createElement('i');\n  //     iRight = document.createElement('i');\n  //     btnLeft.appendChild(iLeft);\n  //     btnRight.appendChild(iRight);\n  //     addClass(wrap, 'cr-rotate-controls');\n  //     addClass(btnLeft, 'cr-rotate-l');\n  //     addClass(btnRight, 'cr-rotate-r');\n  //     self.elements.boundary.appendChild(wrap);\n  //     btnLeft.addEventListener('click', function () {\n  //         self.rotate(-90);\n  //     });\n  //     btnRight.addEventListener('click', function () {\n  //         self.rotate(90);\n  //     });\n  // }\n\n\n  function _hasExif() {\n    return this.options.enableExif && window.EXIF;\n  }\n\n  function _initializeResize() {\n    var self = this;\n    var wrap = document.createElement('div');\n    var isDragging = false;\n    var direction;\n    var originalX;\n    var originalY;\n    var minSize = 50;\n    var maxWidth;\n    var maxHeight;\n    var vr;\n    var hr;\n    addClass(wrap, 'cr-resizer');\n    css(wrap, {\n      width: this.options.viewport.width + 'px',\n      height: this.options.viewport.height + 'px'\n    });\n\n    if (this.options.resizeControls.height) {\n      vr = document.createElement('div');\n      addClass(vr, 'cr-resizer-vertical');\n      wrap.appendChild(vr);\n    }\n\n    if (this.options.resizeControls.width) {\n      hr = document.createElement('div');\n      addClass(hr, 'cr-resizer-horisontal');\n      wrap.appendChild(hr);\n    }\n\n    function mouseDown(ev) {\n      if (ev.button !== undefined && ev.button !== 0) return;\n      ev.preventDefault();\n\n      if (isDragging) {\n        return;\n      }\n\n      var overlayRect = self.elements.overlay.getBoundingClientRect();\n      isDragging = true;\n      originalX = ev.pageX;\n      originalY = ev.pageY;\n      direction = ev.currentTarget.className.indexOf('vertical') !== -1 ? 'v' : 'h';\n      maxWidth = overlayRect.width;\n      maxHeight = overlayRect.height;\n\n      if (ev.touches) {\n        var touches = ev.touches[0];\n        originalX = touches.pageX;\n        originalY = touches.pageY;\n      }\n\n      window.addEventListener('mousemove', mouseMove);\n      window.addEventListener('touchmove', mouseMove);\n      window.addEventListener('mouseup', mouseUp);\n      window.addEventListener('touchend', mouseUp);\n      document.body.style[CSS_USERSELECT] = 'none';\n    }\n\n    function mouseMove(ev) {\n      var pageX = ev.pageX;\n      var pageY = ev.pageY;\n      ev.preventDefault();\n\n      if (ev.touches) {\n        var touches = ev.touches[0];\n        pageX = touches.pageX;\n        pageY = touches.pageY;\n      }\n\n      var deltaX = pageX - originalX;\n      var deltaY = pageY - originalY;\n      var newHeight = self.options.viewport.height + deltaY;\n      var newWidth = self.options.viewport.width + deltaX;\n\n      if (direction === 'v' && newHeight >= minSize && newHeight <= maxHeight) {\n        css(wrap, {\n          height: newHeight + 'px'\n        });\n        self.options.boundary.height += deltaY;\n        css(self.elements.boundary, {\n          height: self.options.boundary.height + 'px'\n        });\n        self.options.viewport.height += deltaY;\n        css(self.elements.viewport, {\n          height: self.options.viewport.height + 'px'\n        });\n      } else if (direction === 'h' && newWidth >= minSize && newWidth <= maxWidth) {\n        css(wrap, {\n          width: newWidth + 'px'\n        });\n        self.options.boundary.width += deltaX;\n        css(self.elements.boundary, {\n          width: self.options.boundary.width + 'px'\n        });\n        self.options.viewport.width += deltaX;\n        css(self.elements.viewport, {\n          width: self.options.viewport.width + 'px'\n        });\n      }\n\n      _updateOverlay.call(self);\n\n      _updateZoomLimits.call(self);\n\n      _updateCenterPoint.call(self);\n\n      _triggerUpdate.call(self);\n\n      originalY = pageY;\n      originalX = pageX;\n    }\n\n    function mouseUp() {\n      isDragging = false;\n      window.removeEventListener('mousemove', mouseMove);\n      window.removeEventListener('touchmove', mouseMove);\n      window.removeEventListener('mouseup', mouseUp);\n      window.removeEventListener('touchend', mouseUp);\n      document.body.style[CSS_USERSELECT] = '';\n    }\n\n    if (vr) {\n      vr.addEventListener('mousedown', mouseDown);\n      vr.addEventListener('touchstart', mouseDown);\n    }\n\n    if (hr) {\n      hr.addEventListener('mousedown', mouseDown);\n      hr.addEventListener('touchstart', mouseDown);\n    }\n\n    this.elements.boundary.appendChild(wrap);\n  }\n\n  function _setZoomerVal(v) {\n    if (this.options.enableZoom) {\n      var z = this.elements.zoomer,\n          val = fix(v, 4);\n      z.value = Math.max(parseFloat(z.min), Math.min(parseFloat(z.max), val)).toString();\n    }\n  }\n\n  function _initializeZoom() {\n    var self = this,\n        wrap = self.elements.zoomerWrap = document.createElement('div'),\n        zoomer = self.elements.zoomer = document.createElement('input');\n    addClass(wrap, 'cr-slider-wrap');\n    addClass(zoomer, 'cr-slider');\n    zoomer.type = 'range';\n    zoomer.step = '0.0001';\n    zoomer.value = '1';\n    zoomer.style.display = self.options.showZoomer ? '' : 'none';\n    zoomer.setAttribute('aria-label', 'zoom');\n    self.element.appendChild(wrap);\n    wrap.appendChild(zoomer);\n    self._currentZoom = 1;\n\n    function change() {\n      _onZoom.call(self, {\n        value: parseFloat(zoomer.value),\n        origin: new TransformOrigin(self.elements.preview),\n        viewportRect: self.elements.viewport.getBoundingClientRect(),\n        transform: Transform.parse(self.elements.preview)\n      });\n    }\n\n    function scroll(ev) {\n      var delta, targetZoom;\n\n      if (self.options.mouseWheelZoom === 'ctrl' && ev.ctrlKey !== true) {\n        return 0;\n      } else if (ev.wheelDelta) {\n        delta = ev.wheelDelta / 1200; //wheelDelta min: -120 max: 120 // max x 10 x 2\n      } else if (ev.deltaY) {\n        delta = ev.deltaY / 1060; //deltaY min: -53 max: 53 // max x 10 x 2\n      } else if (ev.detail) {\n        delta = ev.detail / -60; //delta min: -3 max: 3 // max x 10 x 2\n      } else {\n        delta = 0;\n      }\n\n      targetZoom = self._currentZoom + delta * self._currentZoom;\n      ev.preventDefault();\n\n      _setZoomerVal.call(self, targetZoom);\n\n      change.call(self);\n    }\n\n    self.elements.zoomer.addEventListener('input', change); // this is being fired twice on keypress\n\n    self.elements.zoomer.addEventListener('change', change);\n\n    if (self.options.mouseWheelZoom) {\n      self.elements.boundary.addEventListener('mousewheel', scroll);\n      self.elements.boundary.addEventListener('DOMMouseScroll', scroll);\n    }\n  }\n\n  function _onZoom(ui) {\n    var self = this,\n        transform = ui ? ui.transform : Transform.parse(self.elements.preview),\n        vpRect = ui ? ui.viewportRect : self.elements.viewport.getBoundingClientRect(),\n        origin = ui ? ui.origin : new TransformOrigin(self.elements.preview);\n\n    function applyCss() {\n      var transCss = {};\n      transCss[CSS_TRANSFORM] = transform.toString();\n      transCss[CSS_TRANS_ORG] = origin.toString();\n      css(self.elements.preview, transCss);\n    }\n\n    self._currentZoom = ui ? ui.value : self._currentZoom;\n    transform.scale = self._currentZoom;\n    self.elements.zoomer.setAttribute('aria-valuenow', self._currentZoom);\n    applyCss();\n\n    if (self.options.enforceBoundary) {\n      var boundaries = _getVirtualBoundaries.call(self, vpRect),\n          transBoundaries = boundaries.translate,\n          oBoundaries = boundaries.origin;\n\n      if (transform.x >= transBoundaries.maxX) {\n        origin.x = oBoundaries.minX;\n        transform.x = transBoundaries.maxX;\n      }\n\n      if (transform.x <= transBoundaries.minX) {\n        origin.x = oBoundaries.maxX;\n        transform.x = transBoundaries.minX;\n      }\n\n      if (transform.y >= transBoundaries.maxY) {\n        origin.y = oBoundaries.minY;\n        transform.y = transBoundaries.maxY;\n      }\n\n      if (transform.y <= transBoundaries.minY) {\n        origin.y = oBoundaries.maxY;\n        transform.y = transBoundaries.minY;\n      }\n    }\n\n    applyCss();\n\n    _debouncedOverlay.call(self);\n\n    _triggerUpdate.call(self);\n  }\n\n  function _getVirtualBoundaries(viewport) {\n    var self = this,\n        scale = self._currentZoom,\n        vpWidth = viewport.width,\n        vpHeight = viewport.height,\n        centerFromBoundaryX = self.elements.boundary.clientWidth / 2,\n        centerFromBoundaryY = self.elements.boundary.clientHeight / 2,\n        imgRect = self.elements.preview.getBoundingClientRect(),\n        curImgWidth = imgRect.width,\n        curImgHeight = imgRect.height,\n        halfWidth = vpWidth / 2,\n        halfHeight = vpHeight / 2;\n    var maxX = (halfWidth / scale - centerFromBoundaryX) * -1;\n    var minX = maxX - (curImgWidth * (1 / scale) - vpWidth * (1 / scale));\n    var maxY = (halfHeight / scale - centerFromBoundaryY) * -1;\n    var minY = maxY - (curImgHeight * (1 / scale) - vpHeight * (1 / scale));\n    var originMinX = 1 / scale * halfWidth;\n    var originMaxX = curImgWidth * (1 / scale) - originMinX;\n    var originMinY = 1 / scale * halfHeight;\n    var originMaxY = curImgHeight * (1 / scale) - originMinY;\n    return {\n      translate: {\n        maxX: maxX,\n        minX: minX,\n        maxY: maxY,\n        minY: minY\n      },\n      origin: {\n        maxX: originMaxX,\n        minX: originMinX,\n        maxY: originMaxY,\n        minY: originMinY\n      }\n    };\n  }\n\n  function _updateCenterPoint(rotate) {\n    var self = this,\n        scale = self._currentZoom,\n        data = self.elements.preview.getBoundingClientRect(),\n        vpData = self.elements.viewport.getBoundingClientRect(),\n        transform = Transform.parse(self.elements.preview.style[CSS_TRANSFORM]),\n        pc = new TransformOrigin(self.elements.preview),\n        top = vpData.top - data.top + vpData.height / 2,\n        left = vpData.left - data.left + vpData.width / 2,\n        center = {},\n        adj = {};\n\n    if (rotate) {\n      var cx = pc.x;\n      var cy = pc.y;\n      var tx = transform.x;\n      var ty = transform.y;\n      center.y = cx;\n      center.x = cy;\n      transform.y = tx;\n      transform.x = ty;\n    } else {\n      center.y = top / scale;\n      center.x = left / scale;\n      adj.y = (center.y - pc.y) * (1 - scale);\n      adj.x = (center.x - pc.x) * (1 - scale);\n      transform.x -= adj.x;\n      transform.y -= adj.y;\n    }\n\n    var newCss = {};\n    newCss[CSS_TRANS_ORG] = center.x + 'px ' + center.y + 'px';\n    newCss[CSS_TRANSFORM] = transform.toString();\n    css(self.elements.preview, newCss);\n  }\n\n  function _initDraggable() {\n    var self = this,\n        isDragging = false,\n        originalX,\n        originalY,\n        originalDistance,\n        vpRect,\n        transform;\n\n    function assignTransformCoordinates(deltaX, deltaY) {\n      var imgRect = self.elements.preview.getBoundingClientRect(),\n          top = transform.y + deltaY,\n          left = transform.x + deltaX;\n\n      if (self.options.enforceBoundary) {\n        if (vpRect.top > imgRect.top + deltaY && vpRect.bottom < imgRect.bottom + deltaY) {\n          transform.y = top;\n        }\n\n        if (vpRect.left > imgRect.left + deltaX && vpRect.right < imgRect.right + deltaX) {\n          transform.x = left;\n        }\n      } else {\n        transform.y = top;\n        transform.x = left;\n      }\n    }\n\n    function toggleGrabState(isDragging) {\n      self.elements.preview.setAttribute('aria-grabbed', isDragging);\n      self.elements.boundary.setAttribute('aria-dropeffect', isDragging ? 'move' : 'none');\n    }\n\n    function keyDown(ev) {\n      var LEFT_ARROW = 37,\n          UP_ARROW = 38,\n          RIGHT_ARROW = 39,\n          DOWN_ARROW = 40;\n\n      if (ev.shiftKey && (ev.keyCode === UP_ARROW || ev.keyCode === DOWN_ARROW)) {\n        var zoom;\n\n        if (ev.keyCode === UP_ARROW) {\n          zoom = parseFloat(self.elements.zoomer.value) + parseFloat(self.elements.zoomer.step);\n        } else {\n          zoom = parseFloat(self.elements.zoomer.value) - parseFloat(self.elements.zoomer.step);\n        }\n\n        self.setZoom(zoom);\n      } else if (self.options.enableKeyMovement && ev.keyCode >= 37 && ev.keyCode <= 40) {\n        ev.preventDefault();\n        var movement = parseKeyDown(ev.keyCode);\n        transform = Transform.parse(self.elements.preview);\n        document.body.style[CSS_USERSELECT] = 'none';\n        vpRect = self.elements.viewport.getBoundingClientRect();\n        keyMove(movement);\n      }\n\n      function parseKeyDown(key) {\n        switch (key) {\n          case LEFT_ARROW:\n            return [1, 0];\n\n          case UP_ARROW:\n            return [0, 1];\n\n          case RIGHT_ARROW:\n            return [-1, 0];\n\n          case DOWN_ARROW:\n            return [0, -1];\n        }\n      }\n    }\n\n    function keyMove(movement) {\n      var deltaX = movement[0],\n          deltaY = movement[1],\n          newCss = {};\n      assignTransformCoordinates(deltaX, deltaY);\n      newCss[CSS_TRANSFORM] = transform.toString();\n      css(self.elements.preview, newCss);\n\n      _updateOverlay.call(self);\n\n      document.body.style[CSS_USERSELECT] = '';\n\n      _updateCenterPoint.call(self);\n\n      _triggerUpdate.call(self);\n\n      originalDistance = 0;\n    }\n\n    function mouseDown(ev) {\n      if (ev.button !== undefined && ev.button !== 0) return;\n      ev.preventDefault();\n      if (isDragging) return;\n      isDragging = true;\n      originalX = ev.pageX;\n      originalY = ev.pageY;\n\n      if (ev.touches) {\n        var touches = ev.touches[0];\n        originalX = touches.pageX;\n        originalY = touches.pageY;\n      }\n\n      toggleGrabState(isDragging);\n      transform = Transform.parse(self.elements.preview);\n      window.addEventListener('mousemove', mouseMove);\n      window.addEventListener('touchmove', mouseMove);\n      window.addEventListener('mouseup', mouseUp);\n      window.addEventListener('touchend', mouseUp);\n      document.body.style[CSS_USERSELECT] = 'none';\n      vpRect = self.elements.viewport.getBoundingClientRect();\n    }\n\n    function mouseMove(ev) {\n      ev.preventDefault();\n      var pageX = ev.pageX,\n          pageY = ev.pageY;\n\n      if (ev.touches) {\n        var touches = ev.touches[0];\n        pageX = touches.pageX;\n        pageY = touches.pageY;\n      }\n\n      var deltaX = pageX - originalX,\n          deltaY = pageY - originalY,\n          newCss = {};\n\n      if (ev.type === 'touchmove') {\n        if (ev.touches.length > 1) {\n          var touch1 = ev.touches[0];\n          var touch2 = ev.touches[1];\n          var dist = Math.sqrt((touch1.pageX - touch2.pageX) * (touch1.pageX - touch2.pageX) + (touch1.pageY - touch2.pageY) * (touch1.pageY - touch2.pageY));\n\n          if (!originalDistance) {\n            originalDistance = dist / self._currentZoom;\n          }\n\n          var scale = dist / originalDistance;\n\n          _setZoomerVal.call(self, scale);\n\n          dispatchChange(self.elements.zoomer);\n          return;\n        }\n      }\n\n      assignTransformCoordinates(deltaX, deltaY);\n      newCss[CSS_TRANSFORM] = transform.toString();\n      css(self.elements.preview, newCss);\n\n      _updateOverlay.call(self);\n\n      originalY = pageY;\n      originalX = pageX;\n    }\n\n    function mouseUp() {\n      isDragging = false;\n      toggleGrabState(isDragging);\n      window.removeEventListener('mousemove', mouseMove);\n      window.removeEventListener('touchmove', mouseMove);\n      window.removeEventListener('mouseup', mouseUp);\n      window.removeEventListener('touchend', mouseUp);\n      document.body.style[CSS_USERSELECT] = '';\n\n      _updateCenterPoint.call(self);\n\n      _triggerUpdate.call(self);\n\n      originalDistance = 0;\n    }\n\n    self.elements.overlay.addEventListener('mousedown', mouseDown);\n    self.elements.viewport.addEventListener('keydown', keyDown);\n    self.elements.overlay.addEventListener('touchstart', mouseDown);\n  }\n\n  function _updateOverlay() {\n    if (!this.elements) return; // since this is debounced, it can be fired after destroy\n\n    var self = this,\n        boundRect = self.elements.boundary.getBoundingClientRect(),\n        imgData = self.elements.preview.getBoundingClientRect();\n    css(self.elements.overlay, {\n      width: imgData.width + 'px',\n      height: imgData.height + 'px',\n      top: imgData.top - boundRect.top + 'px',\n      left: imgData.left - boundRect.left + 'px'\n    });\n  }\n\n  var _debouncedOverlay = debounce(_updateOverlay, 500);\n\n  function _triggerUpdate() {\n    var self = this,\n        data = self.get();\n\n    if (!_isVisible.call(self)) {\n      return;\n    }\n\n    self.options.update.call(self, data);\n\n    if (self.$ && typeof Prototype === 'undefined') {\n      self.$(self.element).trigger('update.croppie', data);\n    } else {\n      var ev;\n\n      if (window.CustomEvent) {\n        ev = new CustomEvent('update', {\n          detail: data\n        });\n      } else {\n        ev = document.createEvent('CustomEvent');\n        ev.initCustomEvent('update', true, true, data);\n      }\n\n      self.element.dispatchEvent(ev);\n    }\n  }\n\n  function _isVisible() {\n    return this.elements.preview.offsetHeight > 0 && this.elements.preview.offsetWidth > 0;\n  }\n\n  function _updatePropertiesFromImage() {\n    var self = this,\n        initialZoom = 1,\n        cssReset = {},\n        img = self.elements.preview,\n        imgData,\n        transformReset = new Transform(0, 0, initialZoom),\n        originReset = new TransformOrigin(),\n        isVisible = _isVisible.call(self);\n\n    if (!isVisible || self.data.bound) {\n      // if the croppie isn't visible or it doesn't need binding\n      return;\n    }\n\n    self.data.bound = true;\n    cssReset[CSS_TRANSFORM] = transformReset.toString();\n    cssReset[CSS_TRANS_ORG] = originReset.toString();\n    cssReset['opacity'] = 1;\n    css(img, cssReset);\n    imgData = self.elements.preview.getBoundingClientRect();\n    self._originalImageWidth = imgData.width;\n    self._originalImageHeight = imgData.height;\n    self.data.orientation = _hasExif.call(self) ? getExifOrientation(self.elements.img) : self.data.orientation;\n\n    if (self.options.enableZoom) {\n      _updateZoomLimits.call(self, true);\n    } else {\n      self._currentZoom = initialZoom;\n    }\n\n    transformReset.scale = self._currentZoom;\n    cssReset[CSS_TRANSFORM] = transformReset.toString();\n    css(img, cssReset);\n\n    if (self.data.points.length) {\n      _bindPoints.call(self, self.data.points);\n    } else {\n      _centerImage.call(self);\n    }\n\n    _updateCenterPoint.call(self);\n\n    _updateOverlay.call(self);\n  }\n\n  function _updateZoomLimits(initial) {\n    var self = this,\n        minZoom = Math.max(self.options.minZoom, 0) || 0,\n        maxZoom = self.options.maxZoom || 1.5,\n        initialZoom,\n        defaultInitialZoom,\n        zoomer = self.elements.zoomer,\n        scale = parseFloat(zoomer.value),\n        boundaryData = self.elements.boundary.getBoundingClientRect(),\n        imgData = naturalImageDimensions(self.elements.img, self.data.orientation),\n        vpData = self.elements.viewport.getBoundingClientRect(),\n        minW,\n        minH;\n\n    if (self.options.enforceBoundary) {\n      minW = vpData.width / imgData.width;\n      minH = vpData.height / imgData.height;\n      minZoom = Math.max(minW, minH);\n    }\n\n    if (minZoom >= maxZoom) {\n      maxZoom = minZoom + 1;\n    }\n\n    zoomer.min = fix(minZoom, 4);\n    zoomer.max = fix(maxZoom, 4);\n\n    if (!initial && (scale < zoomer.min || scale > zoomer.max)) {\n      _setZoomerVal.call(self, scale < zoomer.min ? zoomer.min : zoomer.max);\n    } else if (initial) {\n      defaultInitialZoom = Math.max(boundaryData.width / imgData.width, boundaryData.height / imgData.height);\n      initialZoom = self.data.boundZoom !== null ? self.data.boundZoom : defaultInitialZoom;\n\n      _setZoomerVal.call(self, initialZoom);\n    }\n\n    dispatchChange(zoomer);\n  }\n\n  function _bindPoints(points) {\n    if (points.length !== 4) {\n      throw \"Croppie - Invalid number of points supplied: \" + points;\n    }\n\n    var self = this,\n        pointsWidth = points[2] - points[0],\n        // pointsHeight = points[3] - points[1],\n    vpData = self.elements.viewport.getBoundingClientRect(),\n        boundRect = self.elements.boundary.getBoundingClientRect(),\n        vpOffset = {\n      left: vpData.left - boundRect.left,\n      top: vpData.top - boundRect.top\n    },\n        scale = vpData.width / pointsWidth,\n        originTop = points[1],\n        originLeft = points[0],\n        transformTop = -1 * points[1] + vpOffset.top,\n        transformLeft = -1 * points[0] + vpOffset.left,\n        newCss = {};\n    newCss[CSS_TRANS_ORG] = originLeft + 'px ' + originTop + 'px';\n    newCss[CSS_TRANSFORM] = new Transform(transformLeft, transformTop, scale).toString();\n    css(self.elements.preview, newCss);\n\n    _setZoomerVal.call(self, scale);\n\n    self._currentZoom = scale;\n  }\n\n  function _centerImage() {\n    var self = this,\n        imgDim = self.elements.preview.getBoundingClientRect(),\n        vpDim = self.elements.viewport.getBoundingClientRect(),\n        boundDim = self.elements.boundary.getBoundingClientRect(),\n        vpLeft = vpDim.left - boundDim.left,\n        vpTop = vpDim.top - boundDim.top,\n        w = vpLeft - (imgDim.width - vpDim.width) / 2,\n        h = vpTop - (imgDim.height - vpDim.height) / 2,\n        transform = new Transform(w, h, self._currentZoom);\n    css(self.elements.preview, CSS_TRANSFORM, transform.toString());\n  }\n\n  function _transferImageToCanvas(customOrientation) {\n    var self = this,\n        canvas = self.elements.canvas,\n        img = self.elements.img,\n        ctx = canvas.getContext('2d');\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    canvas.width = img.width;\n    canvas.height = img.height;\n    var orientation = self.options.enableOrientation && customOrientation || getExifOrientation(img);\n    drawCanvas(canvas, img, orientation);\n  }\n\n  function _getCanvas(data) {\n    var self = this,\n        points = data.points,\n        left = num(points[0]),\n        top = num(points[1]),\n        right = num(points[2]),\n        bottom = num(points[3]),\n        width = right - left,\n        height = bottom - top,\n        circle = data.circle,\n        canvas = document.createElement('canvas'),\n        ctx = canvas.getContext('2d'),\n        startX = 0,\n        startY = 0,\n        canvasWidth = data.outputWidth || width,\n        canvasHeight = data.outputHeight || height;\n    canvas.width = canvasWidth;\n    canvas.height = canvasHeight;\n\n    if (data.backgroundColor) {\n      ctx.fillStyle = data.backgroundColor;\n      ctx.fillRect(0, 0, canvasWidth, canvasHeight);\n    } // By default assume we're going to draw the entire\n    // source image onto the destination canvas.\n\n\n    var sx = left,\n        sy = top,\n        sWidth = width,\n        sHeight = height,\n        dx = 0,\n        dy = 0,\n        dWidth = canvasWidth,\n        dHeight = canvasHeight; //\n    // Do not go outside of the original image's bounds along the x-axis.\n    // Handle translations when projecting onto the destination canvas.\n    //\n    // The smallest possible source x-position is 0.\n\n    if (left < 0) {\n      sx = 0;\n      dx = Math.abs(left) / width * canvasWidth;\n    } // The largest possible source width is the original image's width.\n\n\n    if (sWidth + sx > self._originalImageWidth) {\n      sWidth = self._originalImageWidth - sx;\n      dWidth = sWidth / width * canvasWidth;\n    } //\n    // Do not go outside of the original image's bounds along the y-axis.\n    //\n    // The smallest possible source y-position is 0.\n\n\n    if (top < 0) {\n      sy = 0;\n      dy = Math.abs(top) / height * canvasHeight;\n    } // The largest possible source height is the original image's height.\n\n\n    if (sHeight + sy > self._originalImageHeight) {\n      sHeight = self._originalImageHeight - sy;\n      dHeight = sHeight / height * canvasHeight;\n    } // console.table({ left, right, top, bottom, canvasWidth, canvasHeight, width, height, startX, startY, circle, sx, sy, dx, dy, sWidth, sHeight, dWidth, dHeight });\n\n\n    ctx.drawImage(this.elements.preview, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight);\n\n    if (circle) {\n      ctx.fillStyle = '#fff';\n      ctx.globalCompositeOperation = 'destination-in';\n      ctx.beginPath();\n      ctx.arc(canvas.width / 2, canvas.height / 2, canvas.width / 2, 0, Math.PI * 2, true);\n      ctx.closePath();\n      ctx.fill();\n    }\n\n    return canvas;\n  }\n\n  function _getHtmlResult(data) {\n    var points = data.points,\n        div = document.createElement('div'),\n        img = document.createElement('img'),\n        width = points[2] - points[0],\n        height = points[3] - points[1];\n    addClass(div, 'croppie-result');\n    div.appendChild(img);\n    css(img, {\n      left: -1 * points[0] + 'px',\n      top: -1 * points[1] + 'px'\n    });\n    img.src = data.url;\n    css(div, {\n      width: width + 'px',\n      height: height + 'px'\n    });\n    return div;\n  }\n\n  function _getBase64Result(data) {\n    return _getCanvas.call(this, data).toDataURL(data.format, data.quality);\n  }\n\n  function _getBlobResult(data) {\n    var self = this;\n    return new Promise(function (resolve) {\n      _getCanvas.call(self, data).toBlob(function (blob) {\n        resolve(blob);\n      }, data.format, data.quality);\n    });\n  }\n\n  function _replaceImage(img) {\n    if (this.elements.img.parentNode) {\n      Array.prototype.forEach.call(this.elements.img.classList, function (c) {\n        img.classList.add(c);\n      });\n      this.elements.img.parentNode.replaceChild(img, this.elements.img);\n      this.elements.preview = img; // if the img is attached to the DOM, they're not using the canvas\n    }\n\n    this.elements.img = img;\n  }\n\n  function _bind(options, cb) {\n    var self = this,\n        url,\n        points = [],\n        zoom = null,\n        hasExif = _hasExif.call(self);\n\n    if (typeof options === 'string') {\n      url = options;\n      options = {};\n    } else if (Array.isArray(options)) {\n      points = options.slice();\n    } else if (typeof options === 'undefined' && self.data.url) {\n      //refreshing\n      _updatePropertiesFromImage.call(self);\n\n      _triggerUpdate.call(self);\n\n      return null;\n    } else {\n      url = options.url;\n      points = options.points || [];\n      zoom = typeof options.zoom === 'undefined' ? null : options.zoom;\n    }\n\n    self.data.bound = false;\n    self.data.url = url || self.data.url;\n    self.data.boundZoom = zoom;\n    return loadImage(url, hasExif).then(function (img) {\n      _replaceImage.call(self, img);\n\n      if (!points.length) {\n        var natDim = naturalImageDimensions(img);\n        var rect = self.elements.viewport.getBoundingClientRect();\n        var aspectRatio = rect.width / rect.height;\n        var imgAspectRatio = natDim.width / natDim.height;\n        var width, height;\n\n        if (imgAspectRatio > aspectRatio) {\n          height = natDim.height;\n          width = height * aspectRatio;\n        } else {\n          width = natDim.width;\n          height = natDim.height / aspectRatio;\n        }\n\n        var x0 = (natDim.width - width) / 2;\n        var y0 = (natDim.height - height) / 2;\n        var x1 = x0 + width;\n        var y1 = y0 + height;\n        self.data.points = [x0, y0, x1, y1];\n      } else if (self.options.relative) {\n        points = [points[0] * img.naturalWidth / 100, points[1] * img.naturalHeight / 100, points[2] * img.naturalWidth / 100, points[3] * img.naturalHeight / 100];\n      }\n\n      self.data.orientation = options.orientation || 1;\n      self.data.points = points.map(function (p) {\n        return parseFloat(p);\n      });\n\n      if (self.options.useCanvas) {\n        _transferImageToCanvas.call(self, self.data.orientation);\n      }\n\n      _updatePropertiesFromImage.call(self);\n\n      _triggerUpdate.call(self);\n\n      cb && cb();\n    });\n  }\n\n  function fix(v, decimalPoints) {\n    return parseFloat(v).toFixed(decimalPoints || 0);\n  }\n\n  function _get() {\n    var self = this,\n        imgData = self.elements.preview.getBoundingClientRect(),\n        vpData = self.elements.viewport.getBoundingClientRect(),\n        x1 = vpData.left - imgData.left,\n        y1 = vpData.top - imgData.top,\n        widthDiff = (vpData.width - self.elements.viewport.offsetWidth) / 2,\n        //border\n    heightDiff = (vpData.height - self.elements.viewport.offsetHeight) / 2,\n        x2 = x1 + self.elements.viewport.offsetWidth + widthDiff,\n        y2 = y1 + self.elements.viewport.offsetHeight + heightDiff,\n        scale = self._currentZoom;\n\n    if (scale === Infinity || isNaN(scale)) {\n      scale = 1;\n    }\n\n    var max = self.options.enforceBoundary ? 0 : Number.NEGATIVE_INFINITY;\n    x1 = Math.max(max, x1 / scale);\n    y1 = Math.max(max, y1 / scale);\n    x2 = Math.max(max, x2 / scale);\n    y2 = Math.max(max, y2 / scale);\n    return {\n      points: [fix(x1), fix(y1), fix(x2), fix(y2)],\n      zoom: scale,\n      orientation: self.data.orientation\n    };\n  }\n\n  var RESULT_DEFAULTS = {\n    type: 'canvas',\n    format: 'png',\n    quality: 1\n  },\n      RESULT_FORMATS = ['jpeg', 'webp', 'png'];\n\n  function _result(options) {\n    var self = this,\n        data = _get.call(self),\n        opts = deepExtend(clone(RESULT_DEFAULTS), clone(options)),\n        resultType = typeof options === 'string' ? options : opts.type || 'base64',\n        size = opts.size || 'viewport',\n        format = opts.format,\n        quality = opts.quality,\n        backgroundColor = opts.backgroundColor,\n        circle = typeof opts.circle === 'boolean' ? opts.circle : self.options.viewport.type === 'circle',\n        vpRect = self.elements.viewport.getBoundingClientRect(),\n        ratio = vpRect.width / vpRect.height,\n        prom;\n\n    if (size === 'viewport') {\n      data.outputWidth = vpRect.width;\n      data.outputHeight = vpRect.height;\n    } else if (typeof size === 'object') {\n      if (size.width && size.height) {\n        data.outputWidth = size.width;\n        data.outputHeight = size.height;\n      } else if (size.width) {\n        data.outputWidth = size.width;\n        data.outputHeight = size.width / ratio;\n      } else if (size.height) {\n        data.outputWidth = size.height * ratio;\n        data.outputHeight = size.height;\n      }\n    }\n\n    if (RESULT_FORMATS.indexOf(format) > -1) {\n      data.format = 'image/' + format;\n      data.quality = quality;\n    }\n\n    data.circle = circle;\n    data.url = self.data.url;\n    data.backgroundColor = backgroundColor;\n    prom = new Promise(function (resolve) {\n      switch (resultType.toLowerCase()) {\n        case 'rawcanvas':\n          resolve(_getCanvas.call(self, data));\n          break;\n\n        case 'canvas':\n        case 'base64':\n          resolve(_getBase64Result.call(self, data));\n          break;\n\n        case 'blob':\n          _getBlobResult.call(self, data).then(resolve);\n\n          break;\n\n        default:\n          resolve(_getHtmlResult.call(self, data));\n          break;\n      }\n    });\n    return prom;\n  }\n\n  function _refresh() {\n    _updatePropertiesFromImage.call(this);\n  }\n\n  function _rotate(deg) {\n    if (!this.options.useCanvas || !this.options.enableOrientation) {\n      throw 'Croppie: Cannot rotate without enableOrientation && EXIF.js included';\n    }\n\n    var self = this,\n        canvas = self.elements.canvas;\n    self.data.orientation = getExifOffset(self.data.orientation, deg);\n    drawCanvas(canvas, self.elements.img, self.data.orientation);\n\n    _updateCenterPoint.call(self, true);\n\n    _updateZoomLimits.call(self); // Reverses image dimensions if the degrees of rotation is not divisible by 180.\n\n\n    if (Math.abs(deg) / 90 % 2 === 1) {\n      var oldHeight = self._originalImageHeight;\n      var oldWidth = self._originalImageWidth;\n      self._originalImageWidth = oldHeight;\n      self._originalImageHeight = oldWidth;\n    }\n  }\n\n  function _destroy() {\n    var self = this;\n    self.element.removeChild(self.elements.boundary);\n    removeClass(self.element, 'croppie-container');\n\n    if (self.options.enableZoom) {\n      self.element.removeChild(self.elements.zoomerWrap);\n    }\n\n    delete self.elements;\n  }\n\n  if (typeof window !== 'undefined' && window.jQuery) {\n    var $ = window.jQuery;\n\n    $.fn.croppie = function (opts) {\n      var ot = typeof opts;\n\n      if (ot === 'string') {\n        var args = Array.prototype.slice.call(arguments, 1);\n        var singleInst = $(this).data('croppie');\n\n        if (opts === 'get') {\n          return singleInst.get();\n        } else if (opts === 'result') {\n          return singleInst.result.apply(singleInst, args);\n        } else if (opts === 'bind') {\n          return singleInst.bind.apply(singleInst, args);\n        }\n\n        return this.each(function () {\n          var i = $(this).data('croppie');\n          if (!i) return;\n          var method = i[opts];\n\n          if ($.isFunction(method)) {\n            method.apply(i, args);\n\n            if (opts === 'destroy') {\n              $(this).removeData('croppie');\n            }\n          } else {\n            throw 'Croppie ' + opts + ' method not found';\n          }\n        });\n      } else {\n        return this.each(function () {\n          var i = new Croppie(this, opts);\n          i.$ = $;\n          $(this).data('croppie', i);\n        });\n      }\n    };\n  }\n\n  function Croppie(element, opts) {\n    if (element.className.indexOf('croppie-container') > -1) {\n      throw new Error(\"Croppie: Can't initialize croppie more than once\");\n    }\n\n    this.element = element;\n    this.options = deepExtend(clone(Croppie.defaults), opts);\n\n    if (this.element.tagName.toLowerCase() === 'img') {\n      var origImage = this.element;\n      addClass(origImage, 'cr-original-image');\n      setAttributes(origImage, {\n        'aria-hidden': 'true',\n        'alt': ''\n      });\n      var replacementDiv = document.createElement('div');\n      this.element.parentNode.appendChild(replacementDiv);\n      replacementDiv.appendChild(origImage);\n      this.element = replacementDiv;\n      this.options.url = this.options.url || origImage.src;\n    }\n\n    _create.call(this);\n\n    if (this.options.url) {\n      var bindOpts = {\n        url: this.options.url,\n        points: this.options.points\n      };\n      delete this.options['url'];\n      delete this.options['points'];\n\n      _bind.call(this, bindOpts);\n    }\n  }\n\n  Croppie.defaults = {\n    viewport: {\n      width: 100,\n      height: 100,\n      type: 'square'\n    },\n    boundary: {},\n    orientationControls: {\n      enabled: true,\n      leftClass: '',\n      rightClass: ''\n    },\n    resizeControls: {\n      width: true,\n      height: true\n    },\n    customClass: '',\n    showZoomer: true,\n    enableZoom: true,\n    enableResize: false,\n    mouseWheelZoom: true,\n    enableExif: false,\n    enforceBoundary: true,\n    enableOrientation: false,\n    enableKeyMovement: true,\n    update: function update() {}\n  };\n  Croppie.globals = {\n    translate: 'translate3d'\n  };\n  deepExtend(Croppie.prototype, {\n    bind: function bind(options, cb) {\n      return _bind.call(this, options, cb);\n    },\n    get: function get() {\n      var data = _get.call(this);\n\n      var points = data.points;\n\n      if (this.options.relative) {\n        points[0] /= this.elements.img.naturalWidth / 100;\n        points[1] /= this.elements.img.naturalHeight / 100;\n        points[2] /= this.elements.img.naturalWidth / 100;\n        points[3] /= this.elements.img.naturalHeight / 100;\n      }\n\n      return data;\n    },\n    result: function result(type) {\n      return _result.call(this, type);\n    },\n    refresh: function refresh() {\n      return _refresh.call(this);\n    },\n    setZoom: function setZoom(v) {\n      _setZoomerVal.call(this, v);\n\n      dispatchChange(this.elements.zoomer);\n    },\n    rotate: function rotate(deg) {\n      _rotate.call(this, deg);\n    },\n    destroy: function destroy() {\n      return _destroy.call(this);\n    }\n  });\n  return Croppie;\n});","map":{"version":3,"sources":["C:/Users/fabio/CodeProjects/Django/napker/frontend/node_modules/croppie/croppie.js"],"names":["root","factory","define","amd","exports","nodeName","module","Croppie","self","Promise","a","b","apply","arguments","c","TypeError","_state","_value","_deferreds","i","e","f","d","push","k","onFulfilled","onRejected","resolve","reject","then","g","call","length","h","j","setTimeout","setImmediate","l","Array","isArray","Object","prototype","toString","all","slice","constructor","race","_setImmediateFn","window","CustomEvent","event","params","bubbles","cancelable","detail","undefined","evt","document","createEvent","initCustomEvent","Event","HTMLCanvasElement","toBlob","defineProperty","value","callback","type","quality","binStr","atob","toDataURL","split","len","arr","Uint8Array","charCodeAt","Blob","cssPrefixes","emptyStyles","createElement","style","EXIF_NORM","EXIF_FLIP","CSS_TRANS_ORG","CSS_TRANSFORM","CSS_USERSELECT","vendorPrefix","prop","capProp","toUpperCase","getExifOffset","ornt","rotate","indexOf","index","offset","deepExtend","destination","source","property","clone","object","debounce","func","wait","immediate","timeout","context","args","later","callNow","clearTimeout","dispatchChange","element","initEvent","dispatchEvent","fireEvent","css","el","styles","val","tmp","addClass","classList","add","className","removeClass","remove","replace","setAttributes","attrs","key","setAttribute","num","v","parseInt","loadImage","src","doExif","img","Image","opacity","_resolve","removeAttribute","match","onload","EXIF","getData","onerror","ev","naturalImageDimensions","w","naturalWidth","naturalHeight","orient","getExifOrientation","x","width","height","TRANSLATE_OPTS","suffix","Transform","y","scale","parseFloat","parse","fromMatrix","fromString","vals","substring","values","translate","globals","TransformOrigin","exifdata","Orientation","drawCanvas","canvas","orientation","ctx","getContext","save","Math","PI","drawImage","restore","_create","contClass","customViewportClass","options","viewport","boundary","overlay","bw","bh","useCanvas","enableOrientation","_hasExif","data","elements","preview","isNaN","appendChild","customClass","_initDraggable","enableZoom","_initializeZoom","enableResize","_initializeResize","enableExif","wrap","isDragging","direction","originalX","originalY","minSize","maxWidth","maxHeight","vr","hr","resizeControls","mouseDown","button","preventDefault","overlayRect","getBoundingClientRect","pageX","pageY","currentTarget","touches","addEventListener","mouseMove","mouseUp","body","deltaX","deltaY","newHeight","newWidth","_updateOverlay","_updateZoomLimits","_updateCenterPoint","_triggerUpdate","removeEventListener","_setZoomerVal","z","zoomer","fix","max","min","zoomerWrap","step","display","showZoomer","_currentZoom","change","_onZoom","origin","viewportRect","transform","scroll","delta","targetZoom","mouseWheelZoom","ctrlKey","wheelDelta","ui","vpRect","applyCss","transCss","enforceBoundary","boundaries","_getVirtualBoundaries","transBoundaries","oBoundaries","maxX","minX","maxY","minY","_debouncedOverlay","vpWidth","vpHeight","centerFromBoundaryX","clientWidth","centerFromBoundaryY","clientHeight","imgRect","curImgWidth","curImgHeight","halfWidth","halfHeight","originMinX","originMaxX","originMinY","originMaxY","vpData","pc","top","left","center","adj","cx","cy","tx","ty","newCss","originalDistance","assignTransformCoordinates","bottom","right","toggleGrabState","keyDown","LEFT_ARROW","UP_ARROW","RIGHT_ARROW","DOWN_ARROW","shiftKey","keyCode","zoom","setZoom","enableKeyMovement","movement","parseKeyDown","keyMove","touch1","touch2","dist","sqrt","boundRect","imgData","get","_isVisible","update","$","Prototype","trigger","offsetHeight","offsetWidth","_updatePropertiesFromImage","initialZoom","cssReset","transformReset","originReset","isVisible","bound","_originalImageWidth","_originalImageHeight","points","_bindPoints","_centerImage","initial","minZoom","maxZoom","defaultInitialZoom","boundaryData","minW","minH","boundZoom","pointsWidth","vpOffset","originTop","originLeft","transformTop","transformLeft","imgDim","vpDim","boundDim","vpLeft","vpTop","_transferImageToCanvas","customOrientation","clearRect","_getCanvas","circle","startX","startY","canvasWidth","outputWidth","canvasHeight","outputHeight","backgroundColor","fillStyle","fillRect","sx","sy","sWidth","sHeight","dx","dy","dWidth","dHeight","abs","globalCompositeOperation","beginPath","arc","closePath","fill","_getHtmlResult","div","url","_getBase64Result","format","_getBlobResult","blob","_replaceImage","parentNode","forEach","replaceChild","_bind","cb","hasExif","natDim","rect","aspectRatio","imgAspectRatio","x0","y0","x1","y1","relative","map","p","decimalPoints","toFixed","_get","widthDiff","heightDiff","x2","y2","Infinity","Number","NEGATIVE_INFINITY","RESULT_DEFAULTS","RESULT_FORMATS","_result","opts","resultType","size","ratio","prom","toLowerCase","_refresh","_rotate","deg","oldHeight","oldWidth","_destroy","removeChild","jQuery","fn","croppie","ot","singleInst","result","bind","each","method","isFunction","removeData","Error","defaults","tagName","origImage","replacementDiv","bindOpts","orientationControls","enabled","leftClass","rightClass","refresh","destroy"],"mappings":"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","sourcesContent":["/*************************\r\n * Croppie\r\n * Copyright 2019\r\n * Foliotek\r\n * Version: 2.6.5\r\n *************************/\r\n(function (root, factory) {\r\n    if (typeof define === 'function' && define.amd) {\r\n        // AMD. Register as an anonymous module.\r\n        define(factory);\r\n    } else if (typeof exports === 'object' && typeof exports.nodeName !== 'string') {\r\n        // CommonJS\r\n        module.exports = factory();\r\n    } else {\r\n        // Browser globals\r\n        root.Croppie = factory();\r\n    }\r\n}(typeof self !== 'undefined' ? self : this, function () {\r\n\r\n    /* Polyfills */\r\n    if (typeof Promise !== 'function') {\r\n        /*! promise-polyfill 3.1.0 */\r\n        !function(a){function b(a,b){return function(){a.apply(b,arguments)}}function c(a){if(\"object\"!==typeof this)throw new TypeError(\"Promises must be constructed via new\");if(\"function\"!==typeof a)throw new TypeError(\"not a function\");this._state=null,this._value=null,this._deferreds=[],i(a,b(e,this),b(f,this))}function d(a){var b=this;return null===this._state?void this._deferreds.push(a):void k(function(){var c=b._state?a.onFulfilled:a.onRejected;if(null===c)return void(b._state?a.resolve:a.reject)(b._value);var d;try{d=c(b._value)}catch(e){return void a.reject(e)}a.resolve(d)})}function e(a){try{if(a===this)throw new TypeError(\"A promise cannot be resolved with itself.\");if(a&&(\"object\"===typeof a||\"function\"===typeof a)){var c=a.then;if(\"function\"===typeof c)return void i(b(c,a),b(e,this),b(f,this))}this._state=!0,this._value=a,g.call(this)}catch(d){f.call(this,d)}}function f(a){this._state=!1,this._value=a,g.call(this)}function g(){for(var a=0,b=this._deferreds.length;b>a;a++)d.call(this,this._deferreds[a]);this._deferreds=null}function h(a,b,c,d){this.onFulfilled=\"function\"===typeof a?a:null,this.onRejected=\"function\"===typeof b?b:null,this.resolve=c,this.reject=d}function i(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(e){if(d)return;d=!0,c(e)}}var j=setTimeout,k=\"function\"===typeof setImmediate&&setImmediate||function(a){j(a,1)},l=Array.isArray||function(a){return\"[object Array]\"===Object.prototype.toString.call(a)};c.prototype[\"catch\"]=function(a){return this.then(null,a)},c.prototype.then=function(a,b){var e=this;return new c(function(c,f){d.call(e,new h(a,b,c,f))})},c.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&l(arguments[0])?arguments[0]:arguments);return new c(function(b,c){function d(f,g){try{if(g&&(\"object\"===typeof g||\"function\"===typeof g)){var h=g.then;if(\"function\"===typeof h)return void h.call(g,function(a){d(f,a)},c)}a[f]=g,0===--e&&b(a)}catch(i){c(i)}}if(0===a.length)return b([]);for(var e=a.length,f=0;f<a.length;f++)d(f,a[f])})},c.resolve=function(a){return a&&\"object\"===typeof a&&a.constructor===c?a:new c(function(b){b(a)})},c.reject=function(a){return new c(function(b,c){c(a)})},c.race=function(a){return new c(function(b,c){for(var d=0,e=a.length;e>d;d++)a[d].then(b,c)})},c._setImmediateFn=function(a){k=a},\"undefined\"!==typeof module&&module.exports?module.exports=c:a.Promise||(a.Promise=c)}(this);\r\n    }\r\n\r\n    if (typeof window !== 'undefined' && typeof window.CustomEvent !== \"function\") {\r\n        (function(){\r\n            function CustomEvent ( event, params ) {\r\n                params = params || { bubbles: false, cancelable: false, detail: undefined };\r\n                var evt = document.createEvent( 'CustomEvent' );\r\n                evt.initCustomEvent( event, params.bubbles, params.cancelable, params.detail );\r\n                return evt;\r\n            }\r\n            CustomEvent.prototype = window.Event.prototype;\r\n            window.CustomEvent = CustomEvent;\r\n        }());\r\n    }\r\n\r\n    if (typeof HTMLCanvasElement !== 'undefined' && !HTMLCanvasElement.prototype.toBlob) {\r\n        Object.defineProperty(HTMLCanvasElement.prototype, 'toBlob', {\r\n            value: function (callback, type, quality) {\r\n                var binStr = atob( this.toDataURL(type, quality).split(',')[1] ),\r\n                len = binStr.length,\r\n                arr = new Uint8Array(len);\r\n\r\n                for (var i=0; i<len; i++ ) {\r\n                    arr[i] = binStr.charCodeAt(i);\r\n                }\r\n\r\n                callback( new Blob( [arr], {type: type || 'image/png'} ) );\r\n            }\r\n        });\r\n    }\r\n    /* End Polyfills */\r\n\r\n    var cssPrefixes = ['Webkit', 'Moz', 'ms'],\r\n        emptyStyles = typeof document !== 'undefined' ? document.createElement('div').style : {},\r\n        EXIF_NORM = [1,8,3,6],\r\n        EXIF_FLIP = [2,7,4,5],\r\n        CSS_TRANS_ORG,\r\n        CSS_TRANSFORM,\r\n        CSS_USERSELECT;\r\n\r\n    function vendorPrefix(prop) {\r\n        if (prop in emptyStyles) {\r\n            return prop;\r\n        }\r\n\r\n        var capProp = prop[0].toUpperCase() + prop.slice(1),\r\n            i = cssPrefixes.length;\r\n\r\n        while (i--) {\r\n            prop = cssPrefixes[i] + capProp;\r\n            if (prop in emptyStyles) {\r\n                return prop;\r\n            }\r\n        }\r\n    }\r\n\r\n    CSS_TRANSFORM = vendorPrefix('transform');\r\n    CSS_TRANS_ORG = vendorPrefix('transformOrigin');\r\n    CSS_USERSELECT = vendorPrefix('userSelect');\r\n\r\n    function getExifOffset(ornt, rotate) {\r\n        var arr = EXIF_NORM.indexOf(ornt) > -1 ? EXIF_NORM : EXIF_FLIP,\r\n            index = arr.indexOf(ornt),\r\n            offset = (rotate / 90) % arr.length;// 180 = 2%4 = 2 shift exif by 2 indexes\r\n\r\n        return arr[(arr.length + index + (offset % arr.length)) % arr.length];\r\n    }\r\n\r\n    // Credits to : Andrew Dupont - http://andrewdupont.net/2009/08/28/deep-extending-objects-in-javascript/\r\n    function deepExtend(destination, source) {\r\n        destination = destination || {};\r\n        for (var property in source) {\r\n            if (source[property] && source[property].constructor && source[property].constructor === Object) {\r\n                destination[property] = destination[property] || {};\r\n                deepExtend(destination[property], source[property]);\r\n            } else {\r\n                destination[property] = source[property];\r\n            }\r\n        }\r\n        return destination;\r\n    }\r\n\r\n    function clone(object) {\r\n        return deepExtend({}, object);\r\n    }\r\n\r\n    function debounce(func, wait, immediate) {\r\n        var timeout;\r\n        return function () {\r\n            var context = this, args = arguments;\r\n            var later = function () {\r\n                timeout = null;\r\n                if (!immediate) func.apply(context, args);\r\n            };\r\n            var callNow = immediate && !timeout;\r\n            clearTimeout(timeout);\r\n            timeout = setTimeout(later, wait);\r\n            if (callNow) func.apply(context, args);\r\n        };\r\n    }\r\n\r\n    function dispatchChange(element) {\r\n        if (\"createEvent\" in document) {\r\n            var evt = document.createEvent(\"HTMLEvents\");\r\n            evt.initEvent(\"change\", false, true);\r\n            element.dispatchEvent(evt);\r\n        }\r\n        else {\r\n            element.fireEvent(\"onchange\");\r\n        }\r\n    }\r\n\r\n    //http://jsperf.com/vanilla-css\r\n    function css(el, styles, val) {\r\n        if (typeof (styles) === 'string') {\r\n            var tmp = styles;\r\n            styles = {};\r\n            styles[tmp] = val;\r\n        }\r\n\r\n        for (var prop in styles) {\r\n            el.style[prop] = styles[prop];\r\n        }\r\n    }\r\n\r\n    function addClass(el, c) {\r\n        if (el.classList) {\r\n            el.classList.add(c);\r\n        }\r\n        else {\r\n            el.className += ' ' + c;\r\n        }\r\n    }\r\n\r\n    function removeClass(el, c) {\r\n        if (el.classList) {\r\n            el.classList.remove(c);\r\n        }\r\n        else {\r\n            el.className = el.className.replace(c, '');\r\n        }\r\n    }\r\n\r\n    function setAttributes(el, attrs) {\r\n        for (var key in attrs) {\r\n            el.setAttribute(key, attrs[key]);\r\n        }\r\n    }\r\n\r\n    function num(v) {\r\n        return parseInt(v, 10);\r\n    }\r\n\r\n    /* Utilities */\r\n    function loadImage(src, doExif) {\r\n        if (!src) { throw 'Source image missing'; }\r\n        \r\n        var img = new Image();\r\n        img.style.opacity = '0';\r\n        return new Promise(function (resolve, reject) {\r\n            function _resolve() {\r\n                img.style.opacity = '1';\r\n                setTimeout(function () {\r\n                    resolve(img);\r\n                }, 1);\r\n            }\r\n\r\n            img.removeAttribute('crossOrigin');\r\n            if (src.match(/^https?:\\/\\/|^\\/\\//)) {\r\n                img.setAttribute('crossOrigin', 'anonymous');\r\n            }\r\n\r\n            img.onload = function () {\r\n                if (doExif) {\r\n                    EXIF.getData(img, function () {\r\n                        _resolve();\r\n                    });\r\n                }\r\n                else {\r\n                    _resolve();\r\n                }\r\n            };\r\n            img.onerror = function (ev) {\r\n                img.style.opacity = 1;\r\n                setTimeout(function () {\r\n                    reject(ev);\r\n                }, 1);\r\n            };\r\n            img.src = src;\r\n        });\r\n    }\r\n\r\n    function naturalImageDimensions(img, ornt) {\r\n        var w = img.naturalWidth;\r\n        var h = img.naturalHeight;\r\n        var orient = ornt || getExifOrientation(img);\r\n        if (orient && orient >= 5) {\r\n            var x= w;\r\n            w = h;\r\n            h = x;\r\n        }\r\n        return { width: w, height: h };\r\n    }\r\n\r\n    /* CSS Transform Prototype */\r\n    var TRANSLATE_OPTS = {\r\n        'translate3d': {\r\n            suffix: ', 0px'\r\n        },\r\n        'translate': {\r\n            suffix: ''\r\n        }\r\n    };\r\n    var Transform = function (x, y, scale) {\r\n        this.x = parseFloat(x);\r\n        this.y = parseFloat(y);\r\n        this.scale = parseFloat(scale);\r\n    };\r\n\r\n    Transform.parse = function (v) {\r\n        if (v.style) {\r\n            return Transform.parse(v.style[CSS_TRANSFORM]);\r\n        }\r\n        else if (v.indexOf('matrix') > -1 || v.indexOf('none') > -1) {\r\n            return Transform.fromMatrix(v);\r\n        }\r\n        else {\r\n            return Transform.fromString(v);\r\n        }\r\n    };\r\n\r\n    Transform.fromMatrix = function (v) {\r\n        var vals = v.substring(7).split(',');\r\n        if (!vals.length || v === 'none') {\r\n            vals = [1, 0, 0, 1, 0, 0];\r\n        }\r\n\r\n        return new Transform(num(vals[4]), num(vals[5]), parseFloat(vals[0]));\r\n    };\r\n\r\n    Transform.fromString = function (v) {\r\n        var values = v.split(') '),\r\n            translate = values[0].substring(Croppie.globals.translate.length + 1).split(','),\r\n            scale = values.length > 1 ? values[1].substring(6) : 1,\r\n            x = translate.length > 1 ? translate[0] : 0,\r\n            y = translate.length > 1 ? translate[1] : 0;\r\n\r\n        return new Transform(x, y, scale);\r\n    };\r\n\r\n    Transform.prototype.toString = function () {\r\n        var suffix = TRANSLATE_OPTS[Croppie.globals.translate].suffix || '';\r\n        return Croppie.globals.translate + '(' + this.x + 'px, ' + this.y + 'px' + suffix + ') scale(' + this.scale + ')';\r\n    };\r\n\r\n    var TransformOrigin = function (el) {\r\n        if (!el || !el.style[CSS_TRANS_ORG]) {\r\n            this.x = 0;\r\n            this.y = 0;\r\n            return;\r\n        }\r\n        var css = el.style[CSS_TRANS_ORG].split(' ');\r\n        this.x = parseFloat(css[0]);\r\n        this.y = parseFloat(css[1]);\r\n    };\r\n\r\n    TransformOrigin.prototype.toString = function () {\r\n        return this.x + 'px ' + this.y + 'px';\r\n    };\r\n\r\n    function getExifOrientation (img) {\r\n        return img.exifdata && img.exifdata.Orientation ? num(img.exifdata.Orientation) : 1;\r\n    }\r\n\r\n    function drawCanvas(canvas, img, orientation) {\r\n        var width = img.width,\r\n            height = img.height,\r\n            ctx = canvas.getContext('2d');\r\n\r\n        canvas.width = img.width;\r\n        canvas.height = img.height;\r\n\r\n        ctx.save();\r\n        switch (orientation) {\r\n          case 2:\r\n             ctx.translate(width, 0);\r\n             ctx.scale(-1, 1);\r\n             break;\r\n\r\n          case 3:\r\n              ctx.translate(width, height);\r\n              ctx.rotate(180*Math.PI/180);\r\n              break;\r\n\r\n          case 4:\r\n              ctx.translate(0, height);\r\n              ctx.scale(1, -1);\r\n              break;\r\n\r\n          case 5:\r\n              canvas.width = height;\r\n              canvas.height = width;\r\n              ctx.rotate(90*Math.PI/180);\r\n              ctx.scale(1, -1);\r\n              break;\r\n\r\n          case 6:\r\n              canvas.width = height;\r\n              canvas.height = width;\r\n              ctx.rotate(90*Math.PI/180);\r\n              ctx.translate(0, -height);\r\n              break;\r\n\r\n          case 7:\r\n              canvas.width = height;\r\n              canvas.height = width;\r\n              ctx.rotate(-90*Math.PI/180);\r\n              ctx.translate(-width, height);\r\n              ctx.scale(1, -1);\r\n              break;\r\n\r\n          case 8:\r\n              canvas.width = height;\r\n              canvas.height = width;\r\n              ctx.translate(0, width);\r\n              ctx.rotate(-90*Math.PI/180);\r\n              break;\r\n        }\r\n        ctx.drawImage(img, 0,0, width, height);\r\n        ctx.restore();\r\n    }\r\n\r\n    /* Private Methods */\r\n    function _create() {\r\n        var self = this,\r\n            contClass = 'croppie-container',\r\n            customViewportClass = self.options.viewport.type ? 'cr-vp-' + self.options.viewport.type : null,\r\n            boundary, img, viewport, overlay, bw, bh;\r\n\r\n        self.options.useCanvas = self.options.enableOrientation || _hasExif.call(self);\r\n        // Properties on class\r\n        self.data = {};\r\n        self.elements = {};\r\n\r\n        boundary = self.elements.boundary = document.createElement('div');\r\n        viewport = self.elements.viewport = document.createElement('div');\r\n        img = self.elements.img = document.createElement('img');\r\n        overlay = self.elements.overlay = document.createElement('div');\r\n\r\n        if (self.options.useCanvas) {\r\n            self.elements.canvas = document.createElement('canvas');\r\n            self.elements.preview = self.elements.canvas;\r\n        }\r\n        else {\r\n            self.elements.preview = img;\r\n        }\r\n\r\n        addClass(boundary, 'cr-boundary');\r\n        boundary.setAttribute('aria-dropeffect', 'none');\r\n        bw = self.options.boundary.width;\r\n        bh = self.options.boundary.height;\r\n        css(boundary, {\r\n            width: (bw + (isNaN(bw) ? '' : 'px')),\r\n            height: (bh + (isNaN(bh) ? '' : 'px'))\r\n        });\r\n\r\n        addClass(viewport, 'cr-viewport');\r\n        if (customViewportClass) {\r\n            addClass(viewport, customViewportClass);\r\n        }\r\n        css(viewport, {\r\n            width: self.options.viewport.width + 'px',\r\n            height: self.options.viewport.height + 'px'\r\n        });\r\n        viewport.setAttribute('tabindex', 0);\r\n\r\n        addClass(self.elements.preview, 'cr-image');\r\n        setAttributes(self.elements.preview, { 'alt': 'preview', 'aria-grabbed': 'false' });\r\n        addClass(overlay, 'cr-overlay');\r\n\r\n        self.element.appendChild(boundary);\r\n        boundary.appendChild(self.elements.preview);\r\n        boundary.appendChild(viewport);\r\n        boundary.appendChild(overlay);\r\n\r\n        addClass(self.element, contClass);\r\n        if (self.options.customClass) {\r\n            addClass(self.element, self.options.customClass);\r\n        }\r\n\r\n        _initDraggable.call(this);\r\n\r\n        if (self.options.enableZoom) {\r\n            _initializeZoom.call(self);\r\n        }\r\n\r\n        // if (self.options.enableOrientation) {\r\n        //     _initRotationControls.call(self);\r\n        // }\r\n\r\n        if (self.options.enableResize) {\r\n            _initializeResize.call(self);\r\n        }\r\n    }\r\n\r\n    // function _initRotationControls () {\r\n    //     var self = this,\r\n    //         wrap, btnLeft, btnRight, iLeft, iRight;\r\n\r\n    //     wrap = document.createElement('div');\r\n    //     self.elements.orientationBtnLeft = btnLeft = document.createElement('button');\r\n    //     self.elements.orientationBtnRight = btnRight = document.createElement('button');\r\n\r\n    //     wrap.appendChild(btnLeft);\r\n    //     wrap.appendChild(btnRight);\r\n\r\n    //     iLeft = document.createElement('i');\r\n    //     iRight = document.createElement('i');\r\n    //     btnLeft.appendChild(iLeft);\r\n    //     btnRight.appendChild(iRight);\r\n\r\n    //     addClass(wrap, 'cr-rotate-controls');\r\n    //     addClass(btnLeft, 'cr-rotate-l');\r\n    //     addClass(btnRight, 'cr-rotate-r');\r\n\r\n    //     self.elements.boundary.appendChild(wrap);\r\n\r\n    //     btnLeft.addEventListener('click', function () {\r\n    //         self.rotate(-90);\r\n    //     });\r\n    //     btnRight.addEventListener('click', function () {\r\n    //         self.rotate(90);\r\n    //     });\r\n    // }\r\n\r\n    function _hasExif() {\r\n        return this.options.enableExif && window.EXIF;\r\n    }\r\n\r\n    function _initializeResize () {\r\n        var self = this;\r\n        var wrap = document.createElement('div');\r\n        var isDragging = false;\r\n        var direction;\r\n        var originalX;\r\n        var originalY;\r\n        var minSize = 50;\r\n        var maxWidth;\r\n        var maxHeight;\r\n        var vr;\r\n        var hr;\r\n\r\n        addClass(wrap, 'cr-resizer');\r\n        css(wrap, {\r\n            width: this.options.viewport.width + 'px',\r\n            height: this.options.viewport.height + 'px'\r\n        });\r\n\r\n        if (this.options.resizeControls.height) {\r\n            vr = document.createElement('div');\r\n            addClass(vr, 'cr-resizer-vertical');\r\n            wrap.appendChild(vr);\r\n        }\r\n\r\n        if (this.options.resizeControls.width) {\r\n            hr = document.createElement('div');\r\n            addClass(hr, 'cr-resizer-horisontal');\r\n            wrap.appendChild(hr);\r\n        }\r\n\r\n        function mouseDown(ev) {\r\n            if (ev.button !== undefined && ev.button !== 0) return;\r\n\r\n            ev.preventDefault();\r\n            if (isDragging) {\r\n                return;\r\n            }\r\n\r\n            var overlayRect = self.elements.overlay.getBoundingClientRect();\r\n\r\n            isDragging = true;\r\n            originalX = ev.pageX;\r\n            originalY = ev.pageY;\r\n            direction = ev.currentTarget.className.indexOf('vertical') !== -1 ? 'v' : 'h';\r\n            maxWidth = overlayRect.width;\r\n            maxHeight = overlayRect.height;\r\n\r\n            if (ev.touches) {\r\n                var touches = ev.touches[0];\r\n                originalX = touches.pageX;\r\n                originalY = touches.pageY;\r\n            }\r\n\r\n            window.addEventListener('mousemove', mouseMove);\r\n            window.addEventListener('touchmove', mouseMove);\r\n            window.addEventListener('mouseup', mouseUp);\r\n            window.addEventListener('touchend', mouseUp);\r\n            document.body.style[CSS_USERSELECT] = 'none';\r\n        }\r\n\r\n        function mouseMove(ev) {\r\n            var pageX = ev.pageX;\r\n            var pageY = ev.pageY;\r\n\r\n            ev.preventDefault();\r\n\r\n            if (ev.touches) {\r\n                var touches = ev.touches[0];\r\n                pageX = touches.pageX;\r\n                pageY = touches.pageY;\r\n            }\r\n\r\n            var deltaX = pageX - originalX;\r\n            var deltaY = pageY - originalY;\r\n            var newHeight = self.options.viewport.height + deltaY;\r\n            var newWidth = self.options.viewport.width + deltaX;\r\n\r\n            if (direction === 'v' && newHeight >= minSize && newHeight <= maxHeight) {\r\n                css(wrap, {\r\n                    height: newHeight + 'px'\r\n                });\r\n\r\n                self.options.boundary.height += deltaY;\r\n                css(self.elements.boundary, {\r\n                    height: self.options.boundary.height + 'px'\r\n                });\r\n\r\n                self.options.viewport.height += deltaY;\r\n                css(self.elements.viewport, {\r\n                    height: self.options.viewport.height + 'px'\r\n                });\r\n            }\r\n            else if (direction === 'h' && newWidth >= minSize && newWidth <= maxWidth) {\r\n                css(wrap, {\r\n                    width: newWidth + 'px'\r\n                });\r\n\r\n                self.options.boundary.width += deltaX;\r\n                css(self.elements.boundary, {\r\n                    width: self.options.boundary.width + 'px'\r\n                });\r\n\r\n                self.options.viewport.width += deltaX;\r\n                css(self.elements.viewport, {\r\n                    width: self.options.viewport.width + 'px'\r\n                });\r\n            }\r\n\r\n            _updateOverlay.call(self);\r\n            _updateZoomLimits.call(self);\r\n            _updateCenterPoint.call(self);\r\n            _triggerUpdate.call(self);\r\n            originalY = pageY;\r\n            originalX = pageX;\r\n        }\r\n\r\n        function mouseUp() {\r\n            isDragging = false;\r\n            window.removeEventListener('mousemove', mouseMove);\r\n            window.removeEventListener('touchmove', mouseMove);\r\n            window.removeEventListener('mouseup', mouseUp);\r\n            window.removeEventListener('touchend', mouseUp);\r\n            document.body.style[CSS_USERSELECT] = '';\r\n        }\r\n\r\n        if (vr) {\r\n            vr.addEventListener('mousedown', mouseDown);\r\n            vr.addEventListener('touchstart', mouseDown);\r\n        }\r\n\r\n        if (hr) {\r\n            hr.addEventListener('mousedown', mouseDown);\r\n            hr.addEventListener('touchstart', mouseDown);\r\n        }\r\n\r\n        this.elements.boundary.appendChild(wrap);\r\n    }\r\n\r\n    function _setZoomerVal(v) {\r\n        if (this.options.enableZoom) {\r\n            var z = this.elements.zoomer,\r\n                val = fix(v, 4);\r\n\r\n            z.value = Math.max(parseFloat(z.min), Math.min(parseFloat(z.max), val)).toString();\r\n        }\r\n    }\r\n\r\n    function _initializeZoom() {\r\n        var self = this,\r\n            wrap = self.elements.zoomerWrap = document.createElement('div'),\r\n            zoomer = self.elements.zoomer = document.createElement('input');\r\n\r\n        addClass(wrap, 'cr-slider-wrap');\r\n        addClass(zoomer, 'cr-slider');\r\n        zoomer.type = 'range';\r\n        zoomer.step = '0.0001';\r\n        zoomer.value = '1';\r\n        zoomer.style.display = self.options.showZoomer ? '' : 'none';\r\n        zoomer.setAttribute('aria-label', 'zoom');\r\n\r\n        self.element.appendChild(wrap);\r\n        wrap.appendChild(zoomer);\r\n\r\n        self._currentZoom = 1;\r\n\r\n        function change() {\r\n            _onZoom.call(self, {\r\n                value: parseFloat(zoomer.value),\r\n                origin: new TransformOrigin(self.elements.preview),\r\n                viewportRect: self.elements.viewport.getBoundingClientRect(),\r\n                transform: Transform.parse(self.elements.preview)\r\n            });\r\n        }\r\n\r\n        function scroll(ev) {\r\n            var delta, targetZoom;\r\n\r\n            if(self.options.mouseWheelZoom === 'ctrl' && ev.ctrlKey !== true){\r\n              return 0;\r\n            } else if (ev.wheelDelta) {\r\n                delta = ev.wheelDelta / 1200; //wheelDelta min: -120 max: 120 // max x 10 x 2\r\n            } else if (ev.deltaY) {\r\n                delta = ev.deltaY / 1060; //deltaY min: -53 max: 53 // max x 10 x 2\r\n            } else if (ev.detail) {\r\n                delta = ev.detail / -60; //delta min: -3 max: 3 // max x 10 x 2\r\n            } else {\r\n                delta = 0;\r\n            }\r\n\r\n            targetZoom = self._currentZoom + (delta * self._currentZoom);\r\n\r\n            ev.preventDefault();\r\n            _setZoomerVal.call(self, targetZoom);\r\n            change.call(self);\r\n        }\r\n\r\n        self.elements.zoomer.addEventListener('input', change);// this is being fired twice on keypress\r\n        self.elements.zoomer.addEventListener('change', change);\r\n\r\n        if (self.options.mouseWheelZoom) {\r\n            self.elements.boundary.addEventListener('mousewheel', scroll);\r\n            self.elements.boundary.addEventListener('DOMMouseScroll', scroll);\r\n        }\r\n    }\r\n\r\n    function _onZoom(ui) {\r\n        var self = this,\r\n            transform = ui ? ui.transform : Transform.parse(self.elements.preview),\r\n            vpRect = ui ? ui.viewportRect : self.elements.viewport.getBoundingClientRect(),\r\n            origin = ui ? ui.origin : new TransformOrigin(self.elements.preview);\r\n\r\n        function applyCss() {\r\n            var transCss = {};\r\n            transCss[CSS_TRANSFORM] = transform.toString();\r\n            transCss[CSS_TRANS_ORG] = origin.toString();\r\n            css(self.elements.preview, transCss);\r\n        }\r\n\r\n        self._currentZoom = ui ? ui.value : self._currentZoom;\r\n        transform.scale = self._currentZoom;\r\n        self.elements.zoomer.setAttribute('aria-valuenow', self._currentZoom);\r\n        applyCss();\r\n\r\n        if (self.options.enforceBoundary) {\r\n            var boundaries = _getVirtualBoundaries.call(self, vpRect),\r\n                transBoundaries = boundaries.translate,\r\n                oBoundaries = boundaries.origin;\r\n\r\n            if (transform.x >= transBoundaries.maxX) {\r\n                origin.x = oBoundaries.minX;\r\n                transform.x = transBoundaries.maxX;\r\n            }\r\n\r\n            if (transform.x <= transBoundaries.minX) {\r\n                origin.x = oBoundaries.maxX;\r\n                transform.x = transBoundaries.minX;\r\n            }\r\n\r\n            if (transform.y >= transBoundaries.maxY) {\r\n                origin.y = oBoundaries.minY;\r\n                transform.y = transBoundaries.maxY;\r\n            }\r\n\r\n            if (transform.y <= transBoundaries.minY) {\r\n                origin.y = oBoundaries.maxY;\r\n                transform.y = transBoundaries.minY;\r\n            }\r\n        }\r\n        applyCss();\r\n        _debouncedOverlay.call(self);\r\n        _triggerUpdate.call(self);\r\n    }\r\n\r\n    function _getVirtualBoundaries(viewport) {\r\n        var self = this,\r\n            scale = self._currentZoom,\r\n            vpWidth = viewport.width,\r\n            vpHeight = viewport.height,\r\n            centerFromBoundaryX = self.elements.boundary.clientWidth / 2,\r\n            centerFromBoundaryY = self.elements.boundary.clientHeight / 2,\r\n            imgRect = self.elements.preview.getBoundingClientRect(),\r\n            curImgWidth = imgRect.width,\r\n            curImgHeight = imgRect.height,\r\n            halfWidth = vpWidth / 2,\r\n            halfHeight = vpHeight / 2;\r\n\r\n        var maxX = ((halfWidth / scale) - centerFromBoundaryX) * -1;\r\n        var minX = maxX - ((curImgWidth * (1 / scale)) - (vpWidth * (1 / scale)));\r\n\r\n        var maxY = ((halfHeight / scale) - centerFromBoundaryY) * -1;\r\n        var minY = maxY - ((curImgHeight * (1 / scale)) - (vpHeight * (1 / scale)));\r\n\r\n        var originMinX = (1 / scale) * halfWidth;\r\n        var originMaxX = (curImgWidth * (1 / scale)) - originMinX;\r\n\r\n        var originMinY = (1 / scale) * halfHeight;\r\n        var originMaxY = (curImgHeight * (1 / scale)) - originMinY;\r\n\r\n        return {\r\n            translate: {\r\n                maxX: maxX,\r\n                minX: minX,\r\n                maxY: maxY,\r\n                minY: minY\r\n            },\r\n            origin: {\r\n                maxX: originMaxX,\r\n                minX: originMinX,\r\n                maxY: originMaxY,\r\n                minY: originMinY\r\n            }\r\n        };\r\n    }\r\n\r\n    function _updateCenterPoint(rotate) {\r\n        var self = this,\r\n            scale = self._currentZoom,\r\n            data = self.elements.preview.getBoundingClientRect(),\r\n            vpData = self.elements.viewport.getBoundingClientRect(),\r\n            transform = Transform.parse(self.elements.preview.style[CSS_TRANSFORM]),\r\n            pc = new TransformOrigin(self.elements.preview),\r\n            top = (vpData.top - data.top) + (vpData.height / 2),\r\n            left = (vpData.left - data.left) + (vpData.width / 2),\r\n            center = {},\r\n            adj = {};\r\n\r\n        if (rotate) {\r\n            var cx = pc.x;\r\n            var cy = pc.y;\r\n            var tx = transform.x;\r\n            var ty = transform.y;\r\n\r\n            center.y = cx;\r\n            center.x = cy;\r\n            transform.y = tx;\r\n            transform.x = ty;\r\n        }\r\n        else {\r\n            center.y = top / scale;\r\n            center.x = left / scale;\r\n\r\n            adj.y = (center.y - pc.y) * (1 - scale);\r\n            adj.x = (center.x - pc.x) * (1 - scale);\r\n\r\n            transform.x -= adj.x;\r\n            transform.y -= adj.y;\r\n        }\r\n\r\n        var newCss = {};\r\n        newCss[CSS_TRANS_ORG] = center.x + 'px ' + center.y + 'px';\r\n        newCss[CSS_TRANSFORM] = transform.toString();\r\n        css(self.elements.preview, newCss);\r\n    }\r\n\r\n    function _initDraggable() {\r\n        var self = this,\r\n            isDragging = false,\r\n            originalX,\r\n            originalY,\r\n            originalDistance,\r\n            vpRect,\r\n            transform;\r\n\r\n        function assignTransformCoordinates(deltaX, deltaY) {\r\n            var imgRect = self.elements.preview.getBoundingClientRect(),\r\n                top = transform.y + deltaY,\r\n                left = transform.x + deltaX;\r\n\r\n            if (self.options.enforceBoundary) {\r\n                if (vpRect.top > imgRect.top + deltaY && vpRect.bottom < imgRect.bottom + deltaY) {\r\n                    transform.y = top;\r\n                }\r\n\r\n                if (vpRect.left > imgRect.left + deltaX && vpRect.right < imgRect.right + deltaX) {\r\n                    transform.x = left;\r\n                }\r\n            }\r\n            else {\r\n                transform.y = top;\r\n                transform.x = left;\r\n            }\r\n        }\r\n\r\n        function toggleGrabState(isDragging) {\r\n          self.elements.preview.setAttribute('aria-grabbed', isDragging);\r\n          self.elements.boundary.setAttribute('aria-dropeffect', isDragging? 'move': 'none');\r\n        }\r\n\r\n        function keyDown(ev) {\r\n            var LEFT_ARROW  = 37,\r\n                UP_ARROW    = 38,\r\n                RIGHT_ARROW = 39,\r\n                DOWN_ARROW  = 40;\r\n\r\n            if (ev.shiftKey && (ev.keyCode === UP_ARROW || ev.keyCode === DOWN_ARROW)) {\r\n                var zoom;\r\n                if (ev.keyCode === UP_ARROW) {\r\n                    zoom = parseFloat(self.elements.zoomer.value) + parseFloat(self.elements.zoomer.step)\r\n                }\r\n                else {\r\n                    zoom = parseFloat(self.elements.zoomer.value) - parseFloat(self.elements.zoomer.step)\r\n                }\r\n                self.setZoom(zoom);\r\n            }\r\n            else if (self.options.enableKeyMovement && (ev.keyCode >= 37 && ev.keyCode <= 40)) {\r\n                ev.preventDefault();\r\n                var movement = parseKeyDown(ev.keyCode);\r\n\r\n                transform = Transform.parse(self.elements.preview);\r\n                document.body.style[CSS_USERSELECT] = 'none';\r\n                vpRect = self.elements.viewport.getBoundingClientRect();\r\n                keyMove(movement);\r\n            }\r\n\r\n            function parseKeyDown(key) {\r\n                switch (key) {\r\n                    case LEFT_ARROW:\r\n                        return [1, 0];\r\n                    case UP_ARROW:\r\n                        return [0, 1];\r\n                    case RIGHT_ARROW:\r\n                        return [-1, 0];\r\n                    case DOWN_ARROW:\r\n                        return [0, -1];\r\n                }\r\n            }\r\n        }\r\n\r\n        function keyMove(movement) {\r\n            var deltaX = movement[0],\r\n                deltaY = movement[1],\r\n                newCss = {};\r\n\r\n            assignTransformCoordinates(deltaX, deltaY);\r\n\r\n            newCss[CSS_TRANSFORM] = transform.toString();\r\n            css(self.elements.preview, newCss);\r\n            _updateOverlay.call(self);\r\n            document.body.style[CSS_USERSELECT] = '';\r\n            _updateCenterPoint.call(self);\r\n            _triggerUpdate.call(self);\r\n            originalDistance = 0;\r\n        }\r\n\r\n        function mouseDown(ev) {\r\n            if (ev.button !== undefined && ev.button !== 0) return;\r\n\r\n            ev.preventDefault();\r\n            if (isDragging) return;\r\n            isDragging = true;\r\n            originalX = ev.pageX;\r\n            originalY = ev.pageY;\r\n\r\n            if (ev.touches) {\r\n                var touches = ev.touches[0];\r\n                originalX = touches.pageX;\r\n                originalY = touches.pageY;\r\n            }\r\n            toggleGrabState(isDragging);\r\n            transform = Transform.parse(self.elements.preview);\r\n            window.addEventListener('mousemove', mouseMove);\r\n            window.addEventListener('touchmove', mouseMove);\r\n            window.addEventListener('mouseup', mouseUp);\r\n            window.addEventListener('touchend', mouseUp);\r\n            document.body.style[CSS_USERSELECT] = 'none';\r\n            vpRect = self.elements.viewport.getBoundingClientRect();\r\n        }\r\n\r\n        function mouseMove(ev) {\r\n            ev.preventDefault();\r\n            var pageX = ev.pageX,\r\n                pageY = ev.pageY;\r\n\r\n            if (ev.touches) {\r\n                var touches = ev.touches[0];\r\n                pageX = touches.pageX;\r\n                pageY = touches.pageY;\r\n            }\r\n\r\n            var deltaX = pageX - originalX,\r\n                deltaY = pageY - originalY,\r\n                newCss = {};\r\n\r\n            if (ev.type === 'touchmove') {\r\n                if (ev.touches.length > 1) {\r\n                    var touch1 = ev.touches[0];\r\n                    var touch2 = ev.touches[1];\r\n                    var dist = Math.sqrt((touch1.pageX - touch2.pageX) * (touch1.pageX - touch2.pageX) + (touch1.pageY - touch2.pageY) * (touch1.pageY - touch2.pageY));\r\n\r\n                    if (!originalDistance) {\r\n                        originalDistance = dist / self._currentZoom;\r\n                    }\r\n\r\n                    var scale = dist / originalDistance;\r\n\r\n                    _setZoomerVal.call(self, scale);\r\n                    dispatchChange(self.elements.zoomer);\r\n                    return;\r\n                }\r\n            }\r\n\r\n            assignTransformCoordinates(deltaX, deltaY);\r\n\r\n            newCss[CSS_TRANSFORM] = transform.toString();\r\n            css(self.elements.preview, newCss);\r\n            _updateOverlay.call(self);\r\n            originalY = pageY;\r\n            originalX = pageX;\r\n        }\r\n\r\n        function mouseUp() {\r\n            isDragging = false;\r\n            toggleGrabState(isDragging);\r\n            window.removeEventListener('mousemove', mouseMove);\r\n            window.removeEventListener('touchmove', mouseMove);\r\n            window.removeEventListener('mouseup', mouseUp);\r\n            window.removeEventListener('touchend', mouseUp);\r\n            document.body.style[CSS_USERSELECT] = '';\r\n            _updateCenterPoint.call(self);\r\n            _triggerUpdate.call(self);\r\n            originalDistance = 0;\r\n        }\r\n\r\n        self.elements.overlay.addEventListener('mousedown', mouseDown);\r\n        self.elements.viewport.addEventListener('keydown', keyDown);\r\n        self.elements.overlay.addEventListener('touchstart', mouseDown);\r\n    }\r\n\r\n    function _updateOverlay() {\r\n        if (!this.elements) return; // since this is debounced, it can be fired after destroy\r\n        var self = this,\r\n            boundRect = self.elements.boundary.getBoundingClientRect(),\r\n            imgData = self.elements.preview.getBoundingClientRect();\r\n\r\n        css(self.elements.overlay, {\r\n            width: imgData.width + 'px',\r\n            height: imgData.height + 'px',\r\n            top: (imgData.top - boundRect.top) + 'px',\r\n            left: (imgData.left - boundRect.left) + 'px'\r\n        });\r\n    }\r\n    var _debouncedOverlay = debounce(_updateOverlay, 500);\r\n\r\n    function _triggerUpdate() {\r\n        var self = this,\r\n            data = self.get();\r\n\r\n        if (!_isVisible.call(self)) {\r\n            return;\r\n        }\r\n\r\n        self.options.update.call(self, data);\r\n        if (self.$ && typeof Prototype === 'undefined') {\r\n            self.$(self.element).trigger('update.croppie', data);\r\n        }\r\n        else {\r\n            var ev;\r\n            if (window.CustomEvent) {\r\n                ev = new CustomEvent('update', { detail: data });\r\n            } else {\r\n                ev = document.createEvent('CustomEvent');\r\n                ev.initCustomEvent('update', true, true, data);\r\n            }\r\n\r\n            self.element.dispatchEvent(ev);\r\n        }\r\n    }\r\n\r\n    function _isVisible() {\r\n        return this.elements.preview.offsetHeight > 0 && this.elements.preview.offsetWidth > 0;\r\n    }\r\n\r\n    function _updatePropertiesFromImage() {\r\n        var self = this,\r\n            initialZoom = 1,\r\n            cssReset = {},\r\n            img = self.elements.preview,\r\n            imgData,\r\n            transformReset = new Transform(0, 0, initialZoom),\r\n            originReset = new TransformOrigin(),\r\n            isVisible = _isVisible.call(self);\r\n\r\n        if (!isVisible || self.data.bound) {// if the croppie isn't visible or it doesn't need binding\r\n            return;\r\n        }\r\n\r\n        self.data.bound = true;\r\n        cssReset[CSS_TRANSFORM] = transformReset.toString();\r\n        cssReset[CSS_TRANS_ORG] = originReset.toString();\r\n        cssReset['opacity'] = 1;\r\n        css(img, cssReset);\r\n\r\n        imgData = self.elements.preview.getBoundingClientRect();\r\n\r\n        self._originalImageWidth = imgData.width;\r\n        self._originalImageHeight = imgData.height;\r\n        self.data.orientation = _hasExif.call(self) ? getExifOrientation(self.elements.img) : self.data.orientation;\r\n\r\n        if (self.options.enableZoom) {\r\n            _updateZoomLimits.call(self, true);\r\n        }\r\n        else {\r\n            self._currentZoom = initialZoom;\r\n        }\r\n\r\n        transformReset.scale = self._currentZoom;\r\n        cssReset[CSS_TRANSFORM] = transformReset.toString();\r\n        css(img, cssReset);\r\n\r\n        if (self.data.points.length) {\r\n            _bindPoints.call(self, self.data.points);\r\n        }\r\n        else {\r\n            _centerImage.call(self);\r\n        }\r\n\r\n        _updateCenterPoint.call(self);\r\n        _updateOverlay.call(self);\r\n    }\r\n\r\n    function _updateZoomLimits (initial) {\r\n        var self = this,\r\n            minZoom = Math.max(self.options.minZoom, 0) || 0,\r\n            maxZoom = self.options.maxZoom || 1.5,\r\n            initialZoom,\r\n            defaultInitialZoom,\r\n            zoomer = self.elements.zoomer,\r\n            scale = parseFloat(zoomer.value),\r\n            boundaryData = self.elements.boundary.getBoundingClientRect(),\r\n            imgData = naturalImageDimensions(self.elements.img, self.data.orientation),\r\n            vpData = self.elements.viewport.getBoundingClientRect(),\r\n            minW,\r\n            minH;\r\n        if (self.options.enforceBoundary) {\r\n            minW = vpData.width / imgData.width;\r\n            minH = vpData.height / imgData.height;\r\n            minZoom = Math.max(minW, minH);\r\n        }\r\n\r\n        if (minZoom >= maxZoom) {\r\n            maxZoom = minZoom + 1;\r\n        }\r\n\r\n        zoomer.min = fix(minZoom, 4);\r\n        zoomer.max = fix(maxZoom, 4);\r\n\r\n        if (!initial && (scale < zoomer.min || scale > zoomer.max)) {\r\n            _setZoomerVal.call(self, scale < zoomer.min ? zoomer.min : zoomer.max);\r\n        }\r\n        else if (initial) {\r\n            defaultInitialZoom = Math.max((boundaryData.width / imgData.width), (boundaryData.height / imgData.height));\r\n            initialZoom = self.data.boundZoom !== null ? self.data.boundZoom : defaultInitialZoom;\r\n            _setZoomerVal.call(self, initialZoom);\r\n        }\r\n\r\n        dispatchChange(zoomer);\r\n    }\r\n\r\n    function _bindPoints(points) {\r\n        if (points.length !== 4) {\r\n            throw \"Croppie - Invalid number of points supplied: \" + points;\r\n        }\r\n        var self = this,\r\n            pointsWidth = points[2] - points[0],\r\n            // pointsHeight = points[3] - points[1],\r\n            vpData = self.elements.viewport.getBoundingClientRect(),\r\n            boundRect = self.elements.boundary.getBoundingClientRect(),\r\n            vpOffset = {\r\n                left: vpData.left - boundRect.left,\r\n                top: vpData.top - boundRect.top\r\n            },\r\n            scale = vpData.width / pointsWidth,\r\n            originTop = points[1],\r\n            originLeft = points[0],\r\n            transformTop = (-1 * points[1]) + vpOffset.top,\r\n            transformLeft = (-1 * points[0]) + vpOffset.left,\r\n            newCss = {};\r\n\r\n        newCss[CSS_TRANS_ORG] = originLeft + 'px ' + originTop + 'px';\r\n        newCss[CSS_TRANSFORM] = new Transform(transformLeft, transformTop, scale).toString();\r\n        css(self.elements.preview, newCss);\r\n\r\n        _setZoomerVal.call(self, scale);\r\n        self._currentZoom = scale;\r\n    }\r\n\r\n    function _centerImage() {\r\n        var self = this,\r\n            imgDim = self.elements.preview.getBoundingClientRect(),\r\n            vpDim = self.elements.viewport.getBoundingClientRect(),\r\n            boundDim = self.elements.boundary.getBoundingClientRect(),\r\n            vpLeft = vpDim.left - boundDim.left,\r\n            vpTop = vpDim.top - boundDim.top,\r\n            w = vpLeft - ((imgDim.width - vpDim.width) / 2),\r\n            h = vpTop - ((imgDim.height - vpDim.height) / 2),\r\n            transform = new Transform(w, h, self._currentZoom);\r\n\r\n        css(self.elements.preview, CSS_TRANSFORM, transform.toString());\r\n    }\r\n\r\n    function _transferImageToCanvas(customOrientation) {\r\n        var self = this,\r\n            canvas = self.elements.canvas,\r\n            img = self.elements.img,\r\n            ctx = canvas.getContext('2d');\r\n\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        canvas.width = img.width;\r\n        canvas.height = img.height;\r\n\r\n        var orientation = self.options.enableOrientation && customOrientation || getExifOrientation(img);\r\n        drawCanvas(canvas, img, orientation);\r\n    }\r\n\r\n    function _getCanvas(data) {\r\n        var self = this,\r\n            points = data.points,\r\n            left = num(points[0]),\r\n            top = num(points[1]),\r\n            right = num(points[2]),\r\n            bottom = num(points[3]),\r\n            width = right-left,\r\n            height = bottom-top,\r\n            circle = data.circle,\r\n            canvas = document.createElement('canvas'),\r\n            ctx = canvas.getContext('2d'),\r\n            startX = 0,\r\n            startY = 0,\r\n            canvasWidth = data.outputWidth || width,\r\n            canvasHeight = data.outputHeight || height;\r\n\r\n        canvas.width = canvasWidth;\r\n        canvas.height = canvasHeight;\r\n\r\n        if (data.backgroundColor) {\r\n            ctx.fillStyle = data.backgroundColor;\r\n            ctx.fillRect(0, 0, canvasWidth, canvasHeight);\r\n        }\r\n\r\n        // By default assume we're going to draw the entire\r\n        // source image onto the destination canvas.\r\n        var sx = left,\r\n            sy = top,\r\n            sWidth = width,\r\n            sHeight = height,\r\n            dx = 0,\r\n            dy = 0,\r\n            dWidth = canvasWidth,\r\n            dHeight = canvasHeight;\r\n\r\n        //\r\n        // Do not go outside of the original image's bounds along the x-axis.\r\n        // Handle translations when projecting onto the destination canvas.\r\n        //\r\n\r\n        // The smallest possible source x-position is 0.\r\n        if (left < 0) {\r\n            sx = 0;\r\n            dx = (Math.abs(left) / width) * canvasWidth;\r\n        }\r\n\r\n        // The largest possible source width is the original image's width.\r\n        if (sWidth + sx > self._originalImageWidth) {\r\n            sWidth = self._originalImageWidth - sx;\r\n            dWidth =  (sWidth / width) * canvasWidth;\r\n        }\r\n\r\n        //\r\n        // Do not go outside of the original image's bounds along the y-axis.\r\n        //\r\n\r\n        // The smallest possible source y-position is 0.\r\n        if (top < 0) {\r\n            sy = 0;\r\n            dy = (Math.abs(top) / height) * canvasHeight;\r\n        }\r\n\r\n        // The largest possible source height is the original image's height.\r\n        if (sHeight + sy > self._originalImageHeight) {\r\n            sHeight = self._originalImageHeight - sy;\r\n            dHeight = (sHeight / height) * canvasHeight;\r\n        }\r\n\r\n        // console.table({ left, right, top, bottom, canvasWidth, canvasHeight, width, height, startX, startY, circle, sx, sy, dx, dy, sWidth, sHeight, dWidth, dHeight });\r\n\r\n        ctx.drawImage(this.elements.preview, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight);\r\n        if (circle) {\r\n            ctx.fillStyle = '#fff';\r\n            ctx.globalCompositeOperation = 'destination-in';\r\n            ctx.beginPath();\r\n            ctx.arc(canvas.width / 2, canvas.height / 2, canvas.width / 2, 0, Math.PI * 2, true);\r\n            ctx.closePath();\r\n            ctx.fill();\r\n        }\r\n        return canvas;\r\n    }\r\n\r\n    function _getHtmlResult(data) {\r\n        var points = data.points,\r\n            div = document.createElement('div'),\r\n            img = document.createElement('img'),\r\n            width = points[2] - points[0],\r\n            height = points[3] - points[1];\r\n\r\n        addClass(div, 'croppie-result');\r\n        div.appendChild(img);\r\n        css(img, {\r\n            left: (-1 * points[0]) + 'px',\r\n            top: (-1 * points[1]) + 'px'\r\n        });\r\n        img.src = data.url;\r\n        css(div, {\r\n            width: width + 'px',\r\n            height: height + 'px'\r\n        });\r\n\r\n        return div;\r\n    }\r\n\r\n    function _getBase64Result(data) {\r\n        return _getCanvas.call(this, data).toDataURL(data.format, data.quality);\r\n    }\r\n\r\n    function _getBlobResult(data) {\r\n        var self = this;\r\n        return new Promise(function (resolve) {\r\n            _getCanvas.call(self, data).toBlob(function (blob) {\r\n                resolve(blob);\r\n            }, data.format, data.quality);\r\n        });\r\n    }\r\n\r\n    function _replaceImage(img) {\r\n        if (this.elements.img.parentNode) {\r\n            Array.prototype.forEach.call(this.elements.img.classList, function(c) { img.classList.add(c); });\r\n            this.elements.img.parentNode.replaceChild(img, this.elements.img);\r\n            this.elements.preview = img; // if the img is attached to the DOM, they're not using the canvas\r\n        }\r\n        this.elements.img = img;\r\n    }\r\n\r\n    function _bind(options, cb) {\r\n        var self = this,\r\n            url,\r\n            points = [],\r\n            zoom = null,\r\n            hasExif = _hasExif.call(self);\r\n\r\n        if (typeof (options) === 'string') {\r\n            url = options;\r\n            options = {};\r\n        }\r\n        else if (Array.isArray(options)) {\r\n            points = options.slice();\r\n        }\r\n        else if (typeof (options) === 'undefined' && self.data.url) { //refreshing\r\n            _updatePropertiesFromImage.call(self);\r\n            _triggerUpdate.call(self);\r\n            return null;\r\n        }\r\n        else {\r\n            url = options.url;\r\n            points = options.points || [];\r\n            zoom = typeof(options.zoom) === 'undefined' ? null : options.zoom;\r\n        }\r\n\r\n        self.data.bound = false;\r\n        self.data.url = url || self.data.url;\r\n        self.data.boundZoom = zoom;\r\n\r\n        return loadImage(url, hasExif).then(function (img) {\r\n            _replaceImage.call(self, img);\r\n            if (!points.length) {\r\n                var natDim = naturalImageDimensions(img);\r\n                var rect = self.elements.viewport.getBoundingClientRect();\r\n                var aspectRatio = rect.width / rect.height;\r\n                var imgAspectRatio = natDim.width / natDim.height;\r\n                var width, height;\r\n\r\n                if (imgAspectRatio > aspectRatio) {\r\n                    height = natDim.height;\r\n                    width = height * aspectRatio;\r\n                }\r\n                else {\r\n                    width = natDim.width;\r\n                    height = natDim.height / aspectRatio;\r\n                }\r\n\r\n                var x0 = (natDim.width - width) / 2;\r\n                var y0 = (natDim.height - height) / 2;\r\n                var x1 = x0 + width;\r\n                var y1 = y0 + height;\r\n                self.data.points = [x0, y0, x1, y1];\r\n            }\r\n            else if (self.options.relative) {\r\n                points = [\r\n                    points[0] * img.naturalWidth / 100,\r\n                    points[1] * img.naturalHeight / 100,\r\n                    points[2] * img.naturalWidth / 100,\r\n                    points[3] * img.naturalHeight / 100\r\n                ];\r\n            }\r\n\r\n            self.data.orientation = options.orientation || 1;\r\n            self.data.points = points.map(function (p) {\r\n                return parseFloat(p);\r\n            });\r\n            if (self.options.useCanvas) {\r\n                _transferImageToCanvas.call(self, self.data.orientation);\r\n            }\r\n            _updatePropertiesFromImage.call(self);\r\n            _triggerUpdate.call(self);\r\n            cb && cb();\r\n        });\r\n    }\r\n\r\n    function fix(v, decimalPoints) {\r\n        return parseFloat(v).toFixed(decimalPoints || 0);\r\n    }\r\n\r\n    function _get() {\r\n        var self = this,\r\n            imgData = self.elements.preview.getBoundingClientRect(),\r\n            vpData = self.elements.viewport.getBoundingClientRect(),\r\n            x1 = vpData.left - imgData.left,\r\n            y1 = vpData.top - imgData.top,\r\n            widthDiff = (vpData.width - self.elements.viewport.offsetWidth) / 2, //border\r\n            heightDiff = (vpData.height - self.elements.viewport.offsetHeight) / 2,\r\n            x2 = x1 + self.elements.viewport.offsetWidth + widthDiff,\r\n            y2 = y1 + self.elements.viewport.offsetHeight + heightDiff,\r\n            scale = self._currentZoom;\r\n\r\n        if (scale === Infinity || isNaN(scale)) {\r\n            scale = 1;\r\n        }\r\n\r\n        var max = self.options.enforceBoundary ? 0 : Number.NEGATIVE_INFINITY;\r\n        x1 = Math.max(max, x1 / scale);\r\n        y1 = Math.max(max, y1 / scale);\r\n        x2 = Math.max(max, x2 / scale);\r\n        y2 = Math.max(max, y2 / scale);\r\n\r\n        return {\r\n            points: [fix(x1), fix(y1), fix(x2), fix(y2)],\r\n            zoom: scale,\r\n            orientation: self.data.orientation\r\n        };\r\n    }\r\n\r\n    var RESULT_DEFAULTS = {\r\n            type: 'canvas',\r\n            format: 'png',\r\n            quality: 1\r\n        },\r\n        RESULT_FORMATS = ['jpeg', 'webp', 'png'];\r\n\r\n    function _result(options) {\r\n        var self = this,\r\n            data = _get.call(self),\r\n            opts = deepExtend(clone(RESULT_DEFAULTS), clone(options)),\r\n            resultType = (typeof (options) === 'string' ? options : (opts.type || 'base64')),\r\n            size = opts.size || 'viewport',\r\n            format = opts.format,\r\n            quality = opts.quality,\r\n            backgroundColor = opts.backgroundColor,\r\n            circle = typeof opts.circle === 'boolean' ? opts.circle : (self.options.viewport.type === 'circle'),\r\n            vpRect = self.elements.viewport.getBoundingClientRect(),\r\n            ratio = vpRect.width / vpRect.height,\r\n            prom;\r\n\r\n        if (size === 'viewport') {\r\n            data.outputWidth = vpRect.width;\r\n            data.outputHeight = vpRect.height;\r\n        } else if (typeof size === 'object') {\r\n            if (size.width && size.height) {\r\n                data.outputWidth = size.width;\r\n                data.outputHeight = size.height;\r\n            } else if (size.width) {\r\n                data.outputWidth = size.width;\r\n                data.outputHeight = size.width / ratio;\r\n            } else if (size.height) {\r\n                data.outputWidth = size.height * ratio;\r\n                data.outputHeight = size.height;\r\n            }\r\n        }\r\n\r\n        if (RESULT_FORMATS.indexOf(format) > -1) {\r\n            data.format = 'image/' + format;\r\n            data.quality = quality;\r\n        }\r\n\r\n        data.circle = circle;\r\n        data.url = self.data.url;\r\n        data.backgroundColor = backgroundColor;\r\n\r\n        prom = new Promise(function (resolve) {\r\n            switch(resultType.toLowerCase())\r\n            {\r\n                case 'rawcanvas':\r\n                    resolve(_getCanvas.call(self, data));\r\n                    break;\r\n                case 'canvas':\r\n                case 'base64':\r\n                    resolve(_getBase64Result.call(self, data));\r\n                    break;\r\n                case 'blob':\r\n                    _getBlobResult.call(self, data).then(resolve);\r\n                    break;\r\n                default:\r\n                    resolve(_getHtmlResult.call(self, data));\r\n                    break;\r\n            }\r\n        });\r\n        return prom;\r\n    }\r\n\r\n    function _refresh() {\r\n        _updatePropertiesFromImage.call(this);\r\n    }\r\n\r\n    function _rotate(deg) {\r\n        if (!this.options.useCanvas || !this.options.enableOrientation) {\r\n            throw 'Croppie: Cannot rotate without enableOrientation && EXIF.js included';\r\n        }\r\n\r\n        var self = this,\r\n            canvas = self.elements.canvas;\r\n\r\n        self.data.orientation = getExifOffset(self.data.orientation, deg);\r\n        drawCanvas(canvas, self.elements.img, self.data.orientation);\r\n        _updateCenterPoint.call(self, true);\r\n        _updateZoomLimits.call(self);\r\n\r\n        // Reverses image dimensions if the degrees of rotation is not divisible by 180.\r\n        if ((Math.abs(deg) / 90) % 2 === 1) {\r\n            var oldHeight = self._originalImageHeight;\r\n            var oldWidth = self._originalImageWidth;\r\n            self._originalImageWidth = oldHeight;\r\n            self._originalImageHeight = oldWidth;\r\n        }\r\n    }\r\n\r\n    function _destroy() {\r\n        var self = this;\r\n        self.element.removeChild(self.elements.boundary);\r\n        removeClass(self.element, 'croppie-container');\r\n        if (self.options.enableZoom) {\r\n            self.element.removeChild(self.elements.zoomerWrap);\r\n        }\r\n        delete self.elements;\r\n    }\r\n\r\n    if (typeof window !== 'undefined' && window.jQuery) {\r\n        var $ = window.jQuery;\r\n        $.fn.croppie = function (opts) {\r\n            var ot = typeof opts;\r\n\r\n            if (ot === 'string') {\r\n                var args = Array.prototype.slice.call(arguments, 1);\r\n                var singleInst = $(this).data('croppie');\r\n\r\n                if (opts === 'get') {\r\n                    return singleInst.get();\r\n                }\r\n                else if (opts === 'result') {\r\n                    return singleInst.result.apply(singleInst, args);\r\n                }\r\n                else if (opts === 'bind') {\r\n                    return singleInst.bind.apply(singleInst, args);\r\n                }\r\n\r\n                return this.each(function () {\r\n                    var i = $(this).data('croppie');\r\n                    if (!i) return;\r\n\r\n                    var method = i[opts];\r\n                    if ($.isFunction(method)) {\r\n                        method.apply(i, args);\r\n                        if (opts === 'destroy') {\r\n                            $(this).removeData('croppie');\r\n                        }\r\n                    }\r\n                    else {\r\n                        throw 'Croppie ' + opts + ' method not found';\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                return this.each(function () {\r\n                    var i = new Croppie(this, opts);\r\n                    i.$ = $;\r\n                    $(this).data('croppie', i);\r\n                });\r\n            }\r\n        };\r\n    }\r\n\r\n    function Croppie(element, opts) {\r\n        if (element.className.indexOf('croppie-container') > -1) {\r\n            throw new Error(\"Croppie: Can't initialize croppie more than once\");\r\n        }\r\n        this.element = element;\r\n        this.options = deepExtend(clone(Croppie.defaults), opts);\r\n\r\n        if (this.element.tagName.toLowerCase() === 'img') {\r\n            var origImage = this.element;\r\n            addClass(origImage, 'cr-original-image');\r\n            setAttributes(origImage, {'aria-hidden' : 'true', 'alt' : '' });\r\n            var replacementDiv = document.createElement('div');\r\n            this.element.parentNode.appendChild(replacementDiv);\r\n            replacementDiv.appendChild(origImage);\r\n            this.element = replacementDiv;\r\n            this.options.url = this.options.url || origImage.src;\r\n        }\r\n\r\n        _create.call(this);\r\n        if (this.options.url) {\r\n            var bindOpts = {\r\n                url: this.options.url,\r\n                points: this.options.points\r\n            };\r\n            delete this.options['url'];\r\n            delete this.options['points'];\r\n            _bind.call(this, bindOpts);\r\n        }\r\n    }\r\n\r\n    Croppie.defaults = {\r\n        viewport: {\r\n            width: 100,\r\n            height: 100,\r\n            type: 'square'\r\n        },\r\n        boundary: { },\r\n        orientationControls: {\r\n            enabled: true,\r\n            leftClass: '',\r\n            rightClass: ''\r\n        },\r\n        resizeControls: {\r\n            width: true,\r\n            height: true\r\n        },\r\n        customClass: '',\r\n        showZoomer: true,\r\n        enableZoom: true,\r\n        enableResize: false,\r\n        mouseWheelZoom: true,\r\n        enableExif: false,\r\n        enforceBoundary: true,\r\n        enableOrientation: false,\r\n        enableKeyMovement: true,\r\n        update: function () { }\r\n    };\r\n\r\n    Croppie.globals = {\r\n        translate: 'translate3d'\r\n    };\r\n\r\n    deepExtend(Croppie.prototype, {\r\n        bind: function (options, cb) {\r\n            return _bind.call(this, options, cb);\r\n        },\r\n        get: function () {\r\n            var data = _get.call(this);\r\n            var points = data.points;\r\n            if (this.options.relative) {\r\n                points[0] /= this.elements.img.naturalWidth / 100;\r\n                points[1] /= this.elements.img.naturalHeight / 100;\r\n                points[2] /= this.elements.img.naturalWidth / 100;\r\n                points[3] /= this.elements.img.naturalHeight / 100;\r\n            }\r\n            return data;\r\n        },\r\n        result: function (type) {\r\n            return _result.call(this, type);\r\n        },\r\n        refresh: function () {\r\n            return _refresh.call(this);\r\n        },\r\n        setZoom: function (v) {\r\n            _setZoomerVal.call(this, v);\r\n            dispatchChange(this.elements.zoomer);\r\n        },\r\n        rotate: function (deg) {\r\n            _rotate.call(this, deg);\r\n        },\r\n        destroy: function () {\r\n            return _destroy.call(this);\r\n        }\r\n    });\r\n    return Croppie;\r\n}));\r\n"]},"metadata":{},"sourceType":"script"}