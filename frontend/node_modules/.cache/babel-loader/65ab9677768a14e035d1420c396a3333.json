{"ast":null,"code":"import _slicedToArray from\"C:\\\\Users\\\\felip\\\\CodeProjects\\\\Web\\\\Napker\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{Link}from'react-router-dom';import Header from'../components/fixed/Header';import{SERVER_URL}from'../settings';import{csrftoken}from'../utils';export default function Notifications(props){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),invites=_useState2[0],setInvites=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),unvisualizedPostLikes=_useState4[0],setUnvisualizedPostLikes=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),visualizedPostLikes=_useState6[0],setVisualizedPostLikes=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),unvisualizedComments=_useState8[0],setUnvisualizedComments=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),visualizedComments=_useState10[0],setVisualizedComments=_useState10[1];var notificationsFetchInterval;document.title='Notificações / Napker';var fetchNotifications=function fetchNotifications(){fetch(\"\".concat(SERVER_URL,\"/profile-api/myinvites\")).then(function(response){return response.json();}).then(function(data){return setInvites(data);});fetch(\"\".concat(SERVER_URL,\"/post-api/unvisualized-post-likes\")).then(function(response){return response.json();}).then(function(data){return setUnvisualizedPostLikes(data);});fetch(\"\".concat(SERVER_URL,\"/post-api/unvisualized-post-comments\")).then(function(response){return response.json();}).then(function(data){return setUnvisualizedComments(data);});fetch(\"\".concat(SERVER_URL,\"/post-api/post-likes-visualized-last-2-days\")).then(function(response){return response.json();}).then(function(data){return setVisualizedPostLikes(data);});fetch(\"\".concat(SERVER_URL,\"/post-api/post-comments-visualized-last-2-days\")).then(function(response){return response.json();}).then(function(data){return setVisualizedComments(data);});};useEffect(function(){fetchNotifications();notificationsFetchInterval=window.setInterval(fetchNotifications,3000);return function(){return window.clearInterval(notificationsFetchInterval);};},[]);useEffect(function(){if(unvisualizedPostLikes&&unvisualizedPostLikes.length){fetch(\"\".concat(SERVER_URL,\"/post-api/visualize-likes\")).then(function(response){return response.json();}).then(function(data){console.log(data);props.updateNotificationsNumber();});}},[unvisualizedPostLikes]);useEffect(function(){if(unvisualizedComments&&unvisualizedComments.length){fetch(\"\".concat(SERVER_URL,\"/post-api/visualize-comments\")).then(function(response){return response.json();}).then(function(data){console.log(data);props.updateNotificationsNumber();});}},[unvisualizedComments]);var replyRequest=function replyRequest(e){e.stopPropagation();var btn=e.target;var requestBody={'senderid':btn.dataset.senderid,'reply':btn.dataset.reply};fetch(\"\".concat(SERVER_URL,\"/profile-api/reply-friend-request\"),{method:'POST',headers:{'Content-type':'application/json','X-CSRFToken':csrftoken},body:JSON.stringify(requestBody)}).then(function(response){return response.json();}).then(function(data){console.log(data);props.updateNotificationsNumber();});document.getElementById(\"fr-\".concat(btn.dataset.senderid)).remove();fetchNotifications();};return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Header,{page:\"Notifica\\xE7\\xF5es\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"content\"},/*#__PURE__*/React.createElement(\"div\",null,invites!==null&&unvisualizedPostLikes&&visualizedPostLikes!==null&&unvisualizedComments!==null&&visualizedComments!==null?/*#__PURE__*/React.createElement(\"div\",null,invites.length||unvisualizedPostLikes.length||visualizedPostLikes.length||unvisualizedComments.length||!!visualizedComments.length?/*#__PURE__*/React.createElement(\"div\",{className:\"notifications-container\"},!!invites.length&&/*#__PURE__*/React.createElement(\"div\",null,invites.map(function(i){return/*#__PURE__*/React.createElement(\"li\",{className:\"friend-request-row\",id:\"fr-\".concat(i.sender.id),key:i.sender.id,onClick:function onClick(){return window.location.href=\"/user/\".concat(i.sender.slug);}},/*#__PURE__*/React.createElement(\"div\",{className:\"friend-request-col\"},/*#__PURE__*/React.createElement(\"img\",{src:\"\".concat(SERVER_URL).concat(i.sender.photo),className:\"profile-img-med\",style:{marginRight:'10px'}}),/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex flex-column align-items-start\"},/*#__PURE__*/React.createElement(\"strong\",null,i.sender.first_name,\" \",i.sender.last_name),/*#__PURE__*/React.createElement(\"p\",{className:\"text-secondary\"},\"@\",i.sender.user.username))),/*#__PURE__*/React.createElement(\"div\",{className:\"friend-request-col\"},i.sender.bio),/*#__PURE__*/React.createElement(\"div\",{className:\"friend-request-col\",style:{justifyContent:'space-between'}},/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-primary btn-reply-fr mr-1\",\"data-senderid\":i.sender.id,\"data-reply\":\"accept\",onClick:replyRequest},\"Confirmar\"),/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-grey btn-reply-fr\",\"data-senderid\":i.sender.id,\"data-reply\":\"decline\",onClick:replyRequest},\"Excluir\")));})),(!!unvisualizedPostLikes.length||!!unvisualizedComments.length)&&/*#__PURE__*/React.createElement(React.Fragment,null,!!unvisualizedPostLikes.length&&/*#__PURE__*/React.createElement(React.Fragment,null,unvisualizedPostLikes.map(function(like){return/*#__PURE__*/React.createElement(\"li\",{className:\"notification-row\",key:like.profile.id},/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center\"},/*#__PURE__*/React.createElement(\"i\",{class:\"fas fa-heart notification-like\"}),/*#__PURE__*/React.createElement(Link,{to:\"/user/\".concat(like.profile.slug)},/*#__PURE__*/React.createElement(\"img\",{src:\"\".concat(SERVER_URL).concat(like.profile.photo),className:\"profile-img-sm\",style:{marginRight:'10px'}})),/*#__PURE__*/React.createElement(\"p\",{className:\"text-secondary d-inline-block\"},like.created.split('-').reverse().join('/')),/*#__PURE__*/React.createElement(\"div\",{className:\"notification-text-container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"notification-text\"},\"novo\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"notification-message\"},/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(Link,{to:\"/user/\".concat(like.profile.slug),style:{color:\"#000\"}},\"@\",like.profile.user.username),\" curtiu seu post.\")),/*#__PURE__*/React.createElement(\"div\",{className:\"notification-post-content\"},like.post.content));})),!!unvisualizedComments.length&&/*#__PURE__*/React.createElement(React.Fragment,null,unvisualizedComments.map(function(comment){return/*#__PURE__*/React.createElement(\"li\",{className:\"notification-row\",key:comment.author.id},/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center\"},/*#__PURE__*/React.createElement(\"i\",{class:\"fas fa-comment notification-comment\"}),/*#__PURE__*/React.createElement(Link,{to:\"/user/\".concat(comment.author.slug)},/*#__PURE__*/React.createElement(\"img\",{src:\"\".concat(SERVER_URL).concat(comment.author.photo),className:\"profile-img-sm\",style:{marginRight:'10px'}})),/*#__PURE__*/React.createElement(\"p\",{className:\"text-secondary d-inline-block\"},comment.created.split('-').reverse().join('/')),/*#__PURE__*/React.createElement(\"div\",{className:\"notification-text-container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"notification-text\"},\"novo\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"notification-message\"},/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(Link,{to:\"/user/\".concat(comment.author.slug),style:{color:\"#000\"}},\"@\",comment.author.user.username),\" comentou seu post.\")),/*#__PURE__*/React.createElement(\"div\",{className:\"notification-comment-container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"notification-comment-content\"},comment.content),/*#__PURE__*/React.createElement(Link,{to:\"/post/\".concat(comment.post.id)},/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-primary\"},\"Ver Post\"))));}))),(!!visualizedPostLikes.length||!!visualizedComments.length)&&/*#__PURE__*/React.createElement(React.Fragment,null,!!visualizedPostLikes.length&&/*#__PURE__*/React.createElement(React.Fragment,null,visualizedPostLikes.map(function(like){return/*#__PURE__*/React.createElement(\"li\",{className:\"notification-row\",key:like.profile.id},/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center\"},/*#__PURE__*/React.createElement(\"i\",{class:\"fas fa-heart notification-like\"}),/*#__PURE__*/React.createElement(Link,{to:\"/user/\".concat(like.profile.slug)},/*#__PURE__*/React.createElement(\"img\",{src:\"\".concat(SERVER_URL).concat(like.profile.photo),className:\"profile-img-sm\",style:{marginRight:'10px'}})),/*#__PURE__*/React.createElement(\"p\",{className:\"text-secondary d-inline-block\"},like.created.split('-').reverse().join('/'))),/*#__PURE__*/React.createElement(\"div\",{className:\"notification-message\"},/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(Link,{to:\"/user/\".concat(like.profile.slug),style:{color:\"#000\"}},\"@\",like.profile.user.username),\" curtiu seu post.\")),/*#__PURE__*/React.createElement(\"div\",{className:\"notification-post-content\"},like.post.content));})),!!visualizedComments.length&&/*#__PURE__*/React.createElement(React.Fragment,null,visualizedComments.map(function(comment){return/*#__PURE__*/React.createElement(\"li\",{className:\"notification-row\",key:comment.author.id},/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center\"},/*#__PURE__*/React.createElement(\"i\",{class:\"fas fa-comment notification-comment\"}),/*#__PURE__*/React.createElement(Link,{to:\"/user/\".concat(comment.author.slug)},/*#__PURE__*/React.createElement(\"img\",{src:\"\".concat(SERVER_URL).concat(comment.author.photo),className:\"profile-img-sm\",style:{marginRight:'10px'}})),/*#__PURE__*/React.createElement(\"p\",{className:\"text-secondary d-inline-block\"},comment.created.split('-').reverse().join('/'))),/*#__PURE__*/React.createElement(\"div\",{className:\"notification-message\"},/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(Link,{to:\"/user/\".concat(comment.author.slug),style:{color:\"#000\"}},\"@\",comment.author.user.username),\" comentou seu post.\")),/*#__PURE__*/React.createElement(\"div\",{className:\"notification-comment-container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"notification-comment-content\"},comment.content),/*#__PURE__*/React.createElement(Link,{to:\"/post/\".concat(comment.post.id)},/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-primary\"},\"Ver Post\"))));})))):/*#__PURE__*/React.createElement(\"div\",{className:\"no-notifications-container\"},/*#__PURE__*/React.createElement(\"h3\",null,\"Voc\\xEA n\\xE3o tem nenhuma notifica\\xE7\\xE3o\"))):/*#__PURE__*/React.createElement(\"div\",{className:\"notifications-loader-container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"loader\"})))));}","map":{"version":3,"sources":["C:/Users/felip/CodeProjects/Web/Napker/frontend/src/pages/Notifications.js"],"names":["React","useEffect","useState","Link","Header","SERVER_URL","csrftoken","Notifications","props","invites","setInvites","unvisualizedPostLikes","setUnvisualizedPostLikes","visualizedPostLikes","setVisualizedPostLikes","unvisualizedComments","setUnvisualizedComments","visualizedComments","setVisualizedComments","notificationsFetchInterval","document","title","fetchNotifications","fetch","then","response","json","data","window","setInterval","clearInterval","length","console","log","updateNotificationsNumber","replyRequest","e","stopPropagation","btn","target","requestBody","dataset","senderid","reply","method","headers","body","JSON","stringify","getElementById","remove","map","i","sender","id","location","href","slug","photo","marginRight","first_name","last_name","user","username","bio","justifyContent","like","profile","created","split","reverse","join","color","post","content","comment","author"],"mappings":"iLAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CACA,OAASC,IAAT,KAAqB,kBAArB,CACA,MAAOC,CAAAA,MAAP,KAAmB,4BAAnB,CACA,OAASC,UAAT,KAA2B,aAA3B,CACA,OAASC,SAAT,KAA0B,UAA1B,CAEA,cAAe,SAASC,CAAAA,aAAT,CAAuBC,KAAvB,CAA8B,eACXN,QAAQ,CAAC,IAAD,CADG,wCAClCO,OADkC,eACzBC,UADyB,8BAEiBR,QAAQ,CAAC,IAAD,CAFzB,yCAElCS,qBAFkC,eAEXC,wBAFW,8BAGaV,QAAQ,CAAC,IAAD,CAHrB,yCAGlCW,mBAHkC,eAGbC,sBAHa,8BAIeZ,QAAQ,CAAC,IAAD,CAJvB,yCAIlCa,oBAJkC,eAIZC,uBAJY,8BAKWd,QAAQ,CAAC,IAAD,CALnB,0CAKlCe,kBALkC,gBAKdC,qBALc,gBAOzC,GAAIC,CAAAA,0BAAJ,CAEAC,QAAQ,CAACC,KAAT,CAAiB,uBAAjB,CAEA,GAAMC,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,EAAM,CAC7BC,KAAK,WAAIlB,UAAJ,2BAAL,CACKmB,IADL,CACU,SAAAC,QAAQ,QAAIA,CAAAA,QAAQ,CAACC,IAAT,EAAJ,EADlB,EAEKF,IAFL,CAEU,SAAAG,IAAI,QAAIjB,CAAAA,UAAU,CAACiB,IAAD,CAAd,EAFd,EAGAJ,KAAK,WAAIlB,UAAJ,sCAAL,CACKmB,IADL,CACU,SAAAC,QAAQ,QAAIA,CAAAA,QAAQ,CAACC,IAAT,EAAJ,EADlB,EAEKF,IAFL,CAEU,SAAAG,IAAI,QAAIf,CAAAA,wBAAwB,CAACe,IAAD,CAA5B,EAFd,EAGAJ,KAAK,WAAIlB,UAAJ,yCAAL,CACKmB,IADL,CACU,SAAAC,QAAQ,QAAIA,CAAAA,QAAQ,CAACC,IAAT,EAAJ,EADlB,EAEKF,IAFL,CAEU,SAAAG,IAAI,QAAIX,CAAAA,uBAAuB,CAACW,IAAD,CAA3B,EAFd,EAGAJ,KAAK,WAAIlB,UAAJ,gDAAL,CACKmB,IADL,CACU,SAAAC,QAAQ,QAAIA,CAAAA,QAAQ,CAACC,IAAT,EAAJ,EADlB,EAEKF,IAFL,CAEU,SAAAG,IAAI,QAAIb,CAAAA,sBAAsB,CAACa,IAAD,CAA1B,EAFd,EAGAJ,KAAK,WAAIlB,UAAJ,mDAAL,CACKmB,IADL,CACU,SAAAC,QAAQ,QAAIA,CAAAA,QAAQ,CAACC,IAAT,EAAJ,EADlB,EAEKF,IAFL,CAEU,SAAAG,IAAI,QAAIT,CAAAA,qBAAqB,CAACS,IAAD,CAAzB,EAFd,EAGH,CAhBD,CAkBA1B,SAAS,CAAC,UAAM,CACZqB,kBAAkB,GAClBH,0BAA0B,CAAGS,MAAM,CAACC,WAAP,CAAmBP,kBAAnB,CAAuC,IAAvC,CAA7B,CACA,MAAO,kBAAMM,CAAAA,MAAM,CAACE,aAAP,CAAqBX,0BAArB,CAAN,EAAP,CACH,CAJQ,CAIN,EAJM,CAAT,CAMAlB,SAAS,CAAC,UAAM,CACZ,GAAIU,qBAAqB,EAAIA,qBAAqB,CAACoB,MAAnD,CAA2D,CACvDR,KAAK,WAAIlB,UAAJ,8BAAL,CACKmB,IADL,CACU,SAAAC,QAAQ,QAAIA,CAAAA,QAAQ,CAACC,IAAT,EAAJ,EADlB,EAEKF,IAFL,CAEU,SAAAG,IAAI,CAAI,CACVK,OAAO,CAACC,GAAR,CAAYN,IAAZ,EACAnB,KAAK,CAAC0B,yBAAN,GACH,CALL,EAMH,CACJ,CATQ,CASN,CAACvB,qBAAD,CATM,CAAT,CAWAV,SAAS,CAAC,UAAM,CACZ,GAAIc,oBAAoB,EAAIA,oBAAoB,CAACgB,MAAjD,CAAyD,CACrDR,KAAK,WAAIlB,UAAJ,iCAAL,CACKmB,IADL,CACU,SAAAC,QAAQ,QAAIA,CAAAA,QAAQ,CAACC,IAAT,EAAJ,EADlB,EAEKF,IAFL,CAEU,SAAAG,IAAI,CAAI,CACVK,OAAO,CAACC,GAAR,CAAYN,IAAZ,EACAnB,KAAK,CAAC0B,yBAAN,GACH,CALL,EAMH,CACJ,CATQ,CASN,CAACnB,oBAAD,CATM,CAAT,CAWA,GAAMoB,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAAAC,CAAC,CAAI,CACtBA,CAAC,CAACC,eAAF,GACA,GAAMC,CAAAA,GAAG,CAAGF,CAAC,CAACG,MAAd,CACA,GAAMC,CAAAA,WAAW,CAAG,CAChB,WAAYF,GAAG,CAACG,OAAJ,CAAYC,QADR,CAEhB,QAASJ,GAAG,CAACG,OAAJ,CAAYE,KAFL,CAApB,CAIApB,KAAK,WAAIlB,UAAJ,sCAAmD,CACpDuC,MAAM,CAAE,MAD4C,CAEpDC,OAAO,CAAE,CACL,eAAgB,kBADX,CAEL,cAAevC,SAFV,CAF2C,CAMpDwC,IAAI,CAAEC,IAAI,CAACC,SAAL,CAAeR,WAAf,CAN8C,CAAnD,CAAL,CAQKhB,IARL,CAQU,SAAAC,QAAQ,QAAIA,CAAAA,QAAQ,CAACC,IAAT,EAAJ,EARlB,EASKF,IATL,CASU,SAAAG,IAAI,CAAI,CACVK,OAAO,CAACC,GAAR,CAAYN,IAAZ,EACAnB,KAAK,CAAC0B,yBAAN,GACH,CAZL,EAaAd,QAAQ,CAAC6B,cAAT,cAA8BX,GAAG,CAACG,OAAJ,CAAYC,QAA1C,GAAsDQ,MAAtD,GACA5B,kBAAkB,GACrB,CAtBD,CAwBA,mBACI,4CACI,oBAAC,MAAD,EAAQ,IAAI,CAAC,oBAAb,EADJ,cAEI,2BAAK,SAAS,CAAC,SAAf,eACI,+BACKb,OAAO,GAAK,IAAZ,EAAoBE,qBAApB,EAA6CE,mBAAmB,GAAK,IAArE,EAA6EE,oBAAoB,GAAK,IAAtG,EAA8GE,kBAAkB,GAAK,IAArI,cACG,+BACKR,OAAO,CAACsB,MAAR,EAAkBpB,qBAAqB,CAACoB,MAAxC,EAAkDlB,mBAAmB,CAACkB,MAAtE,EAAgFhB,oBAAoB,CAACgB,MAArG,EAA+G,CAAC,CAACd,kBAAkB,CAACc,MAApI,cACG,2BAAK,SAAS,CAAC,yBAAf,EACK,CAAC,CAACtB,OAAO,CAACsB,MAAV,eACG,+BACKtB,OAAO,CAAC0C,GAAR,CAAY,SAAAC,CAAC,CAAI,CACd,mBACI,0BACI,SAAS,CAAC,oBADd,CAEI,EAAE,cAAQA,CAAC,CAACC,MAAF,CAASC,EAAjB,CAFN,CAGI,GAAG,CAAEF,CAAC,CAACC,MAAF,CAASC,EAHlB,CAII,OAAO,CAAE,yBAAM1B,CAAAA,MAAM,CAAC2B,QAAP,CAAgBC,IAAhB,iBAAgCJ,CAAC,CAACC,MAAF,CAASI,IAAzC,CAAN,EAJb,eAMI,2BAAK,SAAS,CAAC,oBAAf,eACI,2BAAK,GAAG,WAAKpD,UAAL,SAAkB+C,CAAC,CAACC,MAAF,CAASK,KAA3B,CAAR,CACI,SAAS,CAAC,iBADd,CAEI,KAAK,CAAE,CAAEC,WAAW,CAAE,MAAf,CAFX,EADJ,cAKI,2BAAK,SAAS,CAAC,sCAAf,eACI,kCAASP,CAAC,CAACC,MAAF,CAASO,UAAlB,KAA+BR,CAAC,CAACC,MAAF,CAASQ,SAAxC,CADJ,cAEI,yBAAG,SAAS,CAAC,gBAAb,MAAgCT,CAAC,CAACC,MAAF,CAASS,IAAT,CAAcC,QAA9C,CAFJ,CALJ,CANJ,cAgBI,2BAAK,SAAS,CAAC,oBAAf,EACKX,CAAC,CAACC,MAAF,CAASW,GADd,CAhBJ,cAmBI,2BAAK,SAAS,CAAC,oBAAf,CAAoC,KAAK,CAAE,CAAEC,cAAc,CAAE,eAAlB,CAA3C,eACI,8BAAQ,SAAS,CAAC,mCAAlB,CAAsD,gBAAeb,CAAC,CAACC,MAAF,CAASC,EAA9E,CAAkF,aAAW,QAA7F,CAAsG,OAAO,CAAEnB,YAA/G,cADJ,cAEI,8BAAQ,SAAS,CAAC,2BAAlB,CAA8C,gBAAeiB,CAAC,CAACC,MAAF,CAASC,EAAtE,CAA0E,aAAW,SAArF,CAA+F,OAAO,CAAEnB,YAAxG,YAFJ,CAnBJ,CADJ,CA0BH,CA3BA,CADL,CAFR,CAkCK,CAAC,CAAC,CAACxB,qBAAqB,CAACoB,MAAxB,EAAkC,CAAC,CAAChB,oBAAoB,CAACgB,MAA1D,gBACG,wCACK,CAAC,CAACpB,qBAAqB,CAACoB,MAAxB,eACG,wCACKpB,qBAAqB,CAACwC,GAAtB,CAA0B,SAAAe,IAAI,CAAI,CAC/B,mBACI,0BAAI,SAAS,CAAC,kBAAd,CAAiC,GAAG,CAAEA,IAAI,CAACC,OAAL,CAAab,EAAnD,eACI,2BAAK,SAAS,CAAC,2BAAf,eACI,yBAAG,KAAK,CAAC,gCAAT,EADJ,cAEI,oBAAC,IAAD,EAAM,EAAE,iBAAWY,IAAI,CAACC,OAAL,CAAaV,IAAxB,CAAR,eACI,2BAAK,GAAG,WAAKpD,UAAL,SAAkB6D,IAAI,CAACC,OAAL,CAAaT,KAA/B,CAAR,CACI,SAAS,CAAC,gBADd,CAEI,KAAK,CAAE,CAAEC,WAAW,CAAE,MAAf,CAFX,EADJ,CAFJ,cAQI,yBAAG,SAAS,CAAC,+BAAb,EACKO,IAAI,CAACE,OAAL,CAAaC,KAAb,CAAmB,GAAnB,EAAwBC,OAAxB,GAAkCC,IAAlC,CAAuC,GAAvC,CADL,CARJ,cAWI,2BAAK,SAAS,CAAC,6BAAf,eACI,2BAAK,SAAS,CAAC,mBAAf,SADJ,CAXJ,CADJ,cAkBI,2BAAK,SAAS,CAAC,sBAAf,eACI,0CACI,oBAAC,IAAD,EAAM,EAAE,iBAAWL,IAAI,CAACC,OAAL,CAAaV,IAAxB,CAAR,CAAwC,KAAK,CAAE,CAAEe,KAAK,CAAE,MAAT,CAA/C,MACMN,IAAI,CAACC,OAAL,CAAaL,IAAb,CAAkBC,QADxB,CADJ,qBADJ,CAlBJ,cAyBI,2BAAK,SAAS,CAAC,2BAAf,EACKG,IAAI,CAACO,IAAL,CAAUC,OADf,CAzBJ,CADJ,CA+BH,CAhCA,CADL,CAFR,CAuCK,CAAC,CAAC3D,oBAAoB,CAACgB,MAAvB,eACG,wCACKhB,oBAAoB,CAACoC,GAArB,CAAyB,SAAAwB,OAAO,CAAI,CACjC,mBACI,0BAAI,SAAS,CAAC,kBAAd,CAAiC,GAAG,CAAEA,OAAO,CAACC,MAAR,CAAetB,EAArD,eACI,2BAAK,SAAS,CAAC,2BAAf,eACI,yBAAG,KAAK,CAAC,qCAAT,EADJ,cAEI,oBAAC,IAAD,EAAM,EAAE,iBAAWqB,OAAO,CAACC,MAAR,CAAenB,IAA1B,CAAR,eACI,2BAAK,GAAG,WAAKpD,UAAL,SAAkBsE,OAAO,CAACC,MAAR,CAAelB,KAAjC,CAAR,CACI,SAAS,CAAC,gBADd,CAEI,KAAK,CAAE,CAAEC,WAAW,CAAE,MAAf,CAFX,EADJ,CAFJ,cAQI,yBAAG,SAAS,CAAC,+BAAb,EACKgB,OAAO,CAACP,OAAR,CAAgBC,KAAhB,CAAsB,GAAtB,EAA2BC,OAA3B,GAAqCC,IAArC,CAA0C,GAA1C,CADL,CARJ,cAWI,2BAAK,SAAS,CAAC,6BAAf,eACI,2BAAK,SAAS,CAAC,mBAAf,SADJ,CAXJ,CADJ,cAkBI,2BAAK,SAAS,CAAC,sBAAf,eACI,0CACI,oBAAC,IAAD,EAAM,EAAE,iBAAWI,OAAO,CAACC,MAAR,CAAenB,IAA1B,CAAR,CAA0C,KAAK,CAAE,CAAEe,KAAK,CAAE,MAAT,CAAjD,MACMG,OAAO,CAACC,MAAR,CAAed,IAAf,CAAoBC,QAD1B,CADJ,uBADJ,CAlBJ,cAyBI,2BAAK,SAAS,CAAC,gCAAf,eACI,2BAAK,SAAS,CAAC,8BAAf,EACKY,OAAO,CAACD,OADb,CADJ,cAII,oBAAC,IAAD,EAAM,EAAE,iBAAWC,OAAO,CAACF,IAAR,CAAanB,EAAxB,CAAR,eACI,8BAAQ,SAAS,CAAC,iBAAlB,aADJ,CAJJ,CAzBJ,CADJ,CAsCH,CAvCA,CADL,CAxCR,CAnCR,CAyHK,CAAC,CAAC,CAACzC,mBAAmB,CAACkB,MAAtB,EAAgC,CAAC,CAACd,kBAAkB,CAACc,MAAtD,gBACG,wCACK,CAAC,CAAClB,mBAAmB,CAACkB,MAAtB,eACG,wCACKlB,mBAAmB,CAACsC,GAApB,CAAwB,SAAAe,IAAI,CAAI,CAC7B,mBACI,0BAAI,SAAS,CAAC,kBAAd,CAAiC,GAAG,CAAEA,IAAI,CAACC,OAAL,CAAab,EAAnD,eACI,2BAAK,SAAS,CAAC,2BAAf,eACI,yBAAG,KAAK,CAAC,gCAAT,EADJ,cAEI,oBAAC,IAAD,EAAM,EAAE,iBAAWY,IAAI,CAACC,OAAL,CAAaV,IAAxB,CAAR,eACI,2BAAK,GAAG,WAAKpD,UAAL,SAAkB6D,IAAI,CAACC,OAAL,CAAaT,KAA/B,CAAR,CACI,SAAS,CAAC,gBADd,CAEI,KAAK,CAAE,CAAEC,WAAW,CAAE,MAAf,CAFX,EADJ,CAFJ,cAQI,yBAAG,SAAS,CAAC,+BAAb,EACKO,IAAI,CAACE,OAAL,CAAaC,KAAb,CAAmB,GAAnB,EAAwBC,OAAxB,GAAkCC,IAAlC,CAAuC,GAAvC,CADL,CARJ,CADJ,cAaI,2BAAK,SAAS,CAAC,sBAAf,eACI,0CACI,oBAAC,IAAD,EAAM,EAAE,iBAAWL,IAAI,CAACC,OAAL,CAAaV,IAAxB,CAAR,CAAwC,KAAK,CAAE,CAAEe,KAAK,CAAE,MAAT,CAA/C,MACMN,IAAI,CAACC,OAAL,CAAaL,IAAb,CAAkBC,QADxB,CADJ,qBADJ,CAbJ,cAoBI,2BAAK,SAAS,CAAC,2BAAf,EACKG,IAAI,CAACO,IAAL,CAAUC,OADf,CApBJ,CADJ,CA0BH,CA3BA,CADL,CAFR,CAkCK,CAAC,CAACzD,kBAAkB,CAACc,MAArB,eACG,wCACKd,kBAAkB,CAACkC,GAAnB,CAAuB,SAAAwB,OAAO,CAAI,CAC/B,mBACI,0BAAI,SAAS,CAAC,kBAAd,CAAiC,GAAG,CAAEA,OAAO,CAACC,MAAR,CAAetB,EAArD,eACI,2BAAK,SAAS,CAAC,2BAAf,eACI,yBAAG,KAAK,CAAC,qCAAT,EADJ,cAEI,oBAAC,IAAD,EAAM,EAAE,iBAAWqB,OAAO,CAACC,MAAR,CAAenB,IAA1B,CAAR,eACI,2BAAK,GAAG,WAAKpD,UAAL,SAAkBsE,OAAO,CAACC,MAAR,CAAelB,KAAjC,CAAR,CACI,SAAS,CAAC,gBADd,CAEI,KAAK,CAAE,CAAEC,WAAW,CAAE,MAAf,CAFX,EADJ,CAFJ,cAQI,yBAAG,SAAS,CAAC,+BAAb,EACKgB,OAAO,CAACP,OAAR,CAAgBC,KAAhB,CAAsB,GAAtB,EAA2BC,OAA3B,GAAqCC,IAArC,CAA0C,GAA1C,CADL,CARJ,CADJ,cAaI,2BAAK,SAAS,CAAC,sBAAf,eACI,0CACI,oBAAC,IAAD,EAAM,EAAE,iBAAWI,OAAO,CAACC,MAAR,CAAenB,IAA1B,CAAR,CAA0C,KAAK,CAAE,CAAEe,KAAK,CAAE,MAAT,CAAjD,MACMG,OAAO,CAACC,MAAR,CAAed,IAAf,CAAoBC,QAD1B,CADJ,uBADJ,CAbJ,cAoBI,2BAAK,SAAS,CAAC,gCAAf,eACI,2BAAK,SAAS,CAAC,8BAAf,EACKY,OAAO,CAACD,OADb,CADJ,cAII,oBAAC,IAAD,EAAM,EAAE,iBAAWC,OAAO,CAACF,IAAR,CAAanB,EAAxB,CAAR,eACI,8BAAQ,SAAS,CAAC,iBAAlB,aADJ,CAJJ,CApBJ,CADJ,CAiCH,CAlCA,CADL,CAnCR,CA1HR,CADH,cAwMG,2BAAK,SAAS,CAAC,4BAAf,eACI,6EADJ,CAzMR,CADH,cAiNG,2BAAK,SAAS,CAAC,gCAAf,eACI,2BAAK,SAAS,CAAC,QAAf,EADJ,CAlNR,CADJ,CAFJ,CADJ,CA8NH","sourcesContent":["import React, { useEffect, useState } from 'react'\r\nimport { Link } from 'react-router-dom'\r\nimport Header from '../components/fixed/Header'\r\nimport { SERVER_URL } from '../settings'\r\nimport { csrftoken } from '../utils'\r\n\r\nexport default function Notifications(props) {\r\n    const [invites, setInvites] = useState(null)\r\n    const [unvisualizedPostLikes, setUnvisualizedPostLikes] = useState(null)\r\n    const [visualizedPostLikes, setVisualizedPostLikes] = useState(null)\r\n    const [unvisualizedComments, setUnvisualizedComments] = useState(null)\r\n    const [visualizedComments, setVisualizedComments] = useState(null)\r\n\r\n    let notificationsFetchInterval\r\n\r\n    document.title = 'Notificações / Napker'\r\n\r\n    const fetchNotifications = () => {\r\n        fetch(`${SERVER_URL}/profile-api/myinvites`)\r\n            .then(response => response.json())\r\n            .then(data => setInvites(data))\r\n        fetch(`${SERVER_URL}/post-api/unvisualized-post-likes`)\r\n            .then(response => response.json())\r\n            .then(data => setUnvisualizedPostLikes(data))\r\n        fetch(`${SERVER_URL}/post-api/unvisualized-post-comments`)\r\n            .then(response => response.json())\r\n            .then(data => setUnvisualizedComments(data))\r\n        fetch(`${SERVER_URL}/post-api/post-likes-visualized-last-2-days`)\r\n            .then(response => response.json())\r\n            .then(data => setVisualizedPostLikes(data))\r\n        fetch(`${SERVER_URL}/post-api/post-comments-visualized-last-2-days`)\r\n            .then(response => response.json())\r\n            .then(data => setVisualizedComments(data))\r\n    }\r\n\r\n    useEffect(() => {\r\n        fetchNotifications()\r\n        notificationsFetchInterval = window.setInterval(fetchNotifications, 3000)\r\n        return () => window.clearInterval(notificationsFetchInterval)\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        if (unvisualizedPostLikes && unvisualizedPostLikes.length) {\r\n            fetch(`${SERVER_URL}/post-api/visualize-likes`)\r\n                .then(response => response.json())\r\n                .then(data => {\r\n                    console.log(data)\r\n                    props.updateNotificationsNumber()\r\n                })\r\n        }\r\n    }, [unvisualizedPostLikes])\r\n\r\n    useEffect(() => {\r\n        if (unvisualizedComments && unvisualizedComments.length) {\r\n            fetch(`${SERVER_URL}/post-api/visualize-comments`)\r\n                .then(response => response.json())\r\n                .then(data => {\r\n                    console.log(data)\r\n                    props.updateNotificationsNumber()\r\n                })\r\n        }\r\n    }, [unvisualizedComments])\r\n\r\n    const replyRequest = e => {\r\n        e.stopPropagation()\r\n        const btn = e.target\r\n        const requestBody = {\r\n            'senderid': btn.dataset.senderid,\r\n            'reply': btn.dataset.reply\r\n        }\r\n        fetch(`${SERVER_URL}/profile-api/reply-friend-request`, {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-type': 'application/json',\r\n                'X-CSRFToken': csrftoken,\r\n            },\r\n            body: JSON.stringify(requestBody)\r\n        })\r\n            .then(response => response.json())\r\n            .then(data => {\r\n                console.log(data)\r\n                props.updateNotificationsNumber()\r\n            })\r\n        document.getElementById(`fr-${btn.dataset.senderid}`).remove()\r\n        fetchNotifications()\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            <Header page=\"Notificações\" />\r\n            <div className=\"content\">\r\n                <div>\r\n                    {invites !== null && unvisualizedPostLikes && visualizedPostLikes !== null && unvisualizedComments !== null && visualizedComments !== null ?\r\n                        <div>\r\n                            {invites.length || unvisualizedPostLikes.length || visualizedPostLikes.length || unvisualizedComments.length || !!visualizedComments.length ?\r\n                                <div className=\"notifications-container\">\r\n                                    {!!invites.length &&\r\n                                        <div>\r\n                                            {invites.map(i => {\r\n                                                return (\r\n                                                    <li\r\n                                                        className=\"friend-request-row\"\r\n                                                        id={`fr-${i.sender.id}`}\r\n                                                        key={i.sender.id}\r\n                                                        onClick={() => window.location.href = `/user/${i.sender.slug}`}\r\n                                                    >\r\n                                                        <div className=\"friend-request-col\">\r\n                                                            <img src={`${SERVER_URL}${i.sender.photo}`}\r\n                                                                className=\"profile-img-med\"\r\n                                                                style={{ marginRight: '10px' }}\r\n                                                            />\r\n                                                            <div className=\"d-flex flex-column align-items-start\">\r\n                                                                <strong>{i.sender.first_name} {i.sender.last_name}</strong>\r\n                                                                <p className=\"text-secondary\">@{i.sender.user.username}</p>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                        <div className=\"friend-request-col\">\r\n                                                            {i.sender.bio}\r\n                                                        </div>\r\n                                                        <div className=\"friend-request-col\" style={{ justifyContent: 'space-between' }}>\r\n                                                            <button className=\"btn btn-primary btn-reply-fr mr-1\" data-senderid={i.sender.id} data-reply='accept' onClick={replyRequest}>Confirmar</button>\r\n                                                            <button className=\"btn btn-grey btn-reply-fr\" data-senderid={i.sender.id} data-reply='decline' onClick={replyRequest}>Excluir</button>\r\n                                                        </div>\r\n                                                    </li>\r\n                                                )\r\n                                            })}\r\n                                        </div>\r\n                                    }\r\n\r\n                                    {(!!unvisualizedPostLikes.length || !!unvisualizedComments.length) &&\r\n                                        <>\r\n                                            {!!unvisualizedPostLikes.length &&\r\n                                                <>\r\n                                                    {unvisualizedPostLikes.map(like => {\r\n                                                        return (\r\n                                                            <li className=\"notification-row\" key={like.profile.id}>\r\n                                                                <div className=\"d-flex align-items-center\">\r\n                                                                    <i class=\"fas fa-heart notification-like\" />\r\n                                                                    <Link to={`/user/${like.profile.slug}`}>\r\n                                                                        <img src={`${SERVER_URL}${like.profile.photo}`}\r\n                                                                            className=\"profile-img-sm\"\r\n                                                                            style={{ marginRight: '10px' }}\r\n                                                                        />\r\n                                                                    </Link>\r\n                                                                    <p className=\"text-secondary d-inline-block\">\r\n                                                                        {like.created.split('-').reverse().join('/')}\r\n                                                                    </p>\r\n                                                                    <div className=\"notification-text-container\">\r\n                                                                        <div className=\"notification-text\">\r\n                                                                            novo\r\n                                                                        </div>\r\n                                                                    </div>\r\n                                                                </div>\r\n                                                                <div className=\"notification-message\">\r\n                                                                    <p>\r\n                                                                        <Link to={`/user/${like.profile.slug}`} style={{ color: \"#000\" }}>\r\n                                                                            @{like.profile.user.username}\r\n                                                                        </Link> curtiu seu post.\r\n                                                                    </p>\r\n                                                                </div>\r\n                                                                <div className=\"notification-post-content\">\r\n                                                                    {like.post.content}\r\n                                                                </div>\r\n                                                            </li>\r\n                                                        )\r\n                                                    })}\r\n                                                </>\r\n                                            }\r\n\r\n                                            {!!unvisualizedComments.length &&\r\n                                                <>\r\n                                                    {unvisualizedComments.map(comment => {\r\n                                                        return (\r\n                                                            <li className=\"notification-row\" key={comment.author.id}>\r\n                                                                <div className=\"d-flex align-items-center\">\r\n                                                                    <i class=\"fas fa-comment notification-comment\" />\r\n                                                                    <Link to={`/user/${comment.author.slug}`}>\r\n                                                                        <img src={`${SERVER_URL}${comment.author.photo}`}\r\n                                                                            className=\"profile-img-sm\"\r\n                                                                            style={{ marginRight: '10px' }}\r\n                                                                        />\r\n                                                                    </Link>\r\n                                                                    <p className=\"text-secondary d-inline-block\">\r\n                                                                        {comment.created.split('-').reverse().join('/')}\r\n                                                                    </p>\r\n                                                                    <div className=\"notification-text-container\">\r\n                                                                        <div className=\"notification-text\">\r\n                                                                            novo\r\n                                                                    </div>\r\n                                                                    </div>\r\n                                                                </div>\r\n                                                                <div className=\"notification-message\">\r\n                                                                    <p>\r\n                                                                        <Link to={`/user/${comment.author.slug}`} style={{ color: \"#000\" }}>\r\n                                                                            @{comment.author.user.username}\r\n                                                                        </Link> comentou seu post.\r\n                                                                </p>\r\n                                                                </div>\r\n                                                                <div className=\"notification-comment-container\">\r\n                                                                    <div className=\"notification-comment-content\">\r\n                                                                        {comment.content}\r\n                                                                    </div>\r\n                                                                    <Link to={`/post/${comment.post.id}`}>\r\n                                                                        <button className=\"btn btn-primary\">\r\n                                                                            Ver Post\r\n                                                                        </button>\r\n                                                                    </Link>\r\n                                                                </div>\r\n                                                            </li>\r\n                                                        )\r\n                                                    })}\r\n                                                </>\r\n                                            }\r\n                                        </>\r\n                                    }\r\n\r\n                                    {(!!visualizedPostLikes.length || !!visualizedComments.length) &&\r\n                                        <>\r\n                                            {!!visualizedPostLikes.length &&\r\n                                                <>\r\n                                                    {visualizedPostLikes.map(like => {\r\n                                                        return (\r\n                                                            <li className=\"notification-row\" key={like.profile.id}>\r\n                                                                <div className=\"d-flex align-items-center\">\r\n                                                                    <i class=\"fas fa-heart notification-like\" />\r\n                                                                    <Link to={`/user/${like.profile.slug}`}>\r\n                                                                        <img src={`${SERVER_URL}${like.profile.photo}`}\r\n                                                                            className=\"profile-img-sm\"\r\n                                                                            style={{ marginRight: '10px' }}\r\n                                                                        />\r\n                                                                    </Link>\r\n                                                                    <p className=\"text-secondary d-inline-block\">\r\n                                                                        {like.created.split('-').reverse().join('/')}\r\n                                                                    </p>\r\n                                                                </div>\r\n                                                                <div className=\"notification-message\">\r\n                                                                    <p>\r\n                                                                        <Link to={`/user/${like.profile.slug}`} style={{ color: \"#000\" }}>\r\n                                                                            @{like.profile.user.username}\r\n                                                                        </Link> curtiu seu post.\r\n                                                                    </p>\r\n                                                                </div>\r\n                                                                <div className=\"notification-post-content\">\r\n                                                                    {like.post.content}\r\n                                                                </div>\r\n                                                            </li>\r\n                                                        )\r\n                                                    })}\r\n                                                </>\r\n                                            }\r\n\r\n                                            {!!visualizedComments.length &&\r\n                                                <>\r\n                                                    {visualizedComments.map(comment => {\r\n                                                        return (\r\n                                                            <li className=\"notification-row\" key={comment.author.id}>\r\n                                                                <div className=\"d-flex align-items-center\">\r\n                                                                    <i class=\"fas fa-comment notification-comment\" />\r\n                                                                    <Link to={`/user/${comment.author.slug}`}>\r\n                                                                        <img src={`${SERVER_URL}${comment.author.photo}`}\r\n                                                                            className=\"profile-img-sm\"\r\n                                                                            style={{ marginRight: '10px' }}\r\n                                                                        />\r\n                                                                    </Link>\r\n                                                                    <p className=\"text-secondary d-inline-block\">\r\n                                                                        {comment.created.split('-').reverse().join('/')}\r\n                                                                    </p>\r\n                                                                </div>\r\n                                                                <div className=\"notification-message\">\r\n                                                                    <p>\r\n                                                                        <Link to={`/user/${comment.author.slug}`} style={{ color: \"#000\" }}>\r\n                                                                            @{comment.author.user.username}\r\n                                                                        </Link> comentou seu post.\r\n                                                                    </p>\r\n                                                                </div>\r\n                                                                <div className=\"notification-comment-container\">\r\n                                                                    <div className=\"notification-comment-content\">\r\n                                                                        {comment.content}\r\n                                                                    </div>\r\n                                                                    <Link to={`/post/${comment.post.id}`}>\r\n                                                                        <button className=\"btn btn-primary\">\r\n                                                                            Ver Post\r\n                                                                        </button>\r\n                                                                    </Link>\r\n                                                                </div>\r\n                                                            </li>\r\n                                                        )\r\n                                                    })}\r\n                                                </>\r\n                                            }\r\n                                        </>\r\n                                    }\r\n\r\n                                </div> :\r\n                                <div className=\"no-notifications-container\">\r\n                                    <h3>Você não tem nenhuma notificação</h3>\r\n                                </div>\r\n                            }\r\n\r\n\r\n                        </div> :\r\n                        <div className=\"notifications-loader-container\">\r\n                            <div className=\"loader\" />\r\n                        </div>\r\n                    }\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}"]},"metadata":{},"sourceType":"module"}