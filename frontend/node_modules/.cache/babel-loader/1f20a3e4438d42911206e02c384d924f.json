{"ast":null,"code":"import _classCallCheck from\"C:\\\\Users\\\\felip\\\\CodeProjects\\\\Web\\\\Napker\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\felip\\\\CodeProjects\\\\Web\\\\Napker\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\felip\\\\CodeProjects\\\\Web\\\\Napker\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\felip\\\\CodeProjects\\\\Web\\\\Napker\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React from'react';import{SERVER_URL}from'../../config/settings';import Header from'../../components/fixed/header';import ModalContactSearch from'./components/ModalContactSearch';import Chat from'./components/chat_/Chat';import ContactListItem from'./components/ContactListItem';import ContactFilterInput from'./components/ContactFilterInput';var Messages=/*#__PURE__*/function(_React$Component){_inherits(Messages,_React$Component);var _super=_createSuper(Messages);function Messages(_props){var _this;_classCallCheck(this,Messages);_this=_super.call(this,_props);_this.handleReceiveProps=function(props){if(props.match.params.slug){var participants={username:_this.state.username,other_username:props.match.params.slug};fetch(\"\".concat(SERVER_URL,\"/chat-api/chat-id/\").concat(JSON.stringify(participants))).then(function(response){return response.json();}).then(function(data){_this.setState({chatId:data['chat_id']});});}else{if(!_this.state.chatId){_this.setState({chatId:null});}}};_this.fetchActiveChatProfiles=function(){fetch(\"\".concat(SERVER_URL,\"/chat-api/active-chats-profiles\")).then(function(response){return response.json();}).then(function(data){if(!_this.state.username)return;if(!_this.hasFilteredProfiles){_this.setState({activeChats:data.chats,activeChatsProfiles:data.profiles,renderedActiveChatsProfiles:data.profiles});}});};_this.openModal=function(){_this.setState({addingNewChat:true});};_this.state={myProfile:null,username:null,chatId:null,activeChats:null,activeChatsProfiles:null,renderedActiveChatsProfiles:null,addingNewChat:false,modalProfiles:[]};_this.rerenderingInterval=null;_this.hasFilteredProfiles=false;return _this;}_createClass(Messages,[{key:\"componentWillReceiveProps\",value:function componentWillReceiveProps(newProps){if(newProps===this.props)return;this.handleReceiveProps(newProps);}},{key:\"handleComponentChange\",value:function handleComponentChange(){var _this2=this;if(!this.state.username){fetch(\"\".concat(SERVER_URL,\"/profile-api/logged-user\")).then(function(response){return response.json();}).then(function(data){_this2.setState({username:data.username});if(_this2.props.match.params.slug){_this2.handleReceiveProps(_this2.props);}});}if(!this.state.activeChatsProfiles&&this.state.activeChatsProfiles!==[]){this.fetchActiveChatProfiles();}}},{key:\"componentWillMount\",value:function componentWillMount(){document.title='Mensagens / Napker';this.handleComponentChange();this.rerenderingInterval=window.setInterval(this.fetchActiveChatProfiles,4000);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){window.clearInterval(this.rerenderingInterval);if(document.querySelector('#bottom-menu-post-icon')){document.querySelector('#bottom-menu-post-icon').style.display='unset';}}},{key:\"componentDidMount\",value:function componentDidMount(){if(document.querySelector('#bottom-menu-post-icon')&&document.querySelector('#bottom-menu-post-icon').display!=='none'){document.querySelector('#bottom-menu-post-icon').style.display='none';}}},{key:\"componentDidUpdate\",value:function componentDidUpdate(){this.handleComponentChange();}},{key:\"render\",value:function render(){var _this3=this;return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Header,{page:\"Mensagens\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"content d-flex messages-wrapper\"},/*#__PURE__*/React.createElement(ModalContactSearch,{addingNewChat:this.state.addingNewChat,setParentState:this.setState.bind(this),modalProfiles:this.state.modalProfiles}),/*#__PURE__*/React.createElement(\"div\",{className:\"chats-list\"},/*#__PURE__*/React.createElement(ContactFilterInput,{activeChatsProfiles:this.state.activeChatsProfiles,setHasFilteredProfiles:function setHasFilteredProfiles(bool){return _this3.hasFilteredProfiles=bool;},fetchActiveChatProfiles:this.fetchActiveChatProfiles,setParentState:this.setState.bind(this),openModal:this.openModal}),/*#__PURE__*/React.createElement(\"div\",{className:\"list-group chats-container\"},this.state.renderedActiveChatsProfiles!==null?this.state.renderedActiveChatsProfiles.map(function(profile){return/*#__PURE__*/React.createElement(ContactListItem,{profile:profile,activeChats:_this3.state.activeChats,activeChatsProfiles:_this3.state.activeChatsProfiles});}):/*#__PURE__*/React.createElement(\"div\",{className:\"messages-loader-container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"loader\"})))),/*#__PURE__*/React.createElement(Chat,{username:this.state.username,otherUsername:this.props.match.params.slug,chatId:this.state.chatId,openModal:this.openModal,updateUnreadMessagesNumber:this.props.updateUnreadMessagesNumber,updateMessagesComponent:this.fetchActiveChatProfiles})));}}]);return Messages;}(React.Component);export{Messages as default};","map":{"version":3,"sources":["C:/Users/felip/CodeProjects/Web/Napker/frontend/src/pages/messages_/Messages.js"],"names":["React","SERVER_URL","Header","ModalContactSearch","Chat","ContactListItem","ContactFilterInput","Messages","props","handleReceiveProps","match","params","slug","participants","username","state","other_username","fetch","JSON","stringify","then","response","json","data","setState","chatId","fetchActiveChatProfiles","hasFilteredProfiles","activeChats","chats","activeChatsProfiles","profiles","renderedActiveChatsProfiles","openModal","addingNewChat","myProfile","modalProfiles","rerenderingInterval","newProps","document","title","handleComponentChange","window","setInterval","clearInterval","querySelector","style","display","bind","bool","map","profile","updateUnreadMessagesNumber","Component"],"mappings":"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","sourcesContent":["import React from 'react'\r\n\r\nimport { SERVER_URL } from '../../config/settings'\r\nimport Header from '../../components/fixed/header'\r\nimport ModalContactSearch from './components/ModalContactSearch'\r\nimport Chat from './components/chat_/Chat'\r\nimport ContactListItem from './components/ContactListItem'\r\nimport ContactFilterInput from './components/ContactFilterInput'\r\n\r\nexport default class Messages extends React.Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            myProfile: null,\r\n            username: null,\r\n            chatId: null,\r\n            activeChats: null,\r\n            activeChatsProfiles: null,\r\n            renderedActiveChatsProfiles: null,\r\n            addingNewChat: false,\r\n            modalProfiles: [],\r\n        }\r\n        this.rerenderingInterval = null\r\n        this.hasFilteredProfiles = false\r\n    }\r\n\r\n    handleReceiveProps = props => {\r\n        if (props.match.params.slug) {\r\n            const participants = { username: this.state.username, other_username: props.match.params.slug }\r\n            fetch(`${SERVER_URL}/chat-api/chat-id/${JSON.stringify(participants)}`)\r\n                .then(response => response.json())\r\n                .then(data => {\r\n                    this.setState({chatId: data['chat_id'] })\r\n                })\r\n        } else {\r\n            if (!this.state.chatId) {\r\n                this.setState({\r\n                    chatId: null\r\n                })\r\n            }\r\n        }\r\n    }\r\n\r\n    componentWillReceiveProps(newProps) {\r\n        if (newProps === this.props) return\r\n        this.handleReceiveProps(newProps)\r\n    }\r\n\r\n    handleComponentChange() {\r\n        if (!this.state.username) {\r\n            fetch(`${SERVER_URL}/profile-api/logged-user`)\r\n                .then(response => response.json())\r\n                .then(data => {\r\n                    this.setState({\r\n                        username: data.username\r\n                    })\r\n                    if (this.props.match.params.slug) {\r\n                        this.handleReceiveProps(this.props)\r\n                    }\r\n                })\r\n        }\r\n        if (!this.state.activeChatsProfiles && this.state.activeChatsProfiles !== []) {\r\n            this.fetchActiveChatProfiles()\r\n        }\r\n    }\r\n\r\n    componentWillMount() {\r\n        document.title = 'Mensagens / Napker'\r\n        this.handleComponentChange()\r\n        this.rerenderingInterval = window.setInterval(this.fetchActiveChatProfiles, 4000)\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        window.clearInterval(this.rerenderingInterval)\r\n        if (document.querySelector('#bottom-menu-post-icon')) {\r\n            document.querySelector('#bottom-menu-post-icon').style.display = 'unset'\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        if (document.querySelector('#bottom-menu-post-icon') && document.querySelector('#bottom-menu-post-icon').display !== 'none') {\r\n            document.querySelector('#bottom-menu-post-icon').style.display = 'none'\r\n        }\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        this.handleComponentChange()\r\n    }\r\n\r\n    fetchActiveChatProfiles = () => {\r\n        fetch(`${SERVER_URL}/chat-api/active-chats-profiles`)\r\n            .then(response => response.json())\r\n            .then(data => {\r\n                if (!this.state.username) return\r\n                if (!this.hasFilteredProfiles) {\r\n                    this.setState({\r\n                        activeChats: data.chats,\r\n                        activeChatsProfiles: data.profiles,\r\n                        renderedActiveChatsProfiles: data.profiles\r\n                    })\r\n                }\r\n            })\r\n    }\r\n\r\n    openModal = () => {\r\n        this.setState({\r\n            addingNewChat: true\r\n        })\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <>\r\n                <Header page=\"Mensagens\" />\r\n                <div className=\"content d-flex messages-wrapper\">\r\n                    <ModalContactSearch\r\n                        addingNewChat={this.state.addingNewChat}\r\n                        setParentState={this.setState.bind(this)}\r\n                        modalProfiles={this.state.modalProfiles}\r\n                    />\r\n                    <div className=\"chats-list\">\r\n                        <ContactFilterInput\r\n                            activeChatsProfiles={this.state.activeChatsProfiles}\r\n                            setHasFilteredProfiles={bool => this.hasFilteredProfiles = bool}\r\n                            fetchActiveChatProfiles={this.fetchActiveChatProfiles}\r\n                            setParentState={this.setState.bind(this)}\r\n                            openModal={this.openModal}\r\n                        />\r\n                        <div className=\"list-group chats-container\">\r\n                            {this.state.renderedActiveChatsProfiles !== null ?\r\n                                this.state.renderedActiveChatsProfiles.map(profile => {\r\n                                    return (\r\n                                        <ContactListItem\r\n                                            profile={profile}\r\n                                            activeChats={this.state.activeChats}\r\n                                            activeChatsProfiles={this.state.activeChatsProfiles}\r\n                                        />\r\n                                    )\r\n                                })\r\n                                :\r\n                                <div className=\"messages-loader-container\">\r\n                                    <div className=\"loader\" />\r\n                                </div>\r\n                            }\r\n                        </div>\r\n                    </div>\r\n                    <Chat\r\n                        username={this.state.username}\r\n                        otherUsername={this.props.match.params.slug}\r\n                        chatId={this.state.chatId}\r\n                        openModal={this.openModal}\r\n                        updateUnreadMessagesNumber={this.props.updateUnreadMessagesNumber}\r\n                        updateMessagesComponent={this.fetchActiveChatProfiles}\r\n                    />\r\n                </div>\r\n            </>\r\n        )\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}